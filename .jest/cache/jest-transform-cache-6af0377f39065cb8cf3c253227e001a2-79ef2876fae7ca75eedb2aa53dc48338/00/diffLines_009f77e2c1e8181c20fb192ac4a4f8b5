93f3baf4af39c25498a983627d061f9e
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.printDiffLines = exports.diffLinesUnified2 = exports.diffLinesUnified = exports.diffLinesRaw = void 0;
var _diffSequences = _interopRequireDefault(require('diff-sequences'));
var _cleanupSemantic = require('./cleanupSemantic');
var _joinAlignedDiffs = require('./joinAlignedDiffs');
var _normalizeDiffOptions = require('./normalizeDiffOptions');
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
var isEmptyString = function isEmptyString(lines) {
  return lines.length === 1 && lines[0].length === 0;
};
var countChanges = function countChanges(diffs) {
  var a = 0;
  var b = 0;
  diffs.forEach(function (diff) {
    switch (diff[0]) {
      case _cleanupSemantic.DIFF_DELETE:
        a += 1;
        break;
      case _cleanupSemantic.DIFF_INSERT:
        b += 1;
        break;
    }
  });
  return {
    a: a,
    b: b
  };
};
var printAnnotation = function printAnnotation(_ref, changeCounts) {
  var aAnnotation = _ref.aAnnotation,
    aColor = _ref.aColor,
    aIndicator = _ref.aIndicator,
    bAnnotation = _ref.bAnnotation,
    bColor = _ref.bColor,
    bIndicator = _ref.bIndicator,
    includeChangeCounts = _ref.includeChangeCounts,
    omitAnnotationLines = _ref.omitAnnotationLines;
  if (omitAnnotationLines) {
    return '';
  }
  var aRest = '';
  var bRest = '';
  if (includeChangeCounts) {
    var aCount = String(changeCounts.a);
    var bCount = String(changeCounts.b);
    var baAnnotationLengthDiff = bAnnotation.length - aAnnotation.length;
    var aAnnotationPadding = ' '.repeat(Math.max(0, baAnnotationLengthDiff));
    var bAnnotationPadding = ' '.repeat(Math.max(0, -baAnnotationLengthDiff));
    var baCountLengthDiff = bCount.length - aCount.length;
    var aCountPadding = ' '.repeat(Math.max(0, baCountLengthDiff));
    var bCountPadding = ' '.repeat(Math.max(0, -baCountLengthDiff));
    aRest = `${aAnnotationPadding}  ${aIndicator} ${aCountPadding}${aCount}`;
    bRest = `${bAnnotationPadding}  ${bIndicator} ${bCountPadding}${bCount}`;
  }
  var a = `${aIndicator} ${aAnnotation}${aRest}`;
  var b = `${bIndicator} ${bAnnotation}${bRest}`;
  return `${aColor(a)}\n${bColor(b)}\n\n`;
};
var printDiffLines = function printDiffLines(diffs, options) {
  return printAnnotation(options, countChanges(diffs)) + (options.expand ? (0, _joinAlignedDiffs.joinAlignedDiffsExpand)(diffs, options) : (0, _joinAlignedDiffs.joinAlignedDiffsNoExpand)(diffs, options));
};
exports.printDiffLines = printDiffLines;
var diffLinesUnified = function diffLinesUnified(aLines, bLines, options) {
  return printDiffLines(diffLinesRaw(isEmptyString(aLines) ? [] : aLines, isEmptyString(bLines) ? [] : bLines), (0, _normalizeDiffOptions.normalizeDiffOptions)(options));
};
exports.diffLinesUnified = diffLinesUnified;
var diffLinesUnified2 = function diffLinesUnified2(aLinesDisplay, bLinesDisplay, aLinesCompare, bLinesCompare, options) {
  if (isEmptyString(aLinesDisplay) && isEmptyString(aLinesCompare)) {
    aLinesDisplay = [];
    aLinesCompare = [];
  }
  if (isEmptyString(bLinesDisplay) && isEmptyString(bLinesCompare)) {
    bLinesDisplay = [];
    bLinesCompare = [];
  }
  if (aLinesDisplay.length !== aLinesCompare.length || bLinesDisplay.length !== bLinesCompare.length) {
    return diffLinesUnified(aLinesDisplay, bLinesDisplay, options);
  }
  var diffs = diffLinesRaw(aLinesCompare, bLinesCompare);
  var aIndex = 0;
  var bIndex = 0;
  diffs.forEach(function (diff) {
    switch (diff[0]) {
      case _cleanupSemantic.DIFF_DELETE:
        diff[1] = aLinesDisplay[aIndex];
        aIndex += 1;
        break;
      case _cleanupSemantic.DIFF_INSERT:
        diff[1] = bLinesDisplay[bIndex];
        bIndex += 1;
        break;
      default:
        diff[1] = bLinesDisplay[bIndex];
        aIndex += 1;
        bIndex += 1;
    }
  });
  return printDiffLines(diffs, (0, _normalizeDiffOptions.normalizeDiffOptions)(options));
};
exports.diffLinesUnified2 = diffLinesUnified2;
var diffLinesRaw = function diffLinesRaw(aLines, bLines) {
  var aLength = aLines.length;
  var bLength = bLines.length;
  var isCommon = function isCommon(aIndex, bIndex) {
    return aLines[aIndex] === bLines[bIndex];
  };
  var diffs = [];
  var aIndex = 0;
  var bIndex = 0;
  var foundSubsequence = function foundSubsequence(nCommon, aCommon, bCommon) {
    for (; aIndex !== aCommon; aIndex += 1) {
      diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_DELETE, aLines[aIndex]));
    }
    for (; bIndex !== bCommon; bIndex += 1) {
      diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_INSERT, bLines[bIndex]));
    }
    for (; nCommon !== 0; nCommon -= 1, aIndex += 1, bIndex += 1) {
      diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_EQUAL, bLines[bIndex]));
    }
  };
  (0, _diffSequences.default)(aLength, bLength, isCommon, foundSubsequence);
  for (; aIndex !== aLength; aIndex += 1) {
    diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_DELETE, aLines[aIndex]));
  }
  for (; bIndex !== bLength; bIndex += 1) {
    diffs.push(new _cleanupSemantic.Diff(_cleanupSemantic.DIFF_INSERT, bLines[bIndex]));
  }
  return diffs;
};
exports.diffLinesRaw = diffLinesRaw;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInByaW50RGlmZkxpbmVzIiwiZGlmZkxpbmVzVW5pZmllZDIiLCJkaWZmTGluZXNVbmlmaWVkIiwiZGlmZkxpbmVzUmF3IiwiX2RpZmZTZXF1ZW5jZXMiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jbGVhbnVwU2VtYW50aWMiLCJfam9pbkFsaWduZWREaWZmcyIsIl9ub3JtYWxpemVEaWZmT3B0aW9ucyIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiaXNFbXB0eVN0cmluZyIsImxpbmVzIiwibGVuZ3RoIiwiY291bnRDaGFuZ2VzIiwiZGlmZnMiLCJhIiwiYiIsImZvckVhY2giLCJkaWZmIiwiRElGRl9ERUxFVEUiLCJESUZGX0lOU0VSVCIsInByaW50QW5ub3RhdGlvbiIsIl9yZWYiLCJjaGFuZ2VDb3VudHMiLCJhQW5ub3RhdGlvbiIsImFDb2xvciIsImFJbmRpY2F0b3IiLCJiQW5ub3RhdGlvbiIsImJDb2xvciIsImJJbmRpY2F0b3IiLCJpbmNsdWRlQ2hhbmdlQ291bnRzIiwib21pdEFubm90YXRpb25MaW5lcyIsImFSZXN0IiwiYlJlc3QiLCJhQ291bnQiLCJTdHJpbmciLCJiQ291bnQiLCJiYUFubm90YXRpb25MZW5ndGhEaWZmIiwiYUFubm90YXRpb25QYWRkaW5nIiwicmVwZWF0IiwiTWF0aCIsIm1heCIsImJBbm5vdGF0aW9uUGFkZGluZyIsImJhQ291bnRMZW5ndGhEaWZmIiwiYUNvdW50UGFkZGluZyIsImJDb3VudFBhZGRpbmciLCJvcHRpb25zIiwiZXhwYW5kIiwiam9pbkFsaWduZWREaWZmc0V4cGFuZCIsImpvaW5BbGlnbmVkRGlmZnNOb0V4cGFuZCIsImFMaW5lcyIsImJMaW5lcyIsIm5vcm1hbGl6ZURpZmZPcHRpb25zIiwiYUxpbmVzRGlzcGxheSIsImJMaW5lc0Rpc3BsYXkiLCJhTGluZXNDb21wYXJlIiwiYkxpbmVzQ29tcGFyZSIsImFJbmRleCIsImJJbmRleCIsImFMZW5ndGgiLCJiTGVuZ3RoIiwiaXNDb21tb24iLCJmb3VuZFN1YnNlcXVlbmNlIiwibkNvbW1vbiIsImFDb21tb24iLCJiQ29tbW9uIiwicHVzaCIsIkRpZmYiLCJESUZGX0VRVUFMIl0sInNvdXJjZXMiOlsiZGlmZkxpbmVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLnByaW50RGlmZkxpbmVzID1cbiAgZXhwb3J0cy5kaWZmTGluZXNVbmlmaWVkMiA9XG4gIGV4cG9ydHMuZGlmZkxpbmVzVW5pZmllZCA9XG4gIGV4cG9ydHMuZGlmZkxpbmVzUmF3ID1cbiAgICB2b2lkIDA7XG52YXIgX2RpZmZTZXF1ZW5jZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoJ2RpZmYtc2VxdWVuY2VzJykpO1xudmFyIF9jbGVhbnVwU2VtYW50aWMgPSByZXF1aXJlKCcuL2NsZWFudXBTZW1hbnRpYycpO1xudmFyIF9qb2luQWxpZ25lZERpZmZzID0gcmVxdWlyZSgnLi9qb2luQWxpZ25lZERpZmZzJyk7XG52YXIgX25vcm1hbGl6ZURpZmZPcHRpb25zID0gcmVxdWlyZSgnLi9ub3JtYWxpemVEaWZmT3B0aW9ucycpO1xuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHtcbiAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHtkZWZhdWx0OiBvYmp9O1xufVxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIE1ldGEgUGxhdGZvcm1zLCBJbmMuIGFuZCBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbmNvbnN0IGlzRW1wdHlTdHJpbmcgPSBsaW5lcyA9PiBsaW5lcy5sZW5ndGggPT09IDEgJiYgbGluZXNbMF0ubGVuZ3RoID09PSAwO1xuY29uc3QgY291bnRDaGFuZ2VzID0gZGlmZnMgPT4ge1xuICBsZXQgYSA9IDA7XG4gIGxldCBiID0gMDtcbiAgZGlmZnMuZm9yRWFjaChkaWZmID0+IHtcbiAgICBzd2l0Y2ggKGRpZmZbMF0pIHtcbiAgICAgIGNhc2UgX2NsZWFudXBTZW1hbnRpYy5ESUZGX0RFTEVURTpcbiAgICAgICAgYSArPSAxO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgX2NsZWFudXBTZW1hbnRpYy5ESUZGX0lOU0VSVDpcbiAgICAgICAgYiArPSAxO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH0pO1xuICByZXR1cm4ge1xuICAgIGEsXG4gICAgYlxuICB9O1xufTtcbmNvbnN0IHByaW50QW5ub3RhdGlvbiA9IChcbiAge1xuICAgIGFBbm5vdGF0aW9uLFxuICAgIGFDb2xvcixcbiAgICBhSW5kaWNhdG9yLFxuICAgIGJBbm5vdGF0aW9uLFxuICAgIGJDb2xvcixcbiAgICBiSW5kaWNhdG9yLFxuICAgIGluY2x1ZGVDaGFuZ2VDb3VudHMsXG4gICAgb21pdEFubm90YXRpb25MaW5lc1xuICB9LFxuICBjaGFuZ2VDb3VudHNcbikgPT4ge1xuICBpZiAob21pdEFubm90YXRpb25MaW5lcykge1xuICAgIHJldHVybiAnJztcbiAgfVxuICBsZXQgYVJlc3QgPSAnJztcbiAgbGV0IGJSZXN0ID0gJyc7XG4gIGlmIChpbmNsdWRlQ2hhbmdlQ291bnRzKSB7XG4gICAgY29uc3QgYUNvdW50ID0gU3RyaW5nKGNoYW5nZUNvdW50cy5hKTtcbiAgICBjb25zdCBiQ291bnQgPSBTdHJpbmcoY2hhbmdlQ291bnRzLmIpO1xuXG4gICAgLy8gUGFkZGluZyByaWdodCBhbGlnbnMgdGhlIGVuZHMgb2YgdGhlIGFubm90YXRpb25zLlxuICAgIGNvbnN0IGJhQW5ub3RhdGlvbkxlbmd0aERpZmYgPSBiQW5ub3RhdGlvbi5sZW5ndGggLSBhQW5ub3RhdGlvbi5sZW5ndGg7XG4gICAgY29uc3QgYUFubm90YXRpb25QYWRkaW5nID0gJyAnLnJlcGVhdChNYXRoLm1heCgwLCBiYUFubm90YXRpb25MZW5ndGhEaWZmKSk7XG4gICAgY29uc3QgYkFubm90YXRpb25QYWRkaW5nID0gJyAnLnJlcGVhdChNYXRoLm1heCgwLCAtYmFBbm5vdGF0aW9uTGVuZ3RoRGlmZikpO1xuXG4gICAgLy8gUGFkZGluZyBsZWZ0IGFsaWducyB0aGUgZW5kcyBvZiB0aGUgY291bnRzLlxuICAgIGNvbnN0IGJhQ291bnRMZW5ndGhEaWZmID0gYkNvdW50Lmxlbmd0aCAtIGFDb3VudC5sZW5ndGg7XG4gICAgY29uc3QgYUNvdW50UGFkZGluZyA9ICcgJy5yZXBlYXQoTWF0aC5tYXgoMCwgYmFDb3VudExlbmd0aERpZmYpKTtcbiAgICBjb25zdCBiQ291bnRQYWRkaW5nID0gJyAnLnJlcGVhdChNYXRoLm1heCgwLCAtYmFDb3VudExlbmd0aERpZmYpKTtcbiAgICBhUmVzdCA9IGAke2FBbm5vdGF0aW9uUGFkZGluZ30gICR7YUluZGljYXRvcn0gJHthQ291bnRQYWRkaW5nfSR7YUNvdW50fWA7XG4gICAgYlJlc3QgPSBgJHtiQW5ub3RhdGlvblBhZGRpbmd9ICAke2JJbmRpY2F0b3J9ICR7YkNvdW50UGFkZGluZ30ke2JDb3VudH1gO1xuICB9XG4gIGNvbnN0IGEgPSBgJHthSW5kaWNhdG9yfSAke2FBbm5vdGF0aW9ufSR7YVJlc3R9YDtcbiAgY29uc3QgYiA9IGAke2JJbmRpY2F0b3J9ICR7YkFubm90YXRpb259JHtiUmVzdH1gO1xuICByZXR1cm4gYCR7YUNvbG9yKGEpfVxcbiR7YkNvbG9yKGIpfVxcblxcbmA7XG59O1xuY29uc3QgcHJpbnREaWZmTGluZXMgPSAoZGlmZnMsIG9wdGlvbnMpID0+XG4gIHByaW50QW5ub3RhdGlvbihvcHRpb25zLCBjb3VudENoYW5nZXMoZGlmZnMpKSArXG4gIChvcHRpb25zLmV4cGFuZFxuICAgID8gKDAsIF9qb2luQWxpZ25lZERpZmZzLmpvaW5BbGlnbmVkRGlmZnNFeHBhbmQpKGRpZmZzLCBvcHRpb25zKVxuICAgIDogKDAsIF9qb2luQWxpZ25lZERpZmZzLmpvaW5BbGlnbmVkRGlmZnNOb0V4cGFuZCkoZGlmZnMsIG9wdGlvbnMpKTtcblxuLy8gQ29tcGFyZSB0d28gYXJyYXlzIG9mIHN0cmluZ3MgbGluZS1ieS1saW5lLiBGb3JtYXQgYXMgY29tcGFyaXNvbiBsaW5lcy5cbmV4cG9ydHMucHJpbnREaWZmTGluZXMgPSBwcmludERpZmZMaW5lcztcbmNvbnN0IGRpZmZMaW5lc1VuaWZpZWQgPSAoYUxpbmVzLCBiTGluZXMsIG9wdGlvbnMpID0+XG4gIHByaW50RGlmZkxpbmVzKFxuICAgIGRpZmZMaW5lc1JhdyhcbiAgICAgIGlzRW1wdHlTdHJpbmcoYUxpbmVzKSA/IFtdIDogYUxpbmVzLFxuICAgICAgaXNFbXB0eVN0cmluZyhiTGluZXMpID8gW10gOiBiTGluZXNcbiAgICApLFxuICAgICgwLCBfbm9ybWFsaXplRGlmZk9wdGlvbnMubm9ybWFsaXplRGlmZk9wdGlvbnMpKG9wdGlvbnMpXG4gICk7XG5cbi8vIEdpdmVuIHR3byBwYWlycyBvZiBhcnJheXMgb2Ygc3RyaW5nczpcbi8vIENvbXBhcmUgdGhlIHBhaXIgb2YgY29tcGFyaXNvbiBhcnJheXMgbGluZS1ieS1saW5lLlxuLy8gRm9ybWF0IHRoZSBjb3JyZXNwb25kaW5nIGxpbmVzIGluIHRoZSBwYWlyIG9mIGRpc3BsYXlhYmxlIGFycmF5cy5cbmV4cG9ydHMuZGlmZkxpbmVzVW5pZmllZCA9IGRpZmZMaW5lc1VuaWZpZWQ7XG5jb25zdCBkaWZmTGluZXNVbmlmaWVkMiA9IChcbiAgYUxpbmVzRGlzcGxheSxcbiAgYkxpbmVzRGlzcGxheSxcbiAgYUxpbmVzQ29tcGFyZSxcbiAgYkxpbmVzQ29tcGFyZSxcbiAgb3B0aW9uc1xuKSA9PiB7XG4gIGlmIChpc0VtcHR5U3RyaW5nKGFMaW5lc0Rpc3BsYXkpICYmIGlzRW1wdHlTdHJpbmcoYUxpbmVzQ29tcGFyZSkpIHtcbiAgICBhTGluZXNEaXNwbGF5ID0gW107XG4gICAgYUxpbmVzQ29tcGFyZSA9IFtdO1xuICB9XG4gIGlmIChpc0VtcHR5U3RyaW5nKGJMaW5lc0Rpc3BsYXkpICYmIGlzRW1wdHlTdHJpbmcoYkxpbmVzQ29tcGFyZSkpIHtcbiAgICBiTGluZXNEaXNwbGF5ID0gW107XG4gICAgYkxpbmVzQ29tcGFyZSA9IFtdO1xuICB9XG4gIGlmIChcbiAgICBhTGluZXNEaXNwbGF5Lmxlbmd0aCAhPT0gYUxpbmVzQ29tcGFyZS5sZW5ndGggfHxcbiAgICBiTGluZXNEaXNwbGF5Lmxlbmd0aCAhPT0gYkxpbmVzQ29tcGFyZS5sZW5ndGhcbiAgKSB7XG4gICAgLy8gRmFsbCBiYWNrIHRvIGRpZmYgb2YgZGlzcGxheSBsaW5lcy5cbiAgICByZXR1cm4gZGlmZkxpbmVzVW5pZmllZChhTGluZXNEaXNwbGF5LCBiTGluZXNEaXNwbGF5LCBvcHRpb25zKTtcbiAgfVxuICBjb25zdCBkaWZmcyA9IGRpZmZMaW5lc1JhdyhhTGluZXNDb21wYXJlLCBiTGluZXNDb21wYXJlKTtcblxuICAvLyBSZXBsYWNlIGNvbXBhcmlzb24gbGluZXMgd2l0aCBkaXNwbGF5YWJsZSBsaW5lcy5cbiAgbGV0IGFJbmRleCA9IDA7XG4gIGxldCBiSW5kZXggPSAwO1xuICBkaWZmcy5mb3JFYWNoKGRpZmYgPT4ge1xuICAgIHN3aXRjaCAoZGlmZlswXSkge1xuICAgICAgY2FzZSBfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFOlxuICAgICAgICBkaWZmWzFdID0gYUxpbmVzRGlzcGxheVthSW5kZXhdO1xuICAgICAgICBhSW5kZXggKz0gMTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIF9jbGVhbnVwU2VtYW50aWMuRElGRl9JTlNFUlQ6XG4gICAgICAgIGRpZmZbMV0gPSBiTGluZXNEaXNwbGF5W2JJbmRleF07XG4gICAgICAgIGJJbmRleCArPSAxO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGRpZmZbMV0gPSBiTGluZXNEaXNwbGF5W2JJbmRleF07XG4gICAgICAgIGFJbmRleCArPSAxO1xuICAgICAgICBiSW5kZXggKz0gMTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcHJpbnREaWZmTGluZXMoXG4gICAgZGlmZnMsXG4gICAgKDAsIF9ub3JtYWxpemVEaWZmT3B0aW9ucy5ub3JtYWxpemVEaWZmT3B0aW9ucykob3B0aW9ucylcbiAgKTtcbn07XG5cbi8vIENvbXBhcmUgdHdvIGFycmF5cyBvZiBzdHJpbmdzIGxpbmUtYnktbGluZS5cbmV4cG9ydHMuZGlmZkxpbmVzVW5pZmllZDIgPSBkaWZmTGluZXNVbmlmaWVkMjtcbmNvbnN0IGRpZmZMaW5lc1JhdyA9IChhTGluZXMsIGJMaW5lcykgPT4ge1xuICBjb25zdCBhTGVuZ3RoID0gYUxpbmVzLmxlbmd0aDtcbiAgY29uc3QgYkxlbmd0aCA9IGJMaW5lcy5sZW5ndGg7XG4gIGNvbnN0IGlzQ29tbW9uID0gKGFJbmRleCwgYkluZGV4KSA9PiBhTGluZXNbYUluZGV4XSA9PT0gYkxpbmVzW2JJbmRleF07XG4gIGNvbnN0IGRpZmZzID0gW107XG4gIGxldCBhSW5kZXggPSAwO1xuICBsZXQgYkluZGV4ID0gMDtcbiAgY29uc3QgZm91bmRTdWJzZXF1ZW5jZSA9IChuQ29tbW9uLCBhQ29tbW9uLCBiQ29tbW9uKSA9PiB7XG4gICAgZm9yICg7IGFJbmRleCAhPT0gYUNvbW1vbjsgYUluZGV4ICs9IDEpIHtcbiAgICAgIGRpZmZzLnB1c2goXG4gICAgICAgIG5ldyBfY2xlYW51cFNlbWFudGljLkRpZmYoX2NsZWFudXBTZW1hbnRpYy5ESUZGX0RFTEVURSwgYUxpbmVzW2FJbmRleF0pXG4gICAgICApO1xuICAgIH1cbiAgICBmb3IgKDsgYkluZGV4ICE9PSBiQ29tbW9uOyBiSW5kZXggKz0gMSkge1xuICAgICAgZGlmZnMucHVzaChcbiAgICAgICAgbmV3IF9jbGVhbnVwU2VtYW50aWMuRGlmZihfY2xlYW51cFNlbWFudGljLkRJRkZfSU5TRVJULCBiTGluZXNbYkluZGV4XSlcbiAgICAgICk7XG4gICAgfVxuICAgIGZvciAoOyBuQ29tbW9uICE9PSAwOyBuQ29tbW9uIC09IDEsIGFJbmRleCArPSAxLCBiSW5kZXggKz0gMSkge1xuICAgICAgZGlmZnMucHVzaChcbiAgICAgICAgbmV3IF9jbGVhbnVwU2VtYW50aWMuRGlmZihfY2xlYW51cFNlbWFudGljLkRJRkZfRVFVQUwsIGJMaW5lc1tiSW5kZXhdKVxuICAgICAgKTtcbiAgICB9XG4gIH07XG4gICgwLCBfZGlmZlNlcXVlbmNlcy5kZWZhdWx0KShhTGVuZ3RoLCBiTGVuZ3RoLCBpc0NvbW1vbiwgZm91bmRTdWJzZXF1ZW5jZSk7XG5cbiAgLy8gQWZ0ZXIgdGhlIGxhc3QgY29tbW9uIHN1YnNlcXVlbmNlLCBwdXNoIHJlbWFpbmluZyBjaGFuZ2UgaXRlbXMuXG4gIGZvciAoOyBhSW5kZXggIT09IGFMZW5ndGg7IGFJbmRleCArPSAxKSB7XG4gICAgZGlmZnMucHVzaChcbiAgICAgIG5ldyBfY2xlYW51cFNlbWFudGljLkRpZmYoX2NsZWFudXBTZW1hbnRpYy5ESUZGX0RFTEVURSwgYUxpbmVzW2FJbmRleF0pXG4gICAgKTtcbiAgfVxuICBmb3IgKDsgYkluZGV4ICE9PSBiTGVuZ3RoOyBiSW5kZXggKz0gMSkge1xuICAgIGRpZmZzLnB1c2goXG4gICAgICBuZXcgX2NsZWFudXBTZW1hbnRpYy5EaWZmKF9jbGVhbnVwU2VtYW50aWMuRElGRl9JTlNFUlQsIGJMaW5lc1tiSW5kZXhdKVxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGRpZmZzO1xufTtcbmV4cG9ydHMuZGlmZkxpbmVzUmF3ID0gZGlmZkxpbmVzUmF3O1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaQSxNQUFNLENBQUNDLGNBQWMsQ0FBQ0MsT0FBTyxFQUFFLFlBQVksRUFBRTtFQUMzQ0MsS0FBSyxFQUFFO0FBQ1QsQ0FBQyxDQUFDO0FBQ0ZELE9BQU8sQ0FBQ0UsY0FBYyxHQUNwQkYsT0FBTyxDQUFDRyxpQkFBaUIsR0FDekJILE9BQU8sQ0FBQ0ksZ0JBQWdCLEdBQ3hCSixPQUFPLENBQUNLLFlBQVksR0FDbEIsS0FBSyxDQUFDO0FBQ1YsSUFBSUMsY0FBYyxHQUFHQyxzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFDdEUsSUFBSUMsZ0JBQWdCLEdBQUdELE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUNuRCxJQUFJRSxpQkFBaUIsR0FBR0YsT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBQ3JELElBQUlHLHFCQUFxQixHQUFHSCxPQUFPLENBQUMsd0JBQXdCLENBQUM7QUFDN0QsU0FBU0Qsc0JBQXNCQSxDQUFDSyxHQUFHLEVBQUU7RUFDbkMsT0FBT0EsR0FBRyxJQUFJQSxHQUFHLENBQUNDLFVBQVUsR0FBR0QsR0FBRyxHQUFHO0lBQUNFLE9BQU8sRUFBRUY7RUFBRyxDQUFDO0FBQ3JEO0FBUUEsSUFBTUcsYUFBYSxHQUFHLFNBQWhCQSxhQUFhQSxDQUFHQyxLQUFLO0VBQUEsT0FBSUEsS0FBSyxDQUFDQyxNQUFNLEtBQUssQ0FBQyxJQUFJRCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUNDLE1BQU0sS0FBSyxDQUFDO0FBQUE7QUFDMUUsSUFBTUMsWUFBWSxHQUFHLFNBQWZBLFlBQVlBLENBQUdDLEtBQUssRUFBSTtFQUM1QixJQUFJQyxDQUFDLEdBQUcsQ0FBQztFQUNULElBQUlDLENBQUMsR0FBRyxDQUFDO0VBQ1RGLEtBQUssQ0FBQ0csT0FBTyxDQUFDLFVBQUFDLElBQUksRUFBSTtJQUNwQixRQUFRQSxJQUFJLENBQUMsQ0FBQyxDQUFDO01BQ2IsS0FBS2QsZ0JBQWdCLENBQUNlLFdBQVc7UUFDL0JKLENBQUMsSUFBSSxDQUFDO1FBQ047TUFDRixLQUFLWCxnQkFBZ0IsQ0FBQ2dCLFdBQVc7UUFDL0JKLENBQUMsSUFBSSxDQUFDO1FBQ047SUFDSjtFQUNGLENBQUMsQ0FBQztFQUNGLE9BQU87SUFDTEQsQ0FBQyxFQUFEQSxDQUFDO0lBQ0RDLENBQUMsRUFBREE7RUFDRixDQUFDO0FBQ0gsQ0FBQztBQUNELElBQU1LLGVBQWUsR0FBRyxTQUFsQkEsZUFBZUEsQ0FBQUMsSUFBQSxFQVduQkMsWUFBWSxFQUNUO0VBQUEsSUFWREMsV0FBVyxHQUFBRixJQUFBLENBQVhFLFdBQVc7SUFDWEMsTUFBTSxHQUFBSCxJQUFBLENBQU5HLE1BQU07SUFDTkMsVUFBVSxHQUFBSixJQUFBLENBQVZJLFVBQVU7SUFDVkMsV0FBVyxHQUFBTCxJQUFBLENBQVhLLFdBQVc7SUFDWEMsTUFBTSxHQUFBTixJQUFBLENBQU5NLE1BQU07SUFDTkMsVUFBVSxHQUFBUCxJQUFBLENBQVZPLFVBQVU7SUFDVkMsbUJBQW1CLEdBQUFSLElBQUEsQ0FBbkJRLG1CQUFtQjtJQUNuQkMsbUJBQW1CLEdBQUFULElBQUEsQ0FBbkJTLG1CQUFtQjtFQUlyQixJQUFJQSxtQkFBbUIsRUFBRTtJQUN2QixPQUFPLEVBQUU7RUFDWDtFQUNBLElBQUlDLEtBQUssR0FBRyxFQUFFO0VBQ2QsSUFBSUMsS0FBSyxHQUFHLEVBQUU7RUFDZCxJQUFJSCxtQkFBbUIsRUFBRTtJQUN2QixJQUFNSSxNQUFNLEdBQUdDLE1BQU0sQ0FBQ1osWUFBWSxDQUFDUixDQUFDLENBQUM7SUFDckMsSUFBTXFCLE1BQU0sR0FBR0QsTUFBTSxDQUFDWixZQUFZLENBQUNQLENBQUMsQ0FBQztJQUdyQyxJQUFNcUIsc0JBQXNCLEdBQUdWLFdBQVcsQ0FBQ2YsTUFBTSxHQUFHWSxXQUFXLENBQUNaLE1BQU07SUFDdEUsSUFBTTBCLGtCQUFrQixHQUFHLEdBQUcsQ0FBQ0MsTUFBTSxDQUFDQyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEVBQUVKLHNCQUFzQixDQUFDLENBQUM7SUFDMUUsSUFBTUssa0JBQWtCLEdBQUcsR0FBRyxDQUFDSCxNQUFNLENBQUNDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDSixzQkFBc0IsQ0FBQyxDQUFDO0lBRzNFLElBQU1NLGlCQUFpQixHQUFHUCxNQUFNLENBQUN4QixNQUFNLEdBQUdzQixNQUFNLENBQUN0QixNQUFNO0lBQ3ZELElBQU1nQyxhQUFhLEdBQUcsR0FBRyxDQUFDTCxNQUFNLENBQUNDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRUUsaUJBQWlCLENBQUMsQ0FBQztJQUNoRSxJQUFNRSxhQUFhLEdBQUcsR0FBRyxDQUFDTixNQUFNLENBQUNDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDRSxpQkFBaUIsQ0FBQyxDQUFDO0lBQ2pFWCxLQUFLLEdBQUksR0FBRU0sa0JBQW1CLEtBQUlaLFVBQVcsSUFBR2tCLGFBQWMsR0FBRVYsTUFBTyxFQUFDO0lBQ3hFRCxLQUFLLEdBQUksR0FBRVMsa0JBQW1CLEtBQUliLFVBQVcsSUFBR2dCLGFBQWMsR0FBRVQsTUFBTyxFQUFDO0VBQzFFO0VBQ0EsSUFBTXJCLENBQUMsR0FBSSxHQUFFVyxVQUFXLElBQUdGLFdBQVksR0FBRVEsS0FBTSxFQUFDO0VBQ2hELElBQU1oQixDQUFDLEdBQUksR0FBRWEsVUFBVyxJQUFHRixXQUFZLEdBQUVNLEtBQU0sRUFBQztFQUNoRCxPQUFRLEdBQUVSLE1BQU0sQ0FBQ1YsQ0FBQyxDQUFFLEtBQUlhLE1BQU0sQ0FBQ1osQ0FBQyxDQUFFLE1BQUs7QUFDekMsQ0FBQztBQUNELElBQU1uQixjQUFjLEdBQUcsU0FBakJBLGNBQWNBLENBQUlpQixLQUFLLEVBQUVnQyxPQUFPO0VBQUEsT0FDcEN6QixlQUFlLENBQUN5QixPQUFPLEVBQUVqQyxZQUFZLENBQUNDLEtBQUssQ0FBQyxDQUFDLElBQzVDZ0MsT0FBTyxDQUFDQyxNQUFNLEdBQ1gsQ0FBQyxDQUFDLEVBQUUxQyxpQkFBaUIsQ0FBQzJDLHNCQUFzQixFQUFFbEMsS0FBSyxFQUFFZ0MsT0FBTyxDQUFDLEdBQzdELENBQUMsQ0FBQyxFQUFFekMsaUJBQWlCLENBQUM0Qyx3QkFBd0IsRUFBRW5DLEtBQUssRUFBRWdDLE9BQU8sQ0FBQyxDQUFDO0FBQUE7QUFHdEVuRCxPQUFPLENBQUNFLGNBQWMsR0FBR0EsY0FBYztBQUN2QyxJQUFNRSxnQkFBZ0IsR0FBRyxTQUFuQkEsZ0JBQWdCQSxDQUFJbUQsTUFBTSxFQUFFQyxNQUFNLEVBQUVMLE9BQU87RUFBQSxPQUMvQ2pELGNBQWMsQ0FDWkcsWUFBWSxDQUNWVSxhQUFhLENBQUN3QyxNQUFNLENBQUMsR0FBRyxFQUFFLEdBQUdBLE1BQU0sRUFDbkN4QyxhQUFhLENBQUN5QyxNQUFNLENBQUMsR0FBRyxFQUFFLEdBQUdBLE1BQy9CLENBQUMsRUFDRCxDQUFDLENBQUMsRUFBRTdDLHFCQUFxQixDQUFDOEMsb0JBQW9CLEVBQUVOLE9BQU8sQ0FDekQsQ0FBQztBQUFBO0FBS0huRCxPQUFPLENBQUNJLGdCQUFnQixHQUFHQSxnQkFBZ0I7QUFDM0MsSUFBTUQsaUJBQWlCLEdBQUcsU0FBcEJBLGlCQUFpQkEsQ0FDckJ1RCxhQUFhLEVBQ2JDLGFBQWEsRUFDYkMsYUFBYSxFQUNiQyxhQUFhLEVBQ2JWLE9BQU8sRUFDSjtFQUNILElBQUlwQyxhQUFhLENBQUMyQyxhQUFhLENBQUMsSUFBSTNDLGFBQWEsQ0FBQzZDLGFBQWEsQ0FBQyxFQUFFO0lBQ2hFRixhQUFhLEdBQUcsRUFBRTtJQUNsQkUsYUFBYSxHQUFHLEVBQUU7RUFDcEI7RUFDQSxJQUFJN0MsYUFBYSxDQUFDNEMsYUFBYSxDQUFDLElBQUk1QyxhQUFhLENBQUM4QyxhQUFhLENBQUMsRUFBRTtJQUNoRUYsYUFBYSxHQUFHLEVBQUU7SUFDbEJFLGFBQWEsR0FBRyxFQUFFO0VBQ3BCO0VBQ0EsSUFDRUgsYUFBYSxDQUFDekMsTUFBTSxLQUFLMkMsYUFBYSxDQUFDM0MsTUFBTSxJQUM3QzBDLGFBQWEsQ0FBQzFDLE1BQU0sS0FBSzRDLGFBQWEsQ0FBQzVDLE1BQU0sRUFDN0M7SUFFQSxPQUFPYixnQkFBZ0IsQ0FBQ3NELGFBQWEsRUFBRUMsYUFBYSxFQUFFUixPQUFPLENBQUM7RUFDaEU7RUFDQSxJQUFNaEMsS0FBSyxHQUFHZCxZQUFZLENBQUN1RCxhQUFhLEVBQUVDLGFBQWEsQ0FBQztFQUd4RCxJQUFJQyxNQUFNLEdBQUcsQ0FBQztFQUNkLElBQUlDLE1BQU0sR0FBRyxDQUFDO0VBQ2Q1QyxLQUFLLENBQUNHLE9BQU8sQ0FBQyxVQUFBQyxJQUFJLEVBQUk7SUFDcEIsUUFBUUEsSUFBSSxDQUFDLENBQUMsQ0FBQztNQUNiLEtBQUtkLGdCQUFnQixDQUFDZSxXQUFXO1FBQy9CRCxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUdtQyxhQUFhLENBQUNJLE1BQU0sQ0FBQztRQUMvQkEsTUFBTSxJQUFJLENBQUM7UUFDWDtNQUNGLEtBQUtyRCxnQkFBZ0IsQ0FBQ2dCLFdBQVc7UUFDL0JGLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBR29DLGFBQWEsQ0FBQ0ksTUFBTSxDQUFDO1FBQy9CQSxNQUFNLElBQUksQ0FBQztRQUNYO01BQ0Y7UUFDRXhDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBR29DLGFBQWEsQ0FBQ0ksTUFBTSxDQUFDO1FBQy9CRCxNQUFNLElBQUksQ0FBQztRQUNYQyxNQUFNLElBQUksQ0FBQztJQUNmO0VBQ0YsQ0FBQyxDQUFDO0VBQ0YsT0FBTzdELGNBQWMsQ0FDbkJpQixLQUFLLEVBQ0wsQ0FBQyxDQUFDLEVBQUVSLHFCQUFxQixDQUFDOEMsb0JBQW9CLEVBQUVOLE9BQU8sQ0FDekQsQ0FBQztBQUNILENBQUM7QUFHRG5ELE9BQU8sQ0FBQ0csaUJBQWlCLEdBQUdBLGlCQUFpQjtBQUM3QyxJQUFNRSxZQUFZLEdBQUcsU0FBZkEsWUFBWUEsQ0FBSWtELE1BQU0sRUFBRUMsTUFBTSxFQUFLO0VBQ3ZDLElBQU1RLE9BQU8sR0FBR1QsTUFBTSxDQUFDdEMsTUFBTTtFQUM3QixJQUFNZ0QsT0FBTyxHQUFHVCxNQUFNLENBQUN2QyxNQUFNO0VBQzdCLElBQU1pRCxRQUFRLEdBQUcsU0FBWEEsUUFBUUEsQ0FBSUosTUFBTSxFQUFFQyxNQUFNO0lBQUEsT0FBS1IsTUFBTSxDQUFDTyxNQUFNLENBQUMsS0FBS04sTUFBTSxDQUFDTyxNQUFNLENBQUM7RUFBQTtFQUN0RSxJQUFNNUMsS0FBSyxHQUFHLEVBQUU7RUFDaEIsSUFBSTJDLE1BQU0sR0FBRyxDQUFDO0VBQ2QsSUFBSUMsTUFBTSxHQUFHLENBQUM7RUFDZCxJQUFNSSxnQkFBZ0IsR0FBRyxTQUFuQkEsZ0JBQWdCQSxDQUFJQyxPQUFPLEVBQUVDLE9BQU8sRUFBRUMsT0FBTyxFQUFLO0lBQ3RELE9BQU9SLE1BQU0sS0FBS08sT0FBTyxFQUFFUCxNQUFNLElBQUksQ0FBQyxFQUFFO01BQ3RDM0MsS0FBSyxDQUFDb0QsSUFBSSxDQUNSLElBQUk5RCxnQkFBZ0IsQ0FBQytELElBQUksQ0FBQy9ELGdCQUFnQixDQUFDZSxXQUFXLEVBQUUrQixNQUFNLENBQUNPLE1BQU0sQ0FBQyxDQUN4RSxDQUFDO0lBQ0g7SUFDQSxPQUFPQyxNQUFNLEtBQUtPLE9BQU8sRUFBRVAsTUFBTSxJQUFJLENBQUMsRUFBRTtNQUN0QzVDLEtBQUssQ0FBQ29ELElBQUksQ0FDUixJQUFJOUQsZ0JBQWdCLENBQUMrRCxJQUFJLENBQUMvRCxnQkFBZ0IsQ0FBQ2dCLFdBQVcsRUFBRStCLE1BQU0sQ0FBQ08sTUFBTSxDQUFDLENBQ3hFLENBQUM7SUFDSDtJQUNBLE9BQU9LLE9BQU8sS0FBSyxDQUFDLEVBQUVBLE9BQU8sSUFBSSxDQUFDLEVBQUVOLE1BQU0sSUFBSSxDQUFDLEVBQUVDLE1BQU0sSUFBSSxDQUFDLEVBQUU7TUFDNUQ1QyxLQUFLLENBQUNvRCxJQUFJLENBQ1IsSUFBSTlELGdCQUFnQixDQUFDK0QsSUFBSSxDQUFDL0QsZ0JBQWdCLENBQUNnRSxVQUFVLEVBQUVqQixNQUFNLENBQUNPLE1BQU0sQ0FBQyxDQUN2RSxDQUFDO0lBQ0g7RUFDRixDQUFDO0VBQ0QsQ0FBQyxDQUFDLEVBQUV6RCxjQUFjLENBQUNRLE9BQU8sRUFBRWtELE9BQU8sRUFBRUMsT0FBTyxFQUFFQyxRQUFRLEVBQUVDLGdCQUFnQixDQUFDO0VBR3pFLE9BQU9MLE1BQU0sS0FBS0UsT0FBTyxFQUFFRixNQUFNLElBQUksQ0FBQyxFQUFFO0lBQ3RDM0MsS0FBSyxDQUFDb0QsSUFBSSxDQUNSLElBQUk5RCxnQkFBZ0IsQ0FBQytELElBQUksQ0FBQy9ELGdCQUFnQixDQUFDZSxXQUFXLEVBQUUrQixNQUFNLENBQUNPLE1BQU0sQ0FBQyxDQUN4RSxDQUFDO0VBQ0g7RUFDQSxPQUFPQyxNQUFNLEtBQUtFLE9BQU8sRUFBRUYsTUFBTSxJQUFJLENBQUMsRUFBRTtJQUN0QzVDLEtBQUssQ0FBQ29ELElBQUksQ0FDUixJQUFJOUQsZ0JBQWdCLENBQUMrRCxJQUFJLENBQUMvRCxnQkFBZ0IsQ0FBQ2dCLFdBQVcsRUFBRStCLE1BQU0sQ0FBQ08sTUFBTSxDQUFDLENBQ3hFLENBQUM7RUFDSDtFQUNBLE9BQU81QyxLQUFLO0FBQ2QsQ0FBQztBQUNEbkIsT0FBTyxDQUFDSyxZQUFZLEdBQUdBLFlBQVkiLCJpZ25vcmVMaXN0IjpbXX0=