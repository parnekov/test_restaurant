b572aed9ad80783e83fbeea56d59735c
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _ListMetricsAggregator = _interopRequireDefault(require("./ListMetricsAggregator"));
var invariant = require('invariant');
var ViewabilityHelper = function () {
  function ViewabilityHelper() {
    var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
      viewAreaCoveragePercentThreshold: 0
    };
    (0, _classCallCheck2.default)(this, ViewabilityHelper);
    this._hasInteracted = false;
    this._timers = new Set();
    this._viewableIndices = [];
    this._viewableItems = new Map();
    this._config = config;
  }
  return (0, _createClass2.default)(ViewabilityHelper, [{
    key: "dispose",
    value: function dispose() {
      this._timers.forEach(clearTimeout);
    }
  }, {
    key: "computeViewableItems",
    value: function computeViewableItems(props, scrollOffset, viewportHeight, listMetrics, renderRange) {
      var itemCount = props.getItemCount(props.data);
      var _this$_config = this._config,
        itemVisiblePercentThreshold = _this$_config.itemVisiblePercentThreshold,
        viewAreaCoveragePercentThreshold = _this$_config.viewAreaCoveragePercentThreshold;
      var viewAreaMode = viewAreaCoveragePercentThreshold != null;
      var viewablePercentThreshold = viewAreaMode ? viewAreaCoveragePercentThreshold : itemVisiblePercentThreshold;
      invariant(viewablePercentThreshold != null && itemVisiblePercentThreshold != null !== (viewAreaCoveragePercentThreshold != null), 'Must set exactly one of itemVisiblePercentThreshold or viewAreaCoveragePercentThreshold');
      var viewableIndices = [];
      if (itemCount === 0) {
        return viewableIndices;
      }
      var firstVisible = -1;
      var _ref = renderRange || {
          first: 0,
          last: itemCount - 1
        },
        first = _ref.first,
        last = _ref.last;
      if (last >= itemCount) {
        console.warn('Invalid render range computing viewability ' + JSON.stringify({
          renderRange: renderRange,
          itemCount: itemCount
        }));
        return [];
      }
      for (var idx = first; idx <= last; idx++) {
        var metrics = listMetrics.getCellMetrics(idx, props);
        if (!metrics) {
          continue;
        }
        var top = Math.floor(metrics.offset - scrollOffset);
        var bottom = Math.floor(top + metrics.length);
        if (top < viewportHeight && bottom > 0) {
          firstVisible = idx;
          if (_isViewable(viewAreaMode, viewablePercentThreshold, top, bottom, viewportHeight, metrics.length)) {
            viewableIndices.push(idx);
          }
        } else if (firstVisible >= 0) {
          break;
        }
      }
      return viewableIndices;
    }
  }, {
    key: "onUpdate",
    value: function onUpdate(props, scrollOffset, viewportHeight, listMetrics, createViewToken, onViewableItemsChanged, renderRange) {
      var _this = this;
      var itemCount = props.getItemCount(props.data);
      if (this._config.waitForInteraction && !this._hasInteracted || itemCount === 0 || !listMetrics.getCellMetrics(0, props)) {
        return;
      }
      var viewableIndices = [];
      if (itemCount) {
        viewableIndices = this.computeViewableItems(props, scrollOffset, viewportHeight, listMetrics, renderRange);
      }
      if (this._viewableIndices.length === viewableIndices.length && this._viewableIndices.every(function (v, ii) {
        return v === viewableIndices[ii];
      })) {
        return;
      }
      this._viewableIndices = viewableIndices;
      if (this._config.minimumViewTime) {
        var handle = setTimeout(function () {
          _this._timers.delete(handle);
          _this._onUpdateSync(props, viewableIndices, onViewableItemsChanged, createViewToken);
        }, this._config.minimumViewTime);
        this._timers.add(handle);
      } else {
        this._onUpdateSync(props, viewableIndices, onViewableItemsChanged, createViewToken);
      }
    }
  }, {
    key: "resetViewableIndices",
    value: function resetViewableIndices() {
      this._viewableIndices = [];
    }
  }, {
    key: "recordInteraction",
    value: function recordInteraction() {
      this._hasInteracted = true;
    }
  }, {
    key: "_onUpdateSync",
    value: function _onUpdateSync(props, viewableIndicesToCheck, onViewableItemsChanged, createViewToken) {
      var _this2 = this;
      viewableIndicesToCheck = viewableIndicesToCheck.filter(function (ii) {
        return _this2._viewableIndices.includes(ii);
      });
      var prevItems = this._viewableItems;
      var nextItems = new Map(viewableIndicesToCheck.map(function (ii) {
        var viewable = createViewToken(ii, true, props);
        return [viewable.key, viewable];
      }));
      var changed = [];
      for (var _ref2 of nextItems) {
        var _ref3 = (0, _slicedToArray2.default)(_ref2, 2);
        var key = _ref3[0];
        var viewable = _ref3[1];
        if (!prevItems.has(key)) {
          changed.push(viewable);
        }
      }
      for (var _ref4 of prevItems) {
        var _ref5 = (0, _slicedToArray2.default)(_ref4, 2);
        var _key = _ref5[0];
        var _viewable = _ref5[1];
        if (!nextItems.has(_key)) {
          changed.push(Object.assign({}, _viewable, {
            isViewable: false
          }));
        }
      }
      if (changed.length > 0) {
        this._viewableItems = nextItems;
        onViewableItemsChanged({
          viewableItems: Array.from(nextItems.values()),
          changed: changed,
          viewabilityConfig: this._config
        });
      }
    }
  }]);
}();
function _isViewable(viewAreaMode, viewablePercentThreshold, top, bottom, viewportHeight, itemLength) {
  if (_isEntirelyVisible(top, bottom, viewportHeight)) {
    return true;
  } else {
    var pixels = _getPixelsVisible(top, bottom, viewportHeight);
    var percent = 100 * (viewAreaMode ? pixels / viewportHeight : pixels / itemLength);
    return percent >= viewablePercentThreshold;
  }
}
function _getPixelsVisible(top, bottom, viewportHeight) {
  var visibleHeight = Math.min(bottom, viewportHeight) - Math.max(top, 0);
  return Math.max(0, visibleHeight);
}
function _isEntirelyVisible(top, bottom, viewportHeight) {
  return top >= 0 && bottom <= viewportHeight && bottom > top;
}
module.exports = ViewabilityHelper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9zbGljZWRUb0FycmF5MiIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiX0xpc3RNZXRyaWNzQWdncmVnYXRvciIsImludmFyaWFudCIsIlZpZXdhYmlsaXR5SGVscGVyIiwiY29uZmlnIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwidmlld0FyZWFDb3ZlcmFnZVBlcmNlbnRUaHJlc2hvbGQiLCJkZWZhdWx0IiwiX2hhc0ludGVyYWN0ZWQiLCJfdGltZXJzIiwiU2V0IiwiX3ZpZXdhYmxlSW5kaWNlcyIsIl92aWV3YWJsZUl0ZW1zIiwiTWFwIiwiX2NvbmZpZyIsImtleSIsInZhbHVlIiwiZGlzcG9zZSIsImZvckVhY2giLCJjbGVhclRpbWVvdXQiLCJjb21wdXRlVmlld2FibGVJdGVtcyIsInByb3BzIiwic2Nyb2xsT2Zmc2V0Iiwidmlld3BvcnRIZWlnaHQiLCJsaXN0TWV0cmljcyIsInJlbmRlclJhbmdlIiwiaXRlbUNvdW50IiwiZ2V0SXRlbUNvdW50IiwiZGF0YSIsIl90aGlzJF9jb25maWciLCJpdGVtVmlzaWJsZVBlcmNlbnRUaHJlc2hvbGQiLCJ2aWV3QXJlYU1vZGUiLCJ2aWV3YWJsZVBlcmNlbnRUaHJlc2hvbGQiLCJ2aWV3YWJsZUluZGljZXMiLCJmaXJzdFZpc2libGUiLCJfcmVmIiwiZmlyc3QiLCJsYXN0IiwiY29uc29sZSIsIndhcm4iLCJKU09OIiwic3RyaW5naWZ5IiwiaWR4IiwibWV0cmljcyIsImdldENlbGxNZXRyaWNzIiwidG9wIiwiTWF0aCIsImZsb29yIiwib2Zmc2V0IiwiYm90dG9tIiwiX2lzVmlld2FibGUiLCJwdXNoIiwib25VcGRhdGUiLCJjcmVhdGVWaWV3VG9rZW4iLCJvblZpZXdhYmxlSXRlbXNDaGFuZ2VkIiwiX3RoaXMiLCJ3YWl0Rm9ySW50ZXJhY3Rpb24iLCJldmVyeSIsInYiLCJpaSIsIm1pbmltdW1WaWV3VGltZSIsImhhbmRsZSIsInNldFRpbWVvdXQiLCJkZWxldGUiLCJfb25VcGRhdGVTeW5jIiwiYWRkIiwicmVzZXRWaWV3YWJsZUluZGljZXMiLCJyZWNvcmRJbnRlcmFjdGlvbiIsInZpZXdhYmxlSW5kaWNlc1RvQ2hlY2siLCJfdGhpczIiLCJmaWx0ZXIiLCJpbmNsdWRlcyIsInByZXZJdGVtcyIsIm5leHRJdGVtcyIsIm1hcCIsInZpZXdhYmxlIiwiY2hhbmdlZCIsIl9yZWYyIiwiX3JlZjMiLCJoYXMiLCJfcmVmNCIsIl9yZWY1IiwiT2JqZWN0IiwiYXNzaWduIiwiaXNWaWV3YWJsZSIsInZpZXdhYmxlSXRlbXMiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJ2aWV3YWJpbGl0eUNvbmZpZyIsIml0ZW1MZW5ndGgiLCJfaXNFbnRpcmVseVZpc2libGUiLCJwaXhlbHMiLCJfZ2V0UGl4ZWxzVmlzaWJsZSIsInBlcmNlbnQiLCJ2aXNpYmxlSGVpZ2h0IiwibWluIiwibWF4IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIlZpZXdhYmlsaXR5SGVscGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHR5cGUge0NlbGxNZXRyaWNQcm9wc30gZnJvbSAnLi9MaXN0TWV0cmljc0FnZ3JlZ2F0b3InO1xuXG5pbXBvcnQgTGlzdE1ldHJpY3NBZ2dyZWdhdG9yIGZyb20gJy4vTGlzdE1ldHJpY3NBZ2dyZWdhdG9yJztcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5cbmV4cG9ydCB0eXBlIFZpZXdUb2tlbiA9IHtcbiAgaXRlbTogYW55LFxuICBrZXk6IHN0cmluZyxcbiAgaW5kZXg6ID9udW1iZXIsXG4gIGlzVmlld2FibGU6IGJvb2xlYW4sXG4gIHNlY3Rpb24/OiBhbnksXG4gIC4uLlxufTtcblxuZXhwb3J0IHR5cGUgVmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXIgPSB7XG4gIHZpZXdhYmlsaXR5Q29uZmlnOiBWaWV3YWJpbGl0eUNvbmZpZyxcbiAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZDogKGluZm86IHtcbiAgICB2aWV3YWJsZUl0ZW1zOiBBcnJheTxWaWV3VG9rZW4+LFxuICAgIGNoYW5nZWQ6IEFycmF5PFZpZXdUb2tlbj4sXG4gICAgLi4uXG4gIH0pID0+IHZvaWQsXG4gIC4uLlxufTtcblxuZXhwb3J0IHR5cGUgVmlld2FiaWxpdHlDb25maWcgPSB7fFxuICAvKipcbiAgICogTWluaW11bSBhbW91bnQgb2YgdGltZSAoaW4gbWlsbGlzZWNvbmRzKSB0aGF0IGFuIGl0ZW0gbXVzdCBiZSBwaHlzaWNhbGx5IHZpZXdhYmxlIGJlZm9yZSB0aGVcbiAgICogdmlld2FiaWxpdHkgY2FsbGJhY2sgd2lsbCBiZSBmaXJlZC4gQSBoaWdoIG51bWJlciBtZWFucyB0aGF0IHNjcm9sbGluZyB0aHJvdWdoIGNvbnRlbnQgd2l0aG91dFxuICAgKiBzdG9wcGluZyB3aWxsIG5vdCBtYXJrIHRoZSBjb250ZW50IGFzIHZpZXdhYmxlLlxuICAgKi9cbiAgbWluaW11bVZpZXdUaW1lPzogbnVtYmVyLFxuXG4gIC8qKlxuICAgKiBQZXJjZW50IG9mIHZpZXdwb3J0IHRoYXQgbXVzdCBiZSBjb3ZlcmVkIGZvciBhIHBhcnRpYWxseSBvY2NsdWRlZCBpdGVtIHRvIGNvdW50IGFzXG4gICAqIFwidmlld2FibGVcIiwgMC0xMDAuIEZ1bGx5IHZpc2libGUgaXRlbXMgYXJlIGFsd2F5cyBjb25zaWRlcmVkIHZpZXdhYmxlLiBBIHZhbHVlIG9mIDAgbWVhbnNcbiAgICogdGhhdCBhIHNpbmdsZSBwaXhlbCBpbiB0aGUgdmlld3BvcnQgbWFrZXMgdGhlIGl0ZW0gdmlld2FibGUsIGFuZCBhIHZhbHVlIG9mIDEwMCBtZWFucyB0aGF0XG4gICAqIGFuIGl0ZW0gbXVzdCBiZSBlaXRoZXIgZW50aXJlbHkgdmlzaWJsZSBvciBjb3ZlciB0aGUgZW50aXJlIHZpZXdwb3J0IHRvIGNvdW50IGFzIHZpZXdhYmxlLlxuICAgKi9cbiAgdmlld0FyZWFDb3ZlcmFnZVBlcmNlbnRUaHJlc2hvbGQ/OiBudW1iZXIsXG5cbiAgLyoqXG4gICAqIFNpbWlsYXIgdG8gYHZpZXdBcmVhUGVyY2VudFRocmVzaG9sZGAsIGJ1dCBjb25zaWRlcnMgdGhlIHBlcmNlbnQgb2YgdGhlIGl0ZW0gdGhhdCBpcyB2aXNpYmxlLFxuICAgKiByYXRoZXIgdGhhbiB0aGUgZnJhY3Rpb24gb2YgdGhlIHZpZXdhYmxlIGFyZWEgaXQgY292ZXJzLlxuICAgKi9cbiAgaXRlbVZpc2libGVQZXJjZW50VGhyZXNob2xkPzogbnVtYmVyLFxuXG4gIC8qKlxuICAgKiBOb3RoaW5nIGlzIGNvbnNpZGVyZWQgdmlld2FibGUgdW50aWwgdGhlIHVzZXIgc2Nyb2xscyBvciBgcmVjb3JkSW50ZXJhY3Rpb25gIGlzIGNhbGxlZCBhZnRlclxuICAgKiByZW5kZXIuXG4gICAqL1xuICB3YWl0Rm9ySW50ZXJhY3Rpb24/OiBib29sZWFuLFxufH07XG5cbi8qKlxuICogQSBVdGlsaXR5IGNsYXNzIGZvciBjYWxjdWxhdGluZyB2aWV3YWJsZSBpdGVtcyBiYXNlZCBvbiBjdXJyZW50IG1ldHJpY3MgbGlrZSBzY3JvbGwgcG9zaXRpb24gYW5kXG4gKiBsYXlvdXQuXG4gKlxuICogQW4gaXRlbSBpcyBzYWlkIHRvIGJlIGluIGEgXCJ2aWV3YWJsZVwiIHN0YXRlIHdoZW4gYW55IG9mIHRoZSBmb2xsb3dpbmdcbiAqIGlzIHRydWUgZm9yIGxvbmdlciB0aGFuIGBtaW5pbXVtVmlld1RpbWVgIG1pbGxpc2Vjb25kcyAoYWZ0ZXIgYW4gaW50ZXJhY3Rpb24gaWYgYHdhaXRGb3JJbnRlcmFjdGlvbmBcbiAqIGlzIHRydWUpOlxuICpcbiAqIC0gT2NjdXB5aW5nID49IGB2aWV3QXJlYUNvdmVyYWdlUGVyY2VudFRocmVzaG9sZGAgb2YgdGhlIHZpZXcgYXJlYSBYT1IgZnJhY3Rpb24gb2YgdGhlIGl0ZW1cbiAqICAgdmlzaWJsZSBpbiB0aGUgdmlldyBhcmVhID49IGBpdGVtVmlzaWJsZVBlcmNlbnRUaHJlc2hvbGRgLlxuICogLSBFbnRpcmVseSB2aXNpYmxlIG9uIHNjcmVlblxuICovXG5jbGFzcyBWaWV3YWJpbGl0eUhlbHBlciB7XG4gIF9jb25maWc6IFZpZXdhYmlsaXR5Q29uZmlnO1xuICBfaGFzSW50ZXJhY3RlZDogYm9vbGVhbiA9IGZhbHNlO1xuICBfdGltZXJzOiBTZXQ8bnVtYmVyPiA9IG5ldyBTZXQoKTtcbiAgX3ZpZXdhYmxlSW5kaWNlczogQXJyYXk8bnVtYmVyPiA9IFtdO1xuICBfdmlld2FibGVJdGVtczogTWFwPHN0cmluZywgVmlld1Rva2VuPiA9IG5ldyBNYXAoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBjb25maWc6IFZpZXdhYmlsaXR5Q29uZmlnID0ge3ZpZXdBcmVhQ292ZXJhZ2VQZXJjZW50VGhyZXNob2xkOiAwfSxcbiAgKSB7XG4gICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFudXAsIGUuZy4gb24gdW5tb3VudC4gQ2xlYXJzIGFueSBwZW5kaW5nIHRpbWVycy5cbiAgICovXG4gIGRpc3Bvc2UoKSB7XG4gICAgLyogJEZsb3dGaXhNZVtpbmNvbXBhdGlibGUtY2FsbF0gKD49MC42My4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzXG4gICAgICogY29tbWVudCBzdXBwcmVzc2VzIGFuIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC42MyB3YXMgZGVwbG95ZWQuIFRvIHNlZVxuICAgICAqIHRoZSBlcnJvciBkZWxldGUgdGhpcyBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbiAgICB0aGlzLl90aW1lcnMuZm9yRWFjaChjbGVhclRpbWVvdXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgd2hpY2ggaXRlbXMgYXJlIHZpZXdhYmxlIGJhc2VkIG9uIHRoZSBjdXJyZW50IG1ldHJpY3MgYW5kIGNvbmZpZy5cbiAgICovXG4gIGNvbXB1dGVWaWV3YWJsZUl0ZW1zKFxuICAgIHByb3BzOiBDZWxsTWV0cmljUHJvcHMsXG4gICAgc2Nyb2xsT2Zmc2V0OiBudW1iZXIsXG4gICAgdmlld3BvcnRIZWlnaHQ6IG51bWJlcixcbiAgICBsaXN0TWV0cmljczogTGlzdE1ldHJpY3NBZ2dyZWdhdG9yLFxuICAgIC8vIE9wdGlvbmFsIG9wdGltaXphdGlvbiB0byByZWR1Y2UgdGhlIHNjYW4gc2l6ZVxuICAgIHJlbmRlclJhbmdlPzoge1xuICAgICAgZmlyc3Q6IG51bWJlcixcbiAgICAgIGxhc3Q6IG51bWJlcixcbiAgICAgIC4uLlxuICAgIH0sXG4gICk6IEFycmF5PG51bWJlcj4ge1xuICAgIGNvbnN0IGl0ZW1Db3VudCA9IHByb3BzLmdldEl0ZW1Db3VudChwcm9wcy5kYXRhKTtcbiAgICBjb25zdCB7aXRlbVZpc2libGVQZXJjZW50VGhyZXNob2xkLCB2aWV3QXJlYUNvdmVyYWdlUGVyY2VudFRocmVzaG9sZH0gPVxuICAgICAgdGhpcy5fY29uZmlnO1xuICAgIGNvbnN0IHZpZXdBcmVhTW9kZSA9IHZpZXdBcmVhQ292ZXJhZ2VQZXJjZW50VGhyZXNob2xkICE9IG51bGw7XG4gICAgY29uc3Qgdmlld2FibGVQZXJjZW50VGhyZXNob2xkID0gdmlld0FyZWFNb2RlXG4gICAgICA/IHZpZXdBcmVhQ292ZXJhZ2VQZXJjZW50VGhyZXNob2xkXG4gICAgICA6IGl0ZW1WaXNpYmxlUGVyY2VudFRocmVzaG9sZDtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB2aWV3YWJsZVBlcmNlbnRUaHJlc2hvbGQgIT0gbnVsbCAmJlxuICAgICAgICAoaXRlbVZpc2libGVQZXJjZW50VGhyZXNob2xkICE9IG51bGwpICE9PVxuICAgICAgICAgICh2aWV3QXJlYUNvdmVyYWdlUGVyY2VudFRocmVzaG9sZCAhPSBudWxsKSxcbiAgICAgICdNdXN0IHNldCBleGFjdGx5IG9uZSBvZiBpdGVtVmlzaWJsZVBlcmNlbnRUaHJlc2hvbGQgb3Igdmlld0FyZWFDb3ZlcmFnZVBlcmNlbnRUaHJlc2hvbGQnLFxuICAgICk7XG4gICAgY29uc3Qgdmlld2FibGVJbmRpY2VzID0gW107XG4gICAgaWYgKGl0ZW1Db3VudCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHZpZXdhYmxlSW5kaWNlcztcbiAgICB9XG4gICAgbGV0IGZpcnN0VmlzaWJsZSA9IC0xO1xuICAgIGNvbnN0IHtmaXJzdCwgbGFzdH0gPSByZW5kZXJSYW5nZSB8fCB7Zmlyc3Q6IDAsIGxhc3Q6IGl0ZW1Db3VudCAtIDF9O1xuICAgIGlmIChsYXN0ID49IGl0ZW1Db3VudCkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnSW52YWxpZCByZW5kZXIgcmFuZ2UgY29tcHV0aW5nIHZpZXdhYmlsaXR5ICcgK1xuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHtyZW5kZXJSYW5nZSwgaXRlbUNvdW50fSksXG4gICAgICApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBmb3IgKGxldCBpZHggPSBmaXJzdDsgaWR4IDw9IGxhc3Q7IGlkeCsrKSB7XG4gICAgICBjb25zdCBtZXRyaWNzID0gbGlzdE1ldHJpY3MuZ2V0Q2VsbE1ldHJpY3MoaWR4LCBwcm9wcyk7XG4gICAgICBpZiAoIW1ldHJpY3MpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCB0b3AgPSBNYXRoLmZsb29yKG1ldHJpY3Mub2Zmc2V0IC0gc2Nyb2xsT2Zmc2V0KTtcbiAgICAgIGNvbnN0IGJvdHRvbSA9IE1hdGguZmxvb3IodG9wICsgbWV0cmljcy5sZW5ndGgpO1xuXG4gICAgICBpZiAodG9wIDwgdmlld3BvcnRIZWlnaHQgJiYgYm90dG9tID4gMCkge1xuICAgICAgICBmaXJzdFZpc2libGUgPSBpZHg7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBfaXNWaWV3YWJsZShcbiAgICAgICAgICAgIHZpZXdBcmVhTW9kZSxcbiAgICAgICAgICAgIHZpZXdhYmxlUGVyY2VudFRocmVzaG9sZCxcbiAgICAgICAgICAgIHRvcCxcbiAgICAgICAgICAgIGJvdHRvbSxcbiAgICAgICAgICAgIHZpZXdwb3J0SGVpZ2h0LFxuICAgICAgICAgICAgbWV0cmljcy5sZW5ndGgsXG4gICAgICAgICAgKVxuICAgICAgICApIHtcbiAgICAgICAgICB2aWV3YWJsZUluZGljZXMucHVzaChpZHgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGZpcnN0VmlzaWJsZSA+PSAwKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmlld2FibGVJbmRpY2VzO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpZ3VyZXMgb3V0IHdoaWNoIGl0ZW1zIGFyZSB2aWV3YWJsZSBhbmQgaG93IHRoYXQgaGFzIGNoYW5nZWQgZnJvbSBiZWZvcmUgYW5kIGNhbGxzXG4gICAqIGBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkYCBhcyBhcHByb3ByaWF0ZS5cbiAgICovXG4gIG9uVXBkYXRlKFxuICAgIHByb3BzOiBDZWxsTWV0cmljUHJvcHMsXG4gICAgc2Nyb2xsT2Zmc2V0OiBudW1iZXIsXG4gICAgdmlld3BvcnRIZWlnaHQ6IG51bWJlcixcbiAgICBsaXN0TWV0cmljczogTGlzdE1ldHJpY3NBZ2dyZWdhdG9yLFxuICAgIGNyZWF0ZVZpZXdUb2tlbjogKFxuICAgICAgaW5kZXg6IG51bWJlcixcbiAgICAgIGlzVmlld2FibGU6IGJvb2xlYW4sXG4gICAgICBwcm9wczogQ2VsbE1ldHJpY1Byb3BzLFxuICAgICkgPT4gVmlld1Rva2VuLFxuICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQ6ICh7XG4gICAgICB2aWV3YWJsZUl0ZW1zOiBBcnJheTxWaWV3VG9rZW4+LFxuICAgICAgY2hhbmdlZDogQXJyYXk8Vmlld1Rva2VuPixcbiAgICAgIC4uLlxuICAgIH0pID0+IHZvaWQsXG4gICAgLy8gT3B0aW9uYWwgb3B0aW1pemF0aW9uIHRvIHJlZHVjZSB0aGUgc2NhbiBzaXplXG4gICAgcmVuZGVyUmFuZ2U/OiB7XG4gICAgICBmaXJzdDogbnVtYmVyLFxuICAgICAgbGFzdDogbnVtYmVyLFxuICAgICAgLi4uXG4gICAgfSxcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgaXRlbUNvdW50ID0gcHJvcHMuZ2V0SXRlbUNvdW50KHByb3BzLmRhdGEpO1xuICAgIGlmIChcbiAgICAgICh0aGlzLl9jb25maWcud2FpdEZvckludGVyYWN0aW9uICYmICF0aGlzLl9oYXNJbnRlcmFjdGVkKSB8fFxuICAgICAgaXRlbUNvdW50ID09PSAwIHx8XG4gICAgICAhbGlzdE1ldHJpY3MuZ2V0Q2VsbE1ldHJpY3MoMCwgcHJvcHMpXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCB2aWV3YWJsZUluZGljZXM6IEFycmF5PG51bWJlcj4gPSBbXTtcbiAgICBpZiAoaXRlbUNvdW50KSB7XG4gICAgICB2aWV3YWJsZUluZGljZXMgPSB0aGlzLmNvbXB1dGVWaWV3YWJsZUl0ZW1zKFxuICAgICAgICBwcm9wcyxcbiAgICAgICAgc2Nyb2xsT2Zmc2V0LFxuICAgICAgICB2aWV3cG9ydEhlaWdodCxcbiAgICAgICAgbGlzdE1ldHJpY3MsXG4gICAgICAgIHJlbmRlclJhbmdlLFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgdGhpcy5fdmlld2FibGVJbmRpY2VzLmxlbmd0aCA9PT0gdmlld2FibGVJbmRpY2VzLmxlbmd0aCAmJlxuICAgICAgdGhpcy5fdmlld2FibGVJbmRpY2VzLmV2ZXJ5KCh2LCBpaSkgPT4gdiA9PT0gdmlld2FibGVJbmRpY2VzW2lpXSlcbiAgICApIHtcbiAgICAgIC8vIFdlIG1pZ2h0IGdldCBhIGxvdCBvZiBzY3JvbGwgZXZlbnRzIHdoZXJlIHZpc2liaWxpdHkgZG9lc24ndCBjaGFuZ2UgYW5kIHdlIGRvbid0IHdhbnQgdG8gZG9cbiAgICAgIC8vIGV4dHJhIHdvcmsgaW4gdGhvc2UgY2FzZXMuXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX3ZpZXdhYmxlSW5kaWNlcyA9IHZpZXdhYmxlSW5kaWNlcztcbiAgICBpZiAodGhpcy5fY29uZmlnLm1pbmltdW1WaWV3VGltZSkge1xuICAgICAgY29uc3QgaGFuZGxlOiBUaW1lb3V0SUQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgLyogJEZsb3dGaXhNZVtpbmNvbXBhdGlibGUtY2FsbF0gKD49MC42My4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzXG4gICAgICAgICAqIGNvbW1lbnQgc3VwcHJlc3NlcyBhbiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuNjMgd2FzIGRlcGxveWVkLiBUb1xuICAgICAgICAgKiBzZWUgdGhlIGVycm9yIGRlbGV0ZSB0aGlzIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICAgICAgICB0aGlzLl90aW1lcnMuZGVsZXRlKGhhbmRsZSk7XG4gICAgICAgIHRoaXMuX29uVXBkYXRlU3luYyhcbiAgICAgICAgICBwcm9wcyxcbiAgICAgICAgICB2aWV3YWJsZUluZGljZXMsXG4gICAgICAgICAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCxcbiAgICAgICAgICBjcmVhdGVWaWV3VG9rZW4sXG4gICAgICAgICk7XG4gICAgICB9LCB0aGlzLl9jb25maWcubWluaW11bVZpZXdUaW1lKTtcbiAgICAgIC8qICRGbG93Rml4TWVbaW5jb21wYXRpYmxlLWNhbGxdICg+PTAuNjMuMCBzaXRlPXJlYWN0X25hdGl2ZV9mYikgVGhpc1xuICAgICAgICogY29tbWVudCBzdXBwcmVzc2VzIGFuIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC42MyB3YXMgZGVwbG95ZWQuIFRvIHNlZVxuICAgICAgICogdGhlIGVycm9yIGRlbGV0ZSB0aGlzIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICAgICAgdGhpcy5fdGltZXJzLmFkZChoYW5kbGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9vblVwZGF0ZVN5bmMoXG4gICAgICAgIHByb3BzLFxuICAgICAgICB2aWV3YWJsZUluZGljZXMsXG4gICAgICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQsXG4gICAgICAgIGNyZWF0ZVZpZXdUb2tlbixcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGNsZWFuLXVwIGNhY2hlZCBfdmlld2FibGVJbmRpY2VzIHRvIGV2YWx1YXRlIGNoYW5nZWQgaXRlbXMgb24gbmV4dCB1cGRhdGVcbiAgICovXG4gIHJlc2V0Vmlld2FibGVJbmRpY2VzKCkge1xuICAgIHRoaXMuX3ZpZXdhYmxlSW5kaWNlcyA9IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZHMgdGhhdCBhbiBpbnRlcmFjdGlvbiBoYXMgaGFwcGVuZWQgZXZlbiBpZiB0aGVyZSBoYXMgYmVlbiBubyBzY3JvbGwuXG4gICAqL1xuICByZWNvcmRJbnRlcmFjdGlvbigpIHtcbiAgICB0aGlzLl9oYXNJbnRlcmFjdGVkID0gdHJ1ZTtcbiAgfVxuXG4gIF9vblVwZGF0ZVN5bmMoXG4gICAgcHJvcHM6IENlbGxNZXRyaWNQcm9wcyxcbiAgICB2aWV3YWJsZUluZGljZXNUb0NoZWNrOiBBcnJheTxudW1iZXI+LFxuICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQ6ICh7XG4gICAgICBjaGFuZ2VkOiBBcnJheTxWaWV3VG9rZW4+LFxuICAgICAgdmlld2FibGVJdGVtczogQXJyYXk8Vmlld1Rva2VuPixcbiAgICAgIC4uLlxuICAgIH0pID0+IHZvaWQsXG4gICAgY3JlYXRlVmlld1Rva2VuOiAoXG4gICAgICBpbmRleDogbnVtYmVyLFxuICAgICAgaXNWaWV3YWJsZTogYm9vbGVhbixcbiAgICAgIHByb3BzOiBDZWxsTWV0cmljUHJvcHMsXG4gICAgKSA9PiBWaWV3VG9rZW4sXG4gICkge1xuICAgIC8vIEZpbHRlciBvdXQgaW5kaWNlcyB0aGF0IGhhdmUgZ29uZSBvdXQgb2YgdmlldyBzaW5jZSB0aGlzIGNhbGwgd2FzIHNjaGVkdWxlZC5cbiAgICB2aWV3YWJsZUluZGljZXNUb0NoZWNrID0gdmlld2FibGVJbmRpY2VzVG9DaGVjay5maWx0ZXIoaWkgPT5cbiAgICAgIHRoaXMuX3ZpZXdhYmxlSW5kaWNlcy5pbmNsdWRlcyhpaSksXG4gICAgKTtcbiAgICBjb25zdCBwcmV2SXRlbXMgPSB0aGlzLl92aWV3YWJsZUl0ZW1zO1xuICAgIGNvbnN0IG5leHRJdGVtcyA9IG5ldyBNYXAoXG4gICAgICB2aWV3YWJsZUluZGljZXNUb0NoZWNrLm1hcChpaSA9PiB7XG4gICAgICAgIGNvbnN0IHZpZXdhYmxlID0gY3JlYXRlVmlld1Rva2VuKGlpLCB0cnVlLCBwcm9wcyk7XG4gICAgICAgIHJldHVybiBbdmlld2FibGUua2V5LCB2aWV3YWJsZV07XG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgY29uc3QgY2hhbmdlZCA9IFtdO1xuICAgIGZvciAoY29uc3QgW2tleSwgdmlld2FibGVdIG9mIG5leHRJdGVtcykge1xuICAgICAgaWYgKCFwcmV2SXRlbXMuaGFzKGtleSkpIHtcbiAgICAgICAgY2hhbmdlZC5wdXNoKHZpZXdhYmxlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZm9yIChjb25zdCBba2V5LCB2aWV3YWJsZV0gb2YgcHJldkl0ZW1zKSB7XG4gICAgICBpZiAoIW5leHRJdGVtcy5oYXMoa2V5KSkge1xuICAgICAgICBjaGFuZ2VkLnB1c2goey4uLnZpZXdhYmxlLCBpc1ZpZXdhYmxlOiBmYWxzZX0pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY2hhbmdlZC5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLl92aWV3YWJsZUl0ZW1zID0gbmV4dEl0ZW1zO1xuICAgICAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCh7XG4gICAgICAgIHZpZXdhYmxlSXRlbXM6IEFycmF5LmZyb20obmV4dEl0ZW1zLnZhbHVlcygpKSxcbiAgICAgICAgY2hhbmdlZCxcbiAgICAgICAgdmlld2FiaWxpdHlDb25maWc6IHRoaXMuX2NvbmZpZyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBfaXNWaWV3YWJsZShcbiAgdmlld0FyZWFNb2RlOiBib29sZWFuLFxuICB2aWV3YWJsZVBlcmNlbnRUaHJlc2hvbGQ6IG51bWJlcixcbiAgdG9wOiBudW1iZXIsXG4gIGJvdHRvbTogbnVtYmVyLFxuICB2aWV3cG9ydEhlaWdodDogbnVtYmVyLFxuICBpdGVtTGVuZ3RoOiBudW1iZXIsXG4pOiBib29sZWFuIHtcbiAgaWYgKF9pc0VudGlyZWx5VmlzaWJsZSh0b3AsIGJvdHRvbSwgdmlld3BvcnRIZWlnaHQpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgcGl4ZWxzID0gX2dldFBpeGVsc1Zpc2libGUodG9wLCBib3R0b20sIHZpZXdwb3J0SGVpZ2h0KTtcbiAgICBjb25zdCBwZXJjZW50ID1cbiAgICAgIDEwMCAqICh2aWV3QXJlYU1vZGUgPyBwaXhlbHMgLyB2aWV3cG9ydEhlaWdodCA6IHBpeGVscyAvIGl0ZW1MZW5ndGgpO1xuICAgIHJldHVybiBwZXJjZW50ID49IHZpZXdhYmxlUGVyY2VudFRocmVzaG9sZDtcbiAgfVxufVxuXG5mdW5jdGlvbiBfZ2V0UGl4ZWxzVmlzaWJsZShcbiAgdG9wOiBudW1iZXIsXG4gIGJvdHRvbTogbnVtYmVyLFxuICB2aWV3cG9ydEhlaWdodDogbnVtYmVyLFxuKTogbnVtYmVyIHtcbiAgY29uc3QgdmlzaWJsZUhlaWdodCA9IE1hdGgubWluKGJvdHRvbSwgdmlld3BvcnRIZWlnaHQpIC0gTWF0aC5tYXgodG9wLCAwKTtcbiAgcmV0dXJuIE1hdGgubWF4KDAsIHZpc2libGVIZWlnaHQpO1xufVxuXG5mdW5jdGlvbiBfaXNFbnRpcmVseVZpc2libGUoXG4gIHRvcDogbnVtYmVyLFxuICBib3R0b206IG51bWJlcixcbiAgdmlld3BvcnRIZWlnaHQ6IG51bWJlcixcbik6IGJvb2xlYW4ge1xuICByZXR1cm4gdG9wID49IDAgJiYgYm90dG9tIDw9IHZpZXdwb3J0SGVpZ2h0ICYmIGJvdHRvbSA+IHRvcDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBWaWV3YWJpbGl0eUhlbHBlcjtcbiJdLCJtYXBwaW5ncyI6IkFBVUEsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsZUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQUUsZ0JBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFHLGFBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUliLElBQUFJLHNCQUFBLEdBQUFMLHNCQUFBLENBQUFDLE9BQUE7QUFFQSxJQUFNSyxTQUFTLEdBQUdMLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFBQyxJQThEakNNLGlCQUFpQjtFQU9yQixTQUFBQSxrQkFBQSxFQUVFO0lBQUEsSUFEQUMsTUFBeUIsR0FBQUMsU0FBQSxDQUFBQyxNQUFBLFFBQUFELFNBQUEsUUFBQUUsU0FBQSxHQUFBRixTQUFBLE1BQUc7TUFBQ0csZ0NBQWdDLEVBQUU7SUFBQyxDQUFDO0lBQUEsSUFBQVQsZ0JBQUEsQ0FBQVUsT0FBQSxRQUFBTixpQkFBQTtJQUFBLEtBTm5FTyxjQUFjLEdBQVksS0FBSztJQUFBLEtBQy9CQyxPQUFPLEdBQWdCLElBQUlDLEdBQUcsQ0FBQyxDQUFDO0lBQUEsS0FDaENDLGdCQUFnQixHQUFrQixFQUFFO0lBQUEsS0FDcENDLGNBQWMsR0FBMkIsSUFBSUMsR0FBRyxDQUFDLENBQUM7SUFLaEQsSUFBSSxDQUFDQyxPQUFPLEdBQUdaLE1BQU07RUFDdkI7RUFBQyxXQUFBSixhQUFBLENBQUFTLE9BQUEsRUFBQU4saUJBQUE7SUFBQWMsR0FBQTtJQUFBQyxLQUFBLEVBS0QsU0FBQUMsUUFBQSxFQUFVO01BSVIsSUFBSSxDQUFDUixPQUFPLENBQUNTLE9B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