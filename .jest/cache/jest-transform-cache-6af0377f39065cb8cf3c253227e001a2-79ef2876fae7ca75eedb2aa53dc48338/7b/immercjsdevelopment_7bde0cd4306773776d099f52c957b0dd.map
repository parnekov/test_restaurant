{"version":3,"names":["immer_exports","__export","Immer","Immer2","applyPatches","castDraft","castImmutable","createDraft","current","enableMapSet","enablePatches","finishDraft","freeze","immerable","DRAFTABLE","isDraft","isDraftable","nothing","NOTHING","original","produce","produceWithPatches","setAutoFreeze","setUseStrictShallowCopy","module","exports","__toCommonJS","Symbol","for","DRAFT_STATE","errors","process","env","NODE_ENV","plugin","thing","data","die","error","e","_len","arguments","length","args","Array","_key","msg","apply","Error","getPrototypeOf","Object","value","_value$constructor","isPlainObject","isArray","constructor","isMap","isSet","objectCtorString","prototype","toString","proto","Ctor","hasOwnProperty","call","Function","base_","each","obj","iter","getArchtype","Reflect","ownKeys","forEach","key","entry","index","state","type_","has","prop","get","set","propOrOldValue","t","add","is","x","y","target","Map","Set","latest","copy_","shallowCopy","base","strict","slice","create","assign","descriptors","getOwnPropertyDescriptors","keys","i","desc","writable","configurable","enumerable","deep","undefined","isFrozen","clear","delete","dontMutateFrozenCollections","entries","_ref","_ref2","_slicedToArray2","default","plugins","getPlugin","pluginKey","loadPlugin","implementation","currentScope","getCurrentScope","createScope","parent_","immer_","drafts_","canAutoFreeze_","unfinalizedDrafts_","usePatchesInScope","scope","patchListener","patches_","inversePatches_","patchListener_","revokeScope","leaveScope","revokeDraft","enterScope","immer2","draft","revoke_","revoked_","processResult","result","baseDraft","isReplaced","modified_","finalize","maybeFreeze","generateReplacementPatches_","rootScope","path","childValue","finalizeProperty","scope_","finalized_","resultEach","isSet2","generatePatches_","parentState","targetObject","rootPath","targetIsSet","assigned_","concat","res","autoFreeze_","propertyIsEnumerable","createProxyProxy","parent","draft_","isManual_","traps","objectTraps","arrayTraps","_Proxy$revocable","Proxy","revocable","revoke","proxy","source","readPropFromProto","peek","prepareCopy","createProxy","getDescriptorFromProto","current2","currentState","markChanged","Number","isNaN","deleteProperty","getOwnPropertyDescriptor","owner","defineProperty","setPrototypeOf","fn","parseInt","_desc$get","useStrictShallowCopy_","config","_this","_classCallCheck2","recipe","defaultBase","self","curriedProduce","_this2","base2","_len2","_key2","_recipe","hasError","p","ip","_len3","_key3","patches","inversePatches","autoFreeze","useStrictShallowCopy","_createClass2","patch","op","applyPatchesImpl","applyPatches_","proxyMap_","proxySet_","push","currentImpl","copy","errorOffset","REPLACE","ADD","REMOVE","basePath","generatePatchesFromAssigned","generateArrayPatches","generateSetPatches","_ref3","_ref4","clonePatchValueIfNeeded","assignedValue","origValue","unshift","baseValue","replacement","parentType","join","type","deepClonePatchValue","splice","map","from","_ref5","_ref6","k","v","cloned","DraftMap","_Map","_ref7","_this3","_callSuper","_inherits2","size","assertUnrevoked","prepareMapCopy","_delete","cb","thisArg","_this4","_value","_map","values","_this5","iterator","_defineProperty2","next","r","done","_this6","_wrapNativeSuper2","DraftSet","_Set","_ref10","_this7","prepareSetCopy","JSON","stringify","immer","bind"],"sources":["../../src/immer.ts","../../src/utils/env.ts","../../src/utils/errors.ts","../../src/utils/common.ts","../../src/utils/plugins.ts","../../src/core/scope.ts","../../src/core/finalize.ts","../../src/core/proxy.ts","../../src/core/immerClass.ts","../../src/core/current.ts","../../src/plugins/patches.ts","../../src/plugins/mapset.ts"],"sourcesContent":["import {\n\tIProduce,\n\tIProduceWithPatches,\n\tImmer,\n\tDraft,\n\tImmutable\n} from \"./internal\"\n\nexport {\n\tDraft,\n\tImmutable,\n\tPatch,\n\tPatchListener,\n\toriginal,\n\tcurrent,\n\tisDraft,\n\tisDraftable,\n\tNOTHING as nothing,\n\tDRAFTABLE as immerable,\n\tfreeze,\n\tObjectish\n} from \"./internal\"\n\nconst immer = new Immer()\n\n/**\n * The `produce` function takes a value and a \"recipe function\" (whose\n * return value often depends on the base state). The recipe function is\n * free to mutate its first argument however it wants. All mutations are\n * only ever applied to a __copy__ of the base state.\n *\n * Pass only a function to create a \"curried producer\" which relieves you\n * from passing the recipe function every time.\n *\n * Only plain objects and arrays are made mutable. All other objects are\n * considered uncopyable.\n *\n * Note: This function is __bound__ to its `Immer` instance.\n *\n * @param {any} base - the initial state\n * @param {Function} producer - function that receives a proxy of the base state as first argument and which can be freely modified\n * @param {Function} patchListener - optional function that will be called with all the patches produced here\n * @returns {any} a new state, or the initial state if nothing was modified\n */\nexport const produce: IProduce = immer.produce\n\n/**\n * Like `produce`, but `produceWithPatches` always returns a tuple\n * [nextState, patches, inversePatches] (instead of just the next state)\n */\nexport const produceWithPatches: IProduceWithPatches = immer.produceWithPatches.bind(\n\timmer\n)\n\n/**\n * Pass true to automatically freeze all copies created by Immer.\n *\n * Always freeze by default, even in production mode\n */\nexport const setAutoFreeze = immer.setAutoFreeze.bind(immer)\n\n/**\n * Pass true to enable strict shallow copy.\n *\n * By default, immer does not copy the object descriptors such as getter, setter and non-enumrable properties.\n */\nexport const setUseStrictShallowCopy = immer.setUseStrictShallowCopy.bind(immer)\n\n/**\n * Apply an array of Immer patches to the first argument.\n *\n * This function is a producer, which means copy-on-write is in effect.\n */\nexport const applyPatches = immer.applyPatches.bind(immer)\n\n/**\n * Create an Immer draft from the given base state, which may be a draft itself.\n * The draft can be modified until you finalize it with the `finishDraft` function.\n */\nexport const createDraft = immer.createDraft.bind(immer)\n\n/**\n * Finalize an Immer draft from a `createDraft` call, returning the base state\n * (if no changes were made) or a modified copy. The draft must *not* be\n * mutated afterwards.\n *\n * Pass a function as the 2nd argument to generate Immer patches based on the\n * changes that were made.\n */\nexport const finishDraft = immer.finishDraft.bind(immer)\n\n/**\n * This function is actually a no-op, but can be used to cast an immutable type\n * to an draft type and make TypeScript happy\n *\n * @param value\n */\nexport function castDraft<T>(value: T): Draft<T> {\n\treturn value as any\n}\n\n/**\n * This function is actually a no-op, but can be used to cast a mutable type\n * to an immutable type and make TypeScript happy\n * @param value\n */\nexport function castImmutable<T>(value: T): Immutable<T> {\n\treturn value as any\n}\n\nexport {Immer}\n\nexport {enablePatches} from \"./plugins/patches\"\nexport {enableMapSet} from \"./plugins/mapset\"\n","// Should be no imports here!\n\n/**\n * The sentinel value returned by producers to replace the draft with undefined.\n */\nexport const NOTHING: unique symbol = Symbol.for(\"immer-nothing\")\n\n/**\n * To let Immer treat your class instances as plain immutable objects\n * (albeit with a custom prototype), you must define either an instance property\n * or a static property on each of your custom classes.\n *\n * Otherwise, your class instance will never be drafted, which means it won't be\n * safe to mutate in a produce callback.\n */\nexport const DRAFTABLE: unique symbol = Symbol.for(\"immer-draftable\")\n\nexport const DRAFT_STATE: unique symbol = Symbol.for(\"immer-state\")\n","export const errors =\n\tprocess.env.NODE_ENV !== \"production\"\n\t\t? [\n\t\t\t\t// All error codes, starting by 0:\n\t\t\t\tfunction(plugin: string) {\n\t\t\t\t\treturn `The plugin for '${plugin}' has not been loaded into Immer. To enable the plugin, import and call \\`enable${plugin}()\\` when initializing your application.`\n\t\t\t\t},\n\t\t\t\tfunction(thing: string) {\n\t\t\t\t\treturn `produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${thing}'`\n\t\t\t\t},\n\t\t\t\t\"This object has been frozen and should not be mutated\",\n\t\t\t\tfunction(data: any) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t\"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \" +\n\t\t\t\t\t\tdata\n\t\t\t\t\t)\n\t\t\t\t},\n\t\t\t\t\"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",\n\t\t\t\t\"Immer forbids circular references\",\n\t\t\t\t\"The first or second argument to `produce` must be a function\",\n\t\t\t\t\"The third argument to `produce` must be a function or undefined\",\n\t\t\t\t\"First argument to `createDraft` must be a plain object, an array, or an immerable object\",\n\t\t\t\t\"First argument to `finishDraft` must be a draft returned by `createDraft`\",\n\t\t\t\tfunction(thing: string) {\n\t\t\t\t\treturn `'current' expects a draft, got: ${thing}`\n\t\t\t\t},\n\t\t\t\t\"Object.defineProperty() cannot be used on an Immer draft\",\n\t\t\t\t\"Object.setPrototypeOf() cannot be used on an Immer draft\",\n\t\t\t\t\"Immer only supports deleting array indices\",\n\t\t\t\t\"Immer only supports setting array indices and the 'length' property\",\n\t\t\t\tfunction(thing: string) {\n\t\t\t\t\treturn `'original' expects a draft, got: ${thing}`\n\t\t\t\t}\n\t\t\t\t// Note: if more errors are added, the errorOffset in Patches.ts should be increased\n\t\t\t\t// See Patches.ts for additional errors\n\t\t  ]\n\t\t: []\n\nexport function die(error: number, ...args: any[]): never {\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\tconst e = errors[error]\n\t\tconst msg = typeof e === \"function\" ? e.apply(null, args as any) : e\n\t\tthrow new Error(`[Immer] ${msg}`)\n\t}\n\tthrow new Error(\n\t\t`[Immer] minified error nr: ${error}. Full error at: https://bit.ly/3cXEKWf`\n\t)\n}\n","import {\n\tDRAFT_STATE,\n\tDRAFTABLE,\n\tObjectish,\n\tDrafted,\n\tAnyObject,\n\tAnyMap,\n\tAnySet,\n\tImmerState,\n\tArchType,\n\tdie\n} from \"../internal\"\n\nexport const getPrototypeOf = Object.getPrototypeOf\n\n/** Returns true if the given value is an Immer draft */\n/*#__PURE__*/\nexport function isDraft(value: any): boolean {\n\treturn !!value && !!value[DRAFT_STATE]\n}\n\n/** Returns true if the given value can be drafted by Immer */\n/*#__PURE__*/\nexport function isDraftable(value: any): boolean {\n\tif (!value) return false\n\treturn (\n\t\tisPlainObject(value) ||\n\t\tArray.isArray(value) ||\n\t\t!!value[DRAFTABLE] ||\n\t\t!!value.constructor?.[DRAFTABLE] ||\n\t\tisMap(value) ||\n\t\tisSet(value)\n\t)\n}\n\nconst objectCtorString = Object.prototype.constructor.toString()\n/*#__PURE__*/\nexport function isPlainObject(value: any): boolean {\n\tif (!value || typeof value !== \"object\") return false\n\tconst proto = getPrototypeOf(value)\n\tif (proto === null) {\n\t\treturn true\n\t}\n\tconst Ctor =\n\t\tObject.hasOwnProperty.call(proto, \"constructor\") && proto.constructor\n\n\tif (Ctor === Object) return true\n\n\treturn (\n\t\ttypeof Ctor == \"function\" &&\n\t\tFunction.toString.call(Ctor) === objectCtorString\n\t)\n}\n\n/** Get the underlying object that is represented by the given draft */\n/*#__PURE__*/\nexport function original<T>(value: T): T | undefined\nexport function original(value: Drafted<any>): any {\n\tif (!isDraft(value)) die(15, value)\n\treturn value[DRAFT_STATE].base_\n}\n\n/**\n * Each iterates a map, set or array.\n * Or, if any other kind of of object all it's own properties.\n * Regardless whether they are enumerable or symbols\n */\nexport function each<T extends Objectish>(\n\tobj: T,\n\titer: (key: string | number, value: any, source: T) => void\n): void\nexport function each(obj: any, iter: any) {\n\tif (getArchtype(obj) === ArchType.Object) {\n\t\tReflect.ownKeys(obj).forEach(key => {\n\t\t\titer(key, obj[key], obj)\n\t\t})\n\t} else {\n\t\tobj.forEach((entry: any, index: any) => iter(index, entry, obj))\n\t}\n}\n\n/*#__PURE__*/\nexport function getArchtype(thing: any): ArchType {\n\tconst state: undefined | ImmerState = thing[DRAFT_STATE]\n\treturn state\n\t\t? state.type_\n\t\t: Array.isArray(thing)\n\t\t? ArchType.Array\n\t\t: isMap(thing)\n\t\t? ArchType.Map\n\t\t: isSet(thing)\n\t\t? ArchType.Set\n\t\t: ArchType.Object\n}\n\n/*#__PURE__*/\nexport function has(thing: any, prop: PropertyKey): boolean {\n\treturn getArchtype(thing) === ArchType.Map\n\t\t? thing.has(prop)\n\t\t: Object.prototype.hasOwnProperty.call(thing, prop)\n}\n\n/*#__PURE__*/\nexport function get(thing: AnyMap | AnyObject, prop: PropertyKey): any {\n\t// @ts-ignore\n\treturn getArchtype(thing) === ArchType.Map ? thing.get(prop) : thing[prop]\n}\n\n/*#__PURE__*/\nexport function set(thing: any, propOrOldValue: PropertyKey, value: any) {\n\tconst t = getArchtype(thing)\n\tif (t === ArchType.Map) thing.set(propOrOldValue, value)\n\telse if (t === ArchType.Set) {\n\t\tthing.add(value)\n\t} else thing[propOrOldValue] = value\n}\n\n/*#__PURE__*/\nexport function is(x: any, y: any): boolean {\n\t// From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n\tif (x === y) {\n\t\treturn x !== 0 || 1 / x === 1 / y\n\t} else {\n\t\treturn x !== x && y !== y\n\t}\n}\n\n/*#__PURE__*/\nexport function isMap(target: any): target is AnyMap {\n\treturn target instanceof Map\n}\n\n/*#__PURE__*/\nexport function isSet(target: any): target is AnySet {\n\treturn target instanceof Set\n}\n/*#__PURE__*/\nexport function latest(state: ImmerState): any {\n\treturn state.copy_ || state.base_\n}\n\n/*#__PURE__*/\nexport function shallowCopy(base: any, strict: boolean) {\n\tif (isMap(base)) {\n\t\treturn new Map(base)\n\t}\n\tif (isSet(base)) {\n\t\treturn new Set(base)\n\t}\n\tif (Array.isArray(base)) return Array.prototype.slice.call(base)\n\n\tif (!strict && isPlainObject(base)) {\n\t\tif (!getPrototypeOf(base)) {\n\t\t\tconst obj = Object.create(null)\n\t\t\treturn Object.assign(obj, base)\n\t\t}\n\t\treturn {...base}\n\t}\n\n\tconst descriptors = Object.getOwnPropertyDescriptors(base)\n\tdelete descriptors[DRAFT_STATE as any]\n\tlet keys = Reflect.ownKeys(descriptors)\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tconst key: any = keys[i]\n\t\tconst desc = descriptors[key]\n\t\tif (desc.writable === false) {\n\t\t\tdesc.writable = true\n\t\t\tdesc.configurable = true\n\t\t}\n\t\t// like object.assign, we will read any _own_, get/set accessors. This helps in dealing\n\t\t// with libraries that trap values, like mobx or vue\n\t\t// unlike object.assign, non-enumerables will be copied as well\n\t\tif (desc.get || desc.set)\n\t\t\tdescriptors[key] = {\n\t\t\t\tconfigurable: true,\n\t\t\t\twritable: true, // could live with !!desc.set as well here...\n\t\t\t\tenumerable: desc.enumerable,\n\t\t\t\tvalue: base[key]\n\t\t\t}\n\t}\n\treturn Object.create(getPrototypeOf(base), descriptors)\n}\n\n/**\n * Freezes draftable objects. Returns the original object.\n * By default freezes shallowly, but if the second argument is `true` it will freeze recursively.\n *\n * @param obj\n * @param deep\n */\nexport function freeze<T>(obj: T, deep?: boolean): T\nexport function freeze<T>(obj: any, deep: boolean = false): T {\n\tif (isFrozen(obj) || isDraft(obj) || !isDraftable(obj)) return obj\n\tif (getArchtype(obj) > 1 /* Map or Set */) {\n\t\tobj.set = obj.add = obj.clear = obj.delete = dontMutateFrozenCollections as any\n\t}\n\tObject.freeze(obj)\n\tif (deep)\n\t\t// See #590, don't recurse into non-enumerable / Symbol properties when freezing\n\t\t// So use Object.entries (only string-like, enumerables) instead of each()\n\t\tObject.entries(obj).forEach(([key, value]) => freeze(value, true))\n\treturn obj\n}\n\nfunction dontMutateFrozenCollections() {\n\tdie(2)\n}\n\nexport function isFrozen(obj: any): boolean {\n\treturn Object.isFrozen(obj)\n}\n","import {\n\tImmerState,\n\tPatch,\n\tDrafted,\n\tImmerBaseState,\n\tAnyMap,\n\tAnySet,\n\tArchType,\n\tdie\n} from \"../internal\"\n\n/** Plugin utilities */\nconst plugins: {\n\tPatches?: {\n\t\tgeneratePatches_(\n\t\t\tstate: ImmerState,\n\t\t\tbasePath: PatchPath,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tgenerateReplacementPatches_(\n\t\t\tbase: any,\n\t\t\treplacement: any,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tapplyPatches_<T>(draft: T, patches: Patch[]): T\n\t}\n\tMapSet?: {\n\t\tproxyMap_<T extends AnyMap>(target: T, parent?: ImmerState): T\n\t\tproxySet_<T extends AnySet>(target: T, parent?: ImmerState): T\n\t}\n} = {}\n\ntype Plugins = typeof plugins\n\nexport function getPlugin<K extends keyof Plugins>(\n\tpluginKey: K\n): Exclude<Plugins[K], undefined> {\n\tconst plugin = plugins[pluginKey]\n\tif (!plugin) {\n\t\tdie(0, pluginKey)\n\t}\n\t// @ts-ignore\n\treturn plugin\n}\n\nexport function loadPlugin<K extends keyof Plugins>(\n\tpluginKey: K,\n\timplementation: Plugins[K]\n): void {\n\tif (!plugins[pluginKey]) plugins[pluginKey] = implementation\n}\n/** Map / Set plugin */\n\nexport interface MapState extends ImmerBaseState {\n\ttype_: ArchType.Map\n\tcopy_: AnyMap | undefined\n\tassigned_: Map<any, boolean> | undefined\n\tbase_: AnyMap\n\trevoked_: boolean\n\tdraft_: Drafted<AnyMap, MapState>\n}\n\nexport interface SetState extends ImmerBaseState {\n\ttype_: ArchType.Set\n\tcopy_: AnySet | undefined\n\tbase_: AnySet\n\tdrafts_: Map<any, Drafted> // maps the original value to the draft value in the new set\n\trevoked_: boolean\n\tdraft_: Drafted<AnySet, SetState>\n}\n\n/** Patches plugin */\n\nexport type PatchPath = (string | number)[]\n","import {\n\tPatch,\n\tPatchListener,\n\tDrafted,\n\tImmer,\n\tDRAFT_STATE,\n\tImmerState,\n\tArchType,\n\tgetPlugin\n} from \"../internal\"\n\n/** Each scope represents a `produce` call. */\n\nexport interface ImmerScope {\n\tpatches_?: Patch[]\n\tinversePatches_?: Patch[]\n\tcanAutoFreeze_: boolean\n\tdrafts_: any[]\n\tparent_?: ImmerScope\n\tpatchListener_?: PatchListener\n\timmer_: Immer\n\tunfinalizedDrafts_: number\n}\n\nlet currentScope: ImmerScope | undefined\n\nexport function getCurrentScope() {\n\treturn currentScope!\n}\n\nfunction createScope(\n\tparent_: ImmerScope | undefined,\n\timmer_: Immer\n): ImmerScope {\n\treturn {\n\t\tdrafts_: [],\n\t\tparent_,\n\t\timmer_,\n\t\t// Whenever the modified draft contains a draft from another scope, we\n\t\t// need to prevent auto-freezing so the unowned draft can be finalized.\n\t\tcanAutoFreeze_: true,\n\t\tunfinalizedDrafts_: 0\n\t}\n}\n\nexport function usePatchesInScope(\n\tscope: ImmerScope,\n\tpatchListener?: PatchListener\n) {\n\tif (patchListener) {\n\t\tgetPlugin(\"Patches\") // assert we have the plugin\n\t\tscope.patches_ = []\n\t\tscope.inversePatches_ = []\n\t\tscope.patchListener_ = patchListener\n\t}\n}\n\nexport function revokeScope(scope: ImmerScope) {\n\tleaveScope(scope)\n\tscope.drafts_.forEach(revokeDraft)\n\t// @ts-ignore\n\tscope.drafts_ = null\n}\n\nexport function leaveScope(scope: ImmerScope) {\n\tif (scope === currentScope) {\n\t\tcurrentScope = scope.parent_\n\t}\n}\n\nexport function enterScope(immer: Immer) {\n\treturn (currentScope = createScope(currentScope, immer))\n}\n\nfunction revokeDraft(draft: Drafted) {\n\tconst state: ImmerState = draft[DRAFT_STATE]\n\tif (state.type_ === ArchType.Object || state.type_ === ArchType.Array)\n\t\tstate.revoke_()\n\telse state.revoked_ = true\n}\n","import {\n\tImmerScope,\n\tDRAFT_STATE,\n\tisDraftable,\n\tNOTHING,\n\tPatchPath,\n\teach,\n\thas,\n\tfreeze,\n\tImmerState,\n\tisDraft,\n\tSetState,\n\tset,\n\tArchType,\n\tgetPlugin,\n\tdie,\n\trevokeScope,\n\tisFrozen\n} from \"../internal\"\n\nexport function processResult(result: any, scope: ImmerScope) {\n\tscope.unfinalizedDrafts_ = scope.drafts_.length\n\tconst baseDraft = scope.drafts_![0]\n\tconst isReplaced = result !== undefined && result !== baseDraft\n\tif (isReplaced) {\n\t\tif (baseDraft[DRAFT_STATE].modified_) {\n\t\t\trevokeScope(scope)\n\t\t\tdie(4)\n\t\t}\n\t\tif (isDraftable(result)) {\n\t\t\t// Finalize the result in case it contains (or is) a subset of the draft.\n\t\t\tresult = finalize(scope, result)\n\t\t\tif (!scope.parent_) maybeFreeze(scope, result)\n\t\t}\n\t\tif (scope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generateReplacementPatches_(\n\t\t\t\tbaseDraft[DRAFT_STATE].base_,\n\t\t\t\tresult,\n\t\t\t\tscope.patches_,\n\t\t\t\tscope.inversePatches_!\n\t\t\t)\n\t\t}\n\t} else {\n\t\t// Finalize the base draft.\n\t\tresult = finalize(scope, baseDraft, [])\n\t}\n\trevokeScope(scope)\n\tif (scope.patches_) {\n\t\tscope.patchListener_!(scope.patches_, scope.inversePatches_!)\n\t}\n\treturn result !== NOTHING ? result : undefined\n}\n\nfunction finalize(rootScope: ImmerScope, value: any, path?: PatchPath) {\n\t// Don't recurse in tho recursive data structures\n\tif (isFrozen(value)) return value\n\n\tconst state: ImmerState = value[DRAFT_STATE]\n\t// A plain object, might need freezing, might contain drafts\n\tif (!state) {\n\t\teach(value, (key, childValue) =>\n\t\t\tfinalizeProperty(rootScope, state, value, key, childValue, path)\n\t\t)\n\t\treturn value\n\t}\n\t// Never finalize drafts owned by another scope.\n\tif (state.scope_ !== rootScope) return value\n\t// Unmodified draft, return the (frozen) original\n\tif (!state.modified_) {\n\t\tmaybeFreeze(rootScope, state.base_, true)\n\t\treturn state.base_\n\t}\n\t// Not finalized yet, let's do that now\n\tif (!state.finalized_) {\n\t\tstate.finalized_ = true\n\t\tstate.scope_.unfinalizedDrafts_--\n\t\tconst result = state.copy_\n\t\t// Finalize all children of the copy\n\t\t// For sets we clone before iterating, otherwise we can get in endless loop due to modifying during iteration, see #628\n\t\t// To preserve insertion order in all cases we then clear the set\n\t\t// And we let finalizeProperty know it needs to re-add non-draft children back to the target\n\t\tlet resultEach = result\n\t\tlet isSet = false\n\t\tif (state.type_ === ArchType.Set) {\n\t\t\tresultEach = new Set(result)\n\t\t\tresult.clear()\n\t\t\tisSet = true\n\t\t}\n\t\teach(resultEach, (key, childValue) =>\n\t\t\tfinalizeProperty(rootScope, state, result, key, childValue, path, isSet)\n\t\t)\n\t\t// everything inside is frozen, we can freeze here\n\t\tmaybeFreeze(rootScope, result, false)\n\t\t// first time finalizing, let's create those patches\n\t\tif (path && rootScope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generatePatches_(\n\t\t\t\tstate,\n\t\t\t\tpath,\n\t\t\t\trootScope.patches_,\n\t\t\t\trootScope.inversePatches_!\n\t\t\t)\n\t\t}\n\t}\n\treturn state.copy_\n}\n\nfunction finalizeProperty(\n\trootScope: ImmerScope,\n\tparentState: undefined | ImmerState,\n\ttargetObject: any,\n\tprop: string | number,\n\tchildValue: any,\n\trootPath?: PatchPath,\n\ttargetIsSet?: boolean\n) {\n\tif (process.env.NODE_ENV !== \"production\" && childValue === targetObject)\n\t\tdie(5)\n\tif (isDraft(childValue)) {\n\t\tconst path =\n\t\t\trootPath &&\n\t\t\tparentState &&\n\t\t\tparentState!.type_ !== ArchType.Set && // Set objects are atomic since they have no keys.\n\t\t\t!has((parentState as Exclude<ImmerState, SetState>).assigned_!, prop) // Skip deep patches for assigned keys.\n\t\t\t\t? rootPath!.concat(prop)\n\t\t\t\t: undefined\n\t\t// Drafts owned by `scope` are finalized here.\n\t\tconst res = finalize(rootScope, childValue, path)\n\t\tset(targetObject, prop, res)\n\t\t// Drafts from another scope must prevented to be frozen\n\t\t// if we got a draft back from finalize, we're in a nested produce and shouldn't freeze\n\t\tif (isDraft(res)) {\n\t\t\trootScope.canAutoFreeze_ = false\n\t\t} else return\n\t} else if (targetIsSet) {\n\t\ttargetObject.add(childValue)\n\t}\n\t// Search new objects for unfinalized drafts. Frozen objects should never contain drafts.\n\tif (isDraftable(childValue) && !isFrozen(childValue)) {\n\t\tif (!rootScope.immer_.autoFreeze_ && rootScope.unfinalizedDrafts_ < 1) {\n\t\t\t// optimization: if an object is not a draft, and we don't have to\n\t\t\t// deepfreeze everything, and we are sure that no drafts are left in the remaining object\n\t\t\t// cause we saw and finalized all drafts already; we can stop visiting the rest of the tree.\n\t\t\t// This benefits especially adding large data tree's without further processing.\n\t\t\t// See add-data.js perf test\n\t\t\treturn\n\t\t}\n\t\tfinalize(rootScope, childValue)\n\t\t// Immer deep freezes plain objects, so if there is no parent state, we freeze as well\n\t\t// Per #590, we never freeze symbolic properties. Just to make sure don't accidentally interfere\n\t\t// with other frameworks.\n\t\tif (\n\t\t\t(!parentState || !parentState.scope_.parent_) &&\n\t\t\ttypeof prop !== \"symbol\" &&\n\t\t\tObject.prototype.propertyIsEnumerable.call(targetObject, prop)\n\t\t)\n\t\t\tmaybeFreeze(rootScope, childValue)\n\t}\n}\n\nfunction maybeFreeze(scope: ImmerScope, value: any, deep = false) {\n\t// we never freeze for a non-root scope; as it would prevent pruning for drafts inside wrapping objects\n\tif (!scope.parent_ && scope.immer_.autoFreeze_ && scope.canAutoFreeze_) {\n\t\tfreeze(value, deep)\n\t}\n}\n","import {\n\teach,\n\thas,\n\tis,\n\tisDraftable,\n\tshallowCopy,\n\tlatest,\n\tImmerBaseState,\n\tImmerState,\n\tDrafted,\n\tAnyObject,\n\tAnyArray,\n\tObjectish,\n\tgetCurrentScope,\n\tgetPrototypeOf,\n\tDRAFT_STATE,\n\tdie,\n\tcreateProxy,\n\tArchType,\n\tImmerScope\n} from \"../internal\"\n\ninterface ProxyBaseState extends ImmerBaseState {\n\tassigned_: {\n\t\t[property: string]: boolean\n\t}\n\tparent_?: ImmerState\n\trevoke_(): void\n}\n\nexport interface ProxyObjectState extends ProxyBaseState {\n\ttype_: ArchType.Object\n\tbase_: any\n\tcopy_: any\n\tdraft_: Drafted<AnyObject, ProxyObjectState>\n}\n\nexport interface ProxyArrayState extends ProxyBaseState {\n\ttype_: ArchType.Array\n\tbase_: AnyArray\n\tcopy_: AnyArray | null\n\tdraft_: Drafted<AnyArray, ProxyArrayState>\n}\n\ntype ProxyState = ProxyObjectState | ProxyArrayState\n\n/**\n * Returns a new draft of the `base` object.\n *\n * The second argument is the parent draft-state (used internally).\n */\nexport function createProxyProxy<T extends Objectish>(\n\tbase: T,\n\tparent?: ImmerState\n): Drafted<T, ProxyState> {\n\tconst isArray = Array.isArray(base)\n\tconst state: ProxyState = {\n\t\ttype_: isArray ? ArchType.Array : (ArchType.Object as any),\n\t\t// Track which produce call this is associated with.\n\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t// True for both shallow and deep changes.\n\t\tmodified_: false,\n\t\t// Used during finalization.\n\t\tfinalized_: false,\n\t\t// Track which properties have been assigned (true) or deleted (false).\n\t\tassigned_: {},\n\t\t// The parent draft state.\n\t\tparent_: parent,\n\t\t// The base state.\n\t\tbase_: base,\n\t\t// The base proxy.\n\t\tdraft_: null as any, // set below\n\t\t// The base copy with any updated values.\n\t\tcopy_: null,\n\t\t// Called by the `produce` function.\n\t\trevoke_: null as any,\n\t\tisManual_: false\n\t}\n\n\t// the traps must target something, a bit like the 'real' base.\n\t// but also, we need to be able to determine from the target what the relevant state is\n\t// (to avoid creating traps per instance to capture the state in closure,\n\t// and to avoid creating weird hidden properties as well)\n\t// So the trick is to use 'state' as the actual 'target'! (and make sure we intercept everything)\n\t// Note that in the case of an array, we put the state in an array to have better Reflect defaults ootb\n\tlet target: T = state as any\n\tlet traps: ProxyHandler<object | Array<any>> = objectTraps\n\tif (isArray) {\n\t\ttarget = [state] as any\n\t\ttraps = arrayTraps\n\t}\n\n\tconst {revoke, proxy} = Proxy.revocable(target, traps)\n\tstate.draft_ = proxy as any\n\tstate.revoke_ = revoke\n\treturn proxy as any\n}\n\n/**\n * Object drafts\n */\nexport const objectTraps: ProxyHandler<ProxyState> = {\n\tget(state, prop) {\n\t\tif (prop === DRAFT_STATE) return state\n\n\t\tconst source = latest(state)\n\t\tif (!has(source, prop)) {\n\t\t\t// non-existing or non-own property...\n\t\t\treturn readPropFromProto(state, source, prop)\n\t\t}\n\t\tconst value = source[prop]\n\t\tif (state.finalized_ || !isDraftable(value)) {\n\t\t\treturn value\n\t\t}\n\t\t// Check for existing draft in modified state.\n\t\t// Assigned values are never drafted. This catches any drafts we created, too.\n\t\tif (value === peek(state.base_, prop)) {\n\t\t\tprepareCopy(state)\n\t\t\treturn (state.copy_![prop as any] = createProxy(value, state))\n\t\t}\n\t\treturn value\n\t},\n\thas(state, prop) {\n\t\treturn prop in latest(state)\n\t},\n\townKeys(state) {\n\t\treturn Reflect.ownKeys(latest(state))\n\t},\n\tset(\n\t\tstate: ProxyObjectState,\n\t\tprop: string /* strictly not, but helps TS */,\n\t\tvalue\n\t) {\n\t\tconst desc = getDescriptorFromProto(latest(state), prop)\n\t\tif (desc?.set) {\n\t\t\t// special case: if this write is captured by a setter, we have\n\t\t\t// to trigger it with the correct context\n\t\t\tdesc.set.call(state.draft_, value)\n\t\t\treturn true\n\t\t}\n\t\tif (!state.modified_) {\n\t\t\t// the last check is because we need to be able to distinguish setting a non-existing to undefined (which is a change)\n\t\t\t// from setting an existing property with value undefined to undefined (which is not a change)\n\t\t\tconst current = peek(latest(state), prop)\n\t\t\t// special case, if we assigning the original value to a draft, we can ignore the assignment\n\t\t\tconst currentState: ProxyObjectState = current?.[DRAFT_STATE]\n\t\t\tif (currentState && currentState.base_ === value) {\n\t\t\t\tstate.copy_![prop] = value\n\t\t\t\tstate.assigned_[prop] = false\n\t\t\t\treturn true\n\t\t\t}\n\t\t\tif (is(value, current) && (value !== undefined || has(state.base_, prop)))\n\t\t\t\treturn true\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t}\n\n\t\tif (\n\t\t\t(state.copy_![prop] === value &&\n\t\t\t\t// special case: handle new props with value 'undefined'\n\t\t\t\t(value !== undefined || prop in state.copy_)) ||\n\t\t\t// special case: NaN\n\t\t\t(Number.isNaN(value) && Number.isNaN(state.copy_![prop]))\n\t\t)\n\t\t\treturn true\n\n\t\t// @ts-ignore\n\t\tstate.copy_![prop] = value\n\t\tstate.assigned_[prop] = true\n\t\treturn true\n\t},\n\tdeleteProperty(state, prop: string) {\n\t\t// The `undefined` check is a fast path for pre-existing keys.\n\t\tif (peek(state.base_, prop) !== undefined || prop in state.base_) {\n\t\t\tstate.assigned_[prop] = false\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t} else {\n\t\t\t// if an originally not assigned property was deleted\n\t\t\tdelete state.assigned_[prop]\n\t\t}\n\t\tif (state.copy_) {\n\t\t\tdelete state.copy_[prop]\n\t\t}\n\t\treturn true\n\t},\n\t// Note: We never coerce `desc.value` into an Immer draft, because we can't make\n\t// the same guarantee in ES5 mode.\n\tgetOwnPropertyDescriptor(state, prop) {\n\t\tconst owner = latest(state)\n\t\tconst desc = Reflect.getOwnPropertyDescriptor(owner, prop)\n\t\tif (!desc) return desc\n\t\treturn {\n\t\t\twritable: true,\n\t\t\tconfigurable: state.type_ !== ArchType.Array || prop !== \"length\",\n\t\t\tenumerable: desc.enumerable,\n\t\t\tvalue: owner[prop]\n\t\t}\n\t},\n\tdefineProperty() {\n\t\tdie(11)\n\t},\n\tgetPrototypeOf(state) {\n\t\treturn getPrototypeOf(state.base_)\n\t},\n\tsetPrototypeOf() {\n\t\tdie(12)\n\t}\n}\n\n/**\n * Array drafts\n */\n\nconst arrayTraps: ProxyHandler<[ProxyArrayState]> = {}\neach(objectTraps, (key, fn) => {\n\t// @ts-ignore\n\tarrayTraps[key] = function() {\n\t\targuments[0] = arguments[0][0]\n\t\treturn fn.apply(this, arguments)\n\t}\n})\narrayTraps.deleteProperty = function(state, prop) {\n\tif (process.env.NODE_ENV !== \"production\" && isNaN(parseInt(prop as any)))\n\t\tdie(13)\n\t// @ts-ignore\n\treturn arrayTraps.set!.call(this, state, prop, undefined)\n}\narrayTraps.set = function(state, prop, value) {\n\tif (\n\t\tprocess.env.NODE_ENV !== \"production\" &&\n\t\tprop !== \"length\" &&\n\t\tisNaN(parseInt(prop as any))\n\t)\n\t\tdie(14)\n\treturn objectTraps.set!.call(this, state[0], prop, value, state[0])\n}\n\n// Access a property without creating an Immer draft.\nfunction peek(draft: Drafted, prop: PropertyKey) {\n\tconst state = draft[DRAFT_STATE]\n\tconst source = state ? latest(state) : draft\n\treturn source[prop]\n}\n\nfunction readPropFromProto(state: ImmerState, source: any, prop: PropertyKey) {\n\tconst desc = getDescriptorFromProto(source, prop)\n\treturn desc\n\t\t? `value` in desc\n\t\t\t? desc.value\n\t\t\t: // This is a very special case, if the prop is a getter defined by the\n\t\t\t  // prototype, we should invoke it with the draft as context!\n\t\t\t  desc.get?.call(state.draft_)\n\t\t: undefined\n}\n\nfunction getDescriptorFromProto(\n\tsource: any,\n\tprop: PropertyKey\n): PropertyDescriptor | undefined {\n\t// 'in' checks proto!\n\tif (!(prop in source)) return undefined\n\tlet proto = getPrototypeOf(source)\n\twhile (proto) {\n\t\tconst desc = Object.getOwnPropertyDescriptor(proto, prop)\n\t\tif (desc) return desc\n\t\tproto = getPrototypeOf(proto)\n\t}\n\treturn undefined\n}\n\nexport function markChanged(state: ImmerState) {\n\tif (!state.modified_) {\n\t\tstate.modified_ = true\n\t\tif (state.parent_) {\n\t\t\tmarkChanged(state.parent_)\n\t\t}\n\t}\n}\n\nexport function prepareCopy(state: {\n\tbase_: any\n\tcopy_: any\n\tscope_: ImmerScope\n}) {\n\tif (!state.copy_) {\n\t\tstate.copy_ = shallowCopy(\n\t\t\tstate.base_,\n\t\t\tstate.scope_.immer_.useStrictShallowCopy_\n\t\t)\n\t}\n}\n","import {\n\tIProduceWithPatches,\n\tIProduce,\n\tImmerState,\n\tDrafted,\n\tisDraftable,\n\tprocessResult,\n\tPatch,\n\tObjectish,\n\tDRAFT_STATE,\n\tDraft,\n\tPatchListener,\n\tisDraft,\n\tisMap,\n\tisSet,\n\tcreateProxyProxy,\n\tgetPlugin,\n\tdie,\n\tenterScope,\n\trevokeScope,\n\tleaveScope,\n\tusePatchesInScope,\n\tgetCurrentScope,\n\tNOTHING,\n\tfreeze,\n\tcurrent\n} from \"../internal\"\n\ninterface ProducersFns {\n\tproduce: IProduce\n\tproduceWithPatches: IProduceWithPatches\n}\n\nexport class Immer implements ProducersFns {\n\tautoFreeze_: boolean = true\n\tuseStrictShallowCopy_: boolean = false\n\n\tconstructor(config?: {autoFreeze?: boolean; useStrictShallowCopy?: boolean}) {\n\t\tif (typeof config?.autoFreeze === \"boolean\")\n\t\t\tthis.setAutoFreeze(config!.autoFreeze)\n\t\tif (typeof config?.useStrictShallowCopy === \"boolean\")\n\t\t\tthis.setUseStrictShallowCopy(config!.useStrictShallowCopy)\n\t}\n\n\t/**\n\t * The `produce` function takes a value and a \"recipe function\" (whose\n\t * return value often depends on the base state). The recipe function is\n\t * free to mutate its first argument however it wants. All mutations are\n\t * only ever applied to a __copy__ of the base state.\n\t *\n\t * Pass only a function to create a \"curried producer\" which relieves you\n\t * from passing the recipe function every time.\n\t *\n\t * Only plain objects and arrays are made mutable. All other objects are\n\t * considered uncopyable.\n\t *\n\t * Note: This function is __bound__ to its `Immer` instance.\n\t *\n\t * @param {any} base - the initial state\n\t * @param {Function} recipe - function that receives a proxy of the base state as first argument and which can be freely modified\n\t * @param {Function} patchListener - optional function that will be called with all the patches produced here\n\t * @returns {any} a new state, or the initial state if nothing was modified\n\t */\n\tproduce: IProduce = (base: any, recipe?: any, patchListener?: any) => {\n\t\t// curried invocation\n\t\tif (typeof base === \"function\" && typeof recipe !== \"function\") {\n\t\t\tconst defaultBase = recipe\n\t\t\trecipe = base\n\n\t\t\tconst self = this\n\t\t\treturn function curriedProduce(\n\t\t\t\tthis: any,\n\t\t\t\tbase = defaultBase,\n\t\t\t\t...args: any[]\n\t\t\t) {\n\t\t\t\treturn self.produce(base, (draft: Drafted) => recipe.call(this, draft, ...args)) // prettier-ignore\n\t\t\t}\n\t\t}\n\n\t\tif (typeof recipe !== \"function\") die(6)\n\t\tif (patchListener !== undefined && typeof patchListener !== \"function\")\n\t\t\tdie(7)\n\n\t\tlet result\n\n\t\t// Only plain objects, arrays, and \"immerable classes\" are drafted.\n\t\tif (isDraftable(base)) {\n\t\t\tconst scope = enterScope(this)\n\t\t\tconst proxy = createProxy(base, undefined)\n\t\t\tlet hasError = true\n\t\t\ttry {\n\t\t\t\tresult = recipe(proxy)\n\t\t\t\thasError = false\n\t\t\t} finally {\n\t\t\t\t// finally instead of catch + rethrow better preserves original stack\n\t\t\t\tif (hasError) revokeScope(scope)\n\t\t\t\telse leaveScope(scope)\n\t\t\t}\n\t\t\tusePatchesInScope(scope, patchListener)\n\t\t\treturn processResult(result, scope)\n\t\t} else if (!base || typeof base !== \"object\") {\n\t\t\tresult = recipe(base)\n\t\t\tif (result === undefined) result = base\n\t\t\tif (result === NOTHING) result = undefined\n\t\t\tif (this.autoFreeze_) freeze(result, true)\n\t\t\tif (patchListener) {\n\t\t\t\tconst p: Patch[] = []\n\t\t\t\tconst ip: Patch[] = []\n\t\t\t\tgetPlugin(\"Patches\").generateReplacementPatches_(base, result, p, ip)\n\t\t\t\tpatchListener(p, ip)\n\t\t\t}\n\t\t\treturn result\n\t\t} else die(1, base)\n\t}\n\n\tproduceWithPatches: IProduceWithPatches = (base: any, recipe?: any): any => {\n\t\t// curried invocation\n\t\tif (typeof base === \"function\") {\n\t\t\treturn (state: any, ...args: any[]) =>\n\t\t\t\tthis.produceWithPatches(state, (draft: any) => base(draft, ...args))\n\t\t}\n\n\t\tlet patches: Patch[], inversePatches: Patch[]\n\t\tconst result = this.produce(base, recipe, (p: Patch[], ip: Patch[]) => {\n\t\t\tpatches = p\n\t\t\tinversePatches = ip\n\t\t})\n\t\treturn [result, patches!, inversePatches!]\n\t}\n\n\tcreateDraft<T extends Objectish>(base: T): Draft<T> {\n\t\tif (!isDraftable(base)) die(8)\n\t\tif (isDraft(base)) base = current(base)\n\t\tconst scope = enterScope(this)\n\t\tconst proxy = createProxy(base, undefined)\n\t\tproxy[DRAFT_STATE].isManual_ = true\n\t\tleaveScope(scope)\n\t\treturn proxy as any\n\t}\n\n\tfinishDraft<D extends Draft<any>>(\n\t\tdraft: D,\n\t\tpatchListener?: PatchListener\n\t): D extends Draft<infer T> ? T : never {\n\t\tconst state: ImmerState = draft && (draft as any)[DRAFT_STATE]\n\t\tif (!state || !state.isManual_) die(9)\n\t\tconst {scope_: scope} = state\n\t\tusePatchesInScope(scope, patchListener)\n\t\treturn processResult(undefined, scope)\n\t}\n\n\t/**\n\t * Pass true to automatically freeze all copies created by Immer.\n\t *\n\t * By default, auto-freezing is enabled.\n\t */\n\tsetAutoFreeze(value: boolean) {\n\t\tthis.autoFreeze_ = value\n\t}\n\n\t/**\n\t * Pass true to enable strict shallow copy.\n\t *\n\t * By default, immer does not copy the object descriptors such as getter, setter and non-enumrable properties.\n\t */\n\tsetUseStrictShallowCopy(value: boolean) {\n\t\tthis.useStrictShallowCopy_ = value\n\t}\n\n\tapplyPatches<T extends Objectish>(base: T, patches: Patch[]): T {\n\t\t// If a patch replaces the entire state, take that replacement as base\n\t\t// before applying patches\n\t\tlet i: number\n\t\tfor (i = patches.length - 1; i >= 0; i--) {\n\t\t\tconst patch = patches[i]\n\t\t\tif (patch.path.length === 0 && patch.op === \"replace\") {\n\t\t\t\tbase = patch.value\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\t// If there was a patch that replaced the entire state, start from the\n\t\t// patch after that.\n\t\tif (i > -1) {\n\t\t\tpatches = patches.slice(i + 1)\n\t\t}\n\n\t\tconst applyPatchesImpl = getPlugin(\"Patches\").applyPatches_\n\t\tif (isDraft(base)) {\n\t\t\t// N.B: never hits if some patch a replacement, patches are never drafts\n\t\t\treturn applyPatchesImpl(base, patches)\n\t\t}\n\t\t// Otherwise, produce a copy of the base state.\n\t\treturn this.produce(base, (draft: Drafted) =>\n\t\t\tapplyPatchesImpl(draft, patches)\n\t\t)\n\t}\n}\n\nexport function createProxy<T extends Objectish>(\n\tvalue: T,\n\tparent?: ImmerState\n): Drafted<T, ImmerState> {\n\t// precondition: createProxy should be guarded by isDraftable, so we know we can safely draft\n\tconst draft: Drafted = isMap(value)\n\t\t? getPlugin(\"MapSet\").proxyMap_(value, parent)\n\t\t: isSet(value)\n\t\t? getPlugin(\"MapSet\").proxySet_(value, parent)\n\t\t: createProxyProxy(value, parent)\n\n\tconst scope = parent ? parent.scope_ : getCurrentScope()\n\tscope.drafts_.push(draft)\n\treturn draft\n}\n","import {\n\tdie,\n\tisDraft,\n\tshallowCopy,\n\teach,\n\tDRAFT_STATE,\n\tset,\n\tImmerState,\n\tisDraftable,\n\tisFrozen\n} from \"../internal\"\n\n/** Takes a snapshot of the current state of a draft and finalizes it (but without freezing). This is a great utility to print the current state during debugging (no Proxies in the way). The output of current can also be safely leaked outside the producer. */\nexport function current<T>(value: T): T\nexport function current(value: any): any {\n\tif (!isDraft(value)) die(10, value)\n\treturn currentImpl(value)\n}\n\nfunction currentImpl(value: any): any {\n\tif (!isDraftable(value) || isFrozen(value)) return value\n\tconst state: ImmerState | undefined = value[DRAFT_STATE]\n\tlet copy: any\n\tif (state) {\n\t\tif (!state.modified_) return state.base_\n\t\t// Optimization: avoid generating new drafts during copying\n\t\tstate.finalized_ = true\n\t\tcopy = shallowCopy(value, state.scope_.immer_.useStrictShallowCopy_)\n\t} else {\n\t\tcopy = shallowCopy(value, true)\n\t}\n\t// recurse\n\teach(copy, (key, childValue) => {\n\t\tset(copy, key, currentImpl(childValue))\n\t})\n\tif (state) {\n\t\tstate.finalized_ = false\n\t}\n\treturn copy\n}\n","import {immerable} from \"../immer\"\nimport {\n\tImmerState,\n\tPatch,\n\tSetState,\n\tProxyArrayState,\n\tMapState,\n\tProxyObjectState,\n\tPatchPath,\n\tget,\n\teach,\n\thas,\n\tgetArchtype,\n\tgetPrototypeOf,\n\tisSet,\n\tisMap,\n\tloadPlugin,\n\tArchType,\n\tdie,\n\tisDraft,\n\tisDraftable,\n\tNOTHING,\n\terrors\n} from \"../internal\"\n\nexport function enablePatches() {\n\tconst errorOffset = 16\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\terrors.push(\n\t\t\t'Sets cannot have \"replace\" patches.',\n\t\t\tfunction(op: string) {\n\t\t\t\treturn \"Unsupported patch operation: \" + op\n\t\t\t},\n\t\t\tfunction(path: string) {\n\t\t\t\treturn \"Cannot apply patch, path doesn't resolve: \" + path\n\t\t\t},\n\t\t\t\"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"\n\t\t)\n\t}\n\n\tconst REPLACE = \"replace\"\n\tconst ADD = \"add\"\n\tconst REMOVE = \"remove\"\n\n\tfunction generatePatches_(\n\t\tstate: ImmerState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t): void {\n\t\tswitch (state.type_) {\n\t\t\tcase ArchType.Object:\n\t\t\tcase ArchType.Map:\n\t\t\t\treturn generatePatchesFromAssigned(\n\t\t\t\t\tstate,\n\t\t\t\t\tbasePath,\n\t\t\t\t\tpatches,\n\t\t\t\t\tinversePatches\n\t\t\t\t)\n\t\t\tcase ArchType.Array:\n\t\t\t\treturn generateArrayPatches(state, basePath, patches, inversePatches)\n\t\t\tcase ArchType.Set:\n\t\t\t\treturn generateSetPatches(\n\t\t\t\t\t(state as any) as SetState,\n\t\t\t\t\tbasePath,\n\t\t\t\t\tpatches,\n\t\t\t\t\tinversePatches\n\t\t\t\t)\n\t\t}\n\t}\n\n\tfunction generateArrayPatches(\n\t\tstate: ProxyArrayState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t) {\n\t\tlet {base_, assigned_} = state\n\t\tlet copy_ = state.copy_!\n\n\t\t// Reduce complexity by ensuring `base` is never longer.\n\t\tif (copy_.length < base_.length) {\n\t\t\t// @ts-ignore\n\t\t\t;[base_, copy_] = [copy_, base_]\n\t\t\t;[patches, inversePatches] = [inversePatches, patches]\n\t\t}\n\n\t\t// Process replaced indices.\n\t\tfor (let i = 0; i < base_.length; i++) {\n\t\t\tif (assigned_[i] && copy_[i] !== base_[i]) {\n\t\t\t\tconst path = basePath.concat([i])\n\t\t\t\tpatches.push({\n\t\t\t\t\top: REPLACE,\n\t\t\t\t\tpath,\n\t\t\t\t\t// Need to maybe clone it, as it can in fact be the original value\n\t\t\t\t\t// due to the base/copy inversion at the start of this function\n\t\t\t\t\tvalue: clonePatchValueIfNeeded(copy_[i])\n\t\t\t\t})\n\t\t\t\tinversePatches.push({\n\t\t\t\t\top: REPLACE,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue: clonePatchValueIfNeeded(base_[i])\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\t// Process added indices.\n\t\tfor (let i = base_.length; i < copy_.length; i++) {\n\t\t\tconst path = basePath.concat([i])\n\t\t\tpatches.push({\n\t\t\t\top: ADD,\n\t\t\t\tpath,\n\t\t\t\t// Need to maybe clone it, as it can in fact be the original value\n\t\t\t\t// due to the base/copy inversion at the start of this function\n\t\t\t\tvalue: clonePatchValueIfNeeded(copy_[i])\n\t\t\t})\n\t\t}\n\t\tfor (let i = copy_.length - 1; base_.length <= i; --i) {\n\t\t\tconst path = basePath.concat([i])\n\t\t\tinversePatches.push({\n\t\t\t\top: REMOVE,\n\t\t\t\tpath\n\t\t\t})\n\t\t}\n\t}\n\n\t// This is used for both Map objects and normal objects.\n\tfunction generatePatchesFromAssigned(\n\t\tstate: MapState | ProxyObjectState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t) {\n\t\tconst {base_, copy_} = state\n\t\teach(state.assigned_!, (key, assignedValue) => {\n\t\t\tconst origValue = get(base_, key)\n\t\t\tconst value = get(copy_!, key)\n\t\t\tconst op = !assignedValue ? REMOVE : has(base_, key) ? REPLACE : ADD\n\t\t\tif (origValue === value && op === REPLACE) return\n\t\t\tconst path = basePath.concat(key as any)\n\t\t\tpatches.push(op === REMOVE ? {op, path} : {op, path, value})\n\t\t\tinversePatches.push(\n\t\t\t\top === ADD\n\t\t\t\t\t? {op: REMOVE, path}\n\t\t\t\t\t: op === REMOVE\n\t\t\t\t\t? {op: ADD, path, value: clonePatchValueIfNeeded(origValue)}\n\t\t\t\t\t: {op: REPLACE, path, value: clonePatchValueIfNeeded(origValue)}\n\t\t\t)\n\t\t})\n\t}\n\n\tfunction generateSetPatches(\n\t\tstate: SetState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t) {\n\t\tlet {base_, copy_} = state\n\n\t\tlet i = 0\n\t\tbase_.forEach((value: any) => {\n\t\t\tif (!copy_!.has(value)) {\n\t\t\t\tconst path = basePath.concat([i])\n\t\t\t\tpatches.push({\n\t\t\t\t\top: REMOVE,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t\tinversePatches.unshift({\n\t\t\t\t\top: ADD,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t}\n\t\t\ti++\n\t\t})\n\t\ti = 0\n\t\tcopy_!.forEach((value: any) => {\n\t\t\tif (!base_.has(value)) {\n\t\t\t\tconst path = basePath.concat([i])\n\t\t\t\tpatches.push({\n\t\t\t\t\top: ADD,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t\tinversePatches.unshift({\n\t\t\t\t\top: REMOVE,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t}\n\t\t\ti++\n\t\t})\n\t}\n\n\tfunction generateReplacementPatches_(\n\t\tbaseValue: any,\n\t\treplacement: any,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t): void {\n\t\tpatches.push({\n\t\t\top: REPLACE,\n\t\t\tpath: [],\n\t\t\tvalue: replacement === NOTHING ? undefined : replacement\n\t\t})\n\t\tinversePatches.push({\n\t\t\top: REPLACE,\n\t\t\tpath: [],\n\t\t\tvalue: baseValue\n\t\t})\n\t}\n\n\tfunction applyPatches_<T>(draft: T, patches: Patch[]): T {\n\t\tpatches.forEach(patch => {\n\t\t\tconst {path, op} = patch\n\n\t\t\tlet base: any = draft\n\t\t\tfor (let i = 0; i < path.length - 1; i++) {\n\t\t\t\tconst parentType = getArchtype(base)\n\t\t\t\tlet p = path[i]\n\t\t\t\tif (typeof p !== \"string\" && typeof p !== \"number\") {\n\t\t\t\t\tp = \"\" + p\n\t\t\t\t}\n\n\t\t\t\t// See #738, avoid prototype pollution\n\t\t\t\tif (\n\t\t\t\t\t(parentType === ArchType.Object || parentType === ArchType.Array) &&\n\t\t\t\t\t(p === \"__proto__\" || p === \"constructor\")\n\t\t\t\t)\n\t\t\t\t\tdie(errorOffset + 3)\n\t\t\t\tif (typeof base === \"function\" && p === \"prototype\")\n\t\t\t\t\tdie(errorOffset + 3)\n\t\t\t\tbase = get(base, p)\n\t\t\t\tif (typeof base !== \"object\") die(errorOffset + 2, path.join(\"/\"))\n\t\t\t}\n\n\t\t\tconst type = getArchtype(base)\n\t\t\tconst value = deepClonePatchValue(patch.value) // used to clone patch to ensure original patch is not modified, see #411\n\t\t\tconst key = path[path.length - 1]\n\t\t\tswitch (op) {\n\t\t\t\tcase REPLACE:\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase ArchType.Map:\n\t\t\t\t\t\t\treturn base.set(key, value)\n\t\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\t\tcase ArchType.Set:\n\t\t\t\t\t\t\tdie(errorOffset)\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// if value is an object, then it's assigned by reference\n\t\t\t\t\t\t\t// in the following add or remove ops, the value field inside the patch will also be modifyed\n\t\t\t\t\t\t\t// so we use value from the cloned patch\n\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\treturn (base[key] = value)\n\t\t\t\t\t}\n\t\t\t\tcase ADD:\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase ArchType.Array:\n\t\t\t\t\t\t\treturn key === \"-\"\n\t\t\t\t\t\t\t\t? base.push(value)\n\t\t\t\t\t\t\t\t: base.splice(key as any, 0, value)\n\t\t\t\t\t\tcase ArchType.Map:\n\t\t\t\t\t\t\treturn base.set(key, value)\n\t\t\t\t\t\tcase ArchType.Set:\n\t\t\t\t\t\t\treturn base.add(value)\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn (base[key] = value)\n\t\t\t\t\t}\n\t\t\t\tcase REMOVE:\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase ArchType.Array:\n\t\t\t\t\t\t\treturn base.splice(key as any, 1)\n\t\t\t\t\t\tcase ArchType.Map:\n\t\t\t\t\t\t\treturn base.delete(key)\n\t\t\t\t\t\tcase ArchType.Set:\n\t\t\t\t\t\t\treturn base.delete(patch.value)\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn delete base[key]\n\t\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tdie(errorOffset + 1, op)\n\t\t\t}\n\t\t})\n\n\t\treturn draft\n\t}\n\n\t// optimize: this is quite a performance hit, can we detect intelligently when it is needed?\n\t// E.g. auto-draft when new objects from outside are assigned and modified?\n\t// (See failing test when deepClone just returns obj)\n\tfunction deepClonePatchValue<T>(obj: T): T\n\tfunction deepClonePatchValue(obj: any) {\n\t\tif (!isDraftable(obj)) return obj\n\t\tif (Array.isArray(obj)) return obj.map(deepClonePatchValue)\n\t\tif (isMap(obj))\n\t\t\treturn new Map(\n\t\t\t\tArray.from(obj.entries()).map(([k, v]) => [k, deepClonePatchValue(v)])\n\t\t\t)\n\t\tif (isSet(obj)) return new Set(Array.from(obj).map(deepClonePatchValue))\n\t\tconst cloned = Object.create(getPrototypeOf(obj))\n\t\tfor (const key in obj) cloned[key] = deepClonePatchValue(obj[key])\n\t\tif (has(obj, immerable)) cloned[immerable] = obj[immerable]\n\t\treturn cloned\n\t}\n\n\tfunction clonePatchValueIfNeeded<T>(obj: T): T {\n\t\tif (isDraft(obj)) {\n\t\t\treturn deepClonePatchValue(obj)\n\t\t} else return obj\n\t}\n\n\tloadPlugin(\"Patches\", {\n\t\tapplyPatches_,\n\t\tgeneratePatches_,\n\t\tgenerateReplacementPatches_\n\t})\n}\n","// types only!\nimport {\n\tImmerState,\n\tAnyMap,\n\tAnySet,\n\tMapState,\n\tSetState,\n\tDRAFT_STATE,\n\tgetCurrentScope,\n\tlatest,\n\tisDraftable,\n\tcreateProxy,\n\tloadPlugin,\n\tmarkChanged,\n\tdie,\n\tArchType,\n\teach\n} from \"../internal\"\n\nexport function enableMapSet() {\n\tclass DraftMap extends Map {\n\t\t[DRAFT_STATE]: MapState\n\n\t\tconstructor(target: AnyMap, parent?: ImmerState) {\n\t\t\tsuper()\n\t\t\tthis[DRAFT_STATE] = {\n\t\t\t\ttype_: ArchType.Map,\n\t\t\t\tparent_: parent,\n\t\t\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t\t\tmodified_: false,\n\t\t\t\tfinalized_: false,\n\t\t\t\tcopy_: undefined,\n\t\t\t\tassigned_: undefined,\n\t\t\t\tbase_: target,\n\t\t\t\tdraft_: this as any,\n\t\t\t\tisManual_: false,\n\t\t\t\trevoked_: false\n\t\t\t}\n\t\t}\n\n\t\tget size(): number {\n\t\t\treturn latest(this[DRAFT_STATE]).size\n\t\t}\n\n\t\thas(key: any): boolean {\n\t\t\treturn latest(this[DRAFT_STATE]).has(key)\n\t\t}\n\n\t\tset(key: any, value: any) {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (!latest(state).has(key) || latest(state).get(key) !== value) {\n\t\t\t\tprepareMapCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.assigned_!.set(key, true)\n\t\t\t\tstate.copy_!.set(key, value)\n\t\t\t\tstate.assigned_!.set(key, true)\n\t\t\t}\n\t\t\treturn this\n\t\t}\n\n\t\tdelete(key: any): boolean {\n\t\t\tif (!this.has(key)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareMapCopy(state)\n\t\t\tmarkChanged(state)\n\t\t\tif (state.base_.has(key)) {\n\t\t\t\tstate.assigned_!.set(key, false)\n\t\t\t} else {\n\t\t\t\tstate.assigned_!.delete(key)\n\t\t\t}\n\t\t\tstate.copy_!.delete(key)\n\t\t\treturn true\n\t\t}\n\n\t\tclear() {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (latest(state).size) {\n\t\t\t\tprepareMapCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.assigned_ = new Map()\n\t\t\t\teach(state.base_, key => {\n\t\t\t\t\tstate.assigned_!.set(key, false)\n\t\t\t\t})\n\t\t\t\tstate.copy_!.clear()\n\t\t\t}\n\t\t}\n\n\t\tforEach(cb: (value: any, key: any, self: any) => void, thisArg?: any) {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tlatest(state).forEach((_value: any, key: any, _map: any) => {\n\t\t\t\tcb.call(thisArg, this.get(key), key, this)\n\t\t\t})\n\t\t}\n\n\t\tget(key: any): any {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tconst value = latest(state).get(key)\n\t\t\tif (state.finalized_ || !isDraftable(value)) {\n\t\t\t\treturn value\n\t\t\t}\n\t\t\tif (value !== state.base_.get(key)) {\n\t\t\t\treturn value // either already drafted or reassigned\n\t\t\t}\n\t\t\t// despite what it looks, this creates a draft only once, see above condition\n\t\t\tconst draft = createProxy(value, state)\n\t\t\tprepareMapCopy(state)\n\t\t\tstate.copy_!.set(key, draft)\n\t\t\treturn draft\n\t\t}\n\n\t\tkeys(): IterableIterator<any> {\n\t\t\treturn latest(this[DRAFT_STATE]).keys()\n\t\t}\n\n\t\tvalues(): IterableIterator<any> {\n\t\t\tconst iterator = this.keys()\n\t\t\treturn {\n\t\t\t\t[Symbol.iterator]: () => this.values(),\n\t\t\t\tnext: () => {\n\t\t\t\t\tconst r = iterator.next()\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tif (r.done) return r\n\t\t\t\t\tconst value = this.get(r.value)\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdone: false,\n\t\t\t\t\t\tvalue\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as any\n\t\t}\n\n\t\tentries(): IterableIterator<[any, any]> {\n\t\t\tconst iterator = this.keys()\n\t\t\treturn {\n\t\t\t\t[Symbol.iterator]: () => this.entries(),\n\t\t\t\tnext: () => {\n\t\t\t\t\tconst r = iterator.next()\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tif (r.done) return r\n\t\t\t\t\tconst value = this.get(r.value)\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdone: false,\n\t\t\t\t\t\tvalue: [r.value, value]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as any\n\t\t}\n\n\t\t[Symbol.iterator]() {\n\t\t\treturn this.entries()\n\t\t}\n\t}\n\n\tfunction proxyMap_<T extends AnyMap>(target: T, parent?: ImmerState): T {\n\t\t// @ts-ignore\n\t\treturn new DraftMap(target, parent)\n\t}\n\n\tfunction prepareMapCopy(state: MapState) {\n\t\tif (!state.copy_) {\n\t\t\tstate.assigned_ = new Map()\n\t\t\tstate.copy_ = new Map(state.base_)\n\t\t}\n\t}\n\n\tclass DraftSet extends Set {\n\t\t[DRAFT_STATE]: SetState\n\t\tconstructor(target: AnySet, parent?: ImmerState) {\n\t\t\tsuper()\n\t\t\tthis[DRAFT_STATE] = {\n\t\t\t\ttype_: ArchType.Set,\n\t\t\t\tparent_: parent,\n\t\t\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t\t\tmodified_: false,\n\t\t\t\tfinalized_: false,\n\t\t\t\tcopy_: undefined,\n\t\t\t\tbase_: target,\n\t\t\t\tdraft_: this,\n\t\t\t\tdrafts_: new Map(),\n\t\t\t\trevoked_: false,\n\t\t\t\tisManual_: false\n\t\t\t}\n\t\t}\n\n\t\tget size(): number {\n\t\t\treturn latest(this[DRAFT_STATE]).size\n\t\t}\n\n\t\thas(value: any): boolean {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\t// bit of trickery here, to be able to recognize both the value, and the draft of its value\n\t\t\tif (!state.copy_) {\n\t\t\t\treturn state.base_.has(value)\n\t\t\t}\n\t\t\tif (state.copy_.has(value)) return true\n\t\t\tif (state.drafts_.has(value) && state.copy_.has(state.drafts_.get(value)))\n\t\t\t\treturn true\n\t\t\treturn false\n\t\t}\n\n\t\tadd(value: any): any {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (!this.has(value)) {\n\t\t\t\tprepareSetCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.copy_!.add(value)\n\t\t\t}\n\t\t\treturn this\n\t\t}\n\n\t\tdelete(value: any): any {\n\t\t\tif (!this.has(value)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\tmarkChanged(state)\n\t\t\treturn (\n\t\t\t\tstate.copy_!.delete(value) ||\n\t\t\t\t(state.drafts_.has(value)\n\t\t\t\t\t? state.copy_!.delete(state.drafts_.get(value))\n\t\t\t\t\t: /* istanbul ignore next */ false)\n\t\t\t)\n\t\t}\n\n\t\tclear() {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (latest(state).size) {\n\t\t\t\tprepareSetCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.copy_!.clear()\n\t\t\t}\n\t\t}\n\n\t\tvalues(): IterableIterator<any> {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\treturn state.copy_!.values()\n\t\t}\n\n\t\tentries(): IterableIterator<[any, any]> {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\treturn state.copy_!.entries()\n\t\t}\n\n\t\tkeys(): IterableIterator<any> {\n\t\t\treturn this.values()\n\t\t}\n\n\t\t[Symbol.iterator]() {\n\t\t\treturn this.values()\n\t\t}\n\n\t\tforEach(cb: any, thisArg?: any) {\n\t\t\tconst iterator = this.values()\n\t\t\tlet result = iterator.next()\n\t\t\twhile (!result.done) {\n\t\t\t\tcb.call(thisArg, result.value, result.value, this)\n\t\t\t\tresult = iterator.next()\n\t\t\t}\n\t\t}\n\t}\n\tfunction proxySet_<T extends AnySet>(target: T, parent?: ImmerState): T {\n\t\t// @ts-ignore\n\t\treturn new DraftSet(target, parent)\n\t}\n\n\tfunction prepareSetCopy(state: SetState) {\n\t\tif (!state.copy_) {\n\t\t\t// create drafts for all entries to preserve insertion order\n\t\t\tstate.copy_ = new Set()\n\t\t\tstate.base_.forEach(value => {\n\t\t\t\tif (isDraftable(value)) {\n\t\t\t\t\tconst draft = createProxy(value, state)\n\t\t\t\t\tstate.drafts_.set(value, draft)\n\t\t\t\t\tstate.copy_!.add(draft)\n\t\t\t\t} else {\n\t\t\t\t\tstate.copy_!.add(value)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tfunction assertUnrevoked(state: any /*ES5State | MapState | SetState*/) {\n\t\tif (state.revoked_) die(3, JSON.stringify(latest(state)))\n\t}\n\n\tloadPlugin(\"MapSet\", {proxyMap_, proxySet_})\n}\n"],"mappings":"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","ignoreList":[]}