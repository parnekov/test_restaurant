b8c2065e638f0a3d7010d08ce5a8abc0
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = void 0;
var _cleanupSemantic = require('./cleanupSemantic');
var concatenateRelevantDiffs = function concatenateRelevantDiffs(op, diffs, changeColor) {
  return diffs.reduce(function (reduced, diff) {
    return reduced + (diff[0] === _cleanupSemantic.DIFF_EQUAL ? diff[1] : diff[0] === op && diff[1].length !== 0 ? changeColor(diff[1]) : '');
  }, '');
};
var ChangeBuffer = function () {
  function ChangeBuffer(op, changeColor) {
    (0, _classCallCheck2.default)(this, ChangeBuffer);
    this.op = op;
    this.line = [];
    this.lines = [];
    this.changeColor = changeColor;
  }
  return (0, _createClass2.default)(ChangeBuffer, [{
    key: "pushSubstring",
    value: function pushSubstring(substring) {
      this.pushDiff(new _cleanupSemantic.Diff(this.op, substring));
    }
  }, {
    key: "pushLine",
    value: function pushLine() {
      this.lines.push(this.line.length !== 1 ? new _cleanupSemantic.Diff(this.op, concatenateRelevantDiffs(this.op, this.line, this.changeColor)) : this.line[0][0] === this.op ? this.line[0] : new _cleanupSemantic.Diff(this.op, this.line[0][1]));
      this.line.length = 0;
    }
  }, {
    key: "isLineEmpty",
    value: function isLineEmpty() {
      return this.line.length === 0;
    }
  }, {
    key: "pushDiff",
    value: function pushDiff(diff) {
      this.line.push(diff);
    }
  }, {
    key: "align",
    value: function align(diff) {
      var _this = this;
      var string = diff[1];
      if (string.includes('\n')) {
        var substrings = string.split('\n');
        var iLast = substrings.length - 1;
        substrings.forEach(function (substring, i) {
          if (i < iLast) {
            _this.pushSubstring(substring);
            _this.pushLine();
          } else if (substring.length !== 0) {
            _this.pushSubstring(substring);
          }
        });
      } else {
        this.pushDiff(diff);
      }
    }
  }, {
    key: "moveLinesTo",
    value: function moveLinesTo(lines) {
      if (!this.isLineEmpty()) {
        this.pushLine();
      }
      lines.push.apply(lines, (0, _toConsumableArray2.default)(this.lines));
      this.lines.length = 0;
    }
  }]);
}();
var CommonBuffer = function () {
  function CommonBuffer(deleteBuffer, insertBuffer) {
    (0, _classCallCheck2.default)(this, CommonBuffer);
    this.deleteBuffer = deleteBuffer;
    this.insertBuffer = insertBuffer;
    this.lines = [];
  }
  return (0, _createClass2.default)(CommonBuffer, [{
    key: "pushDiffCommonLine",
    value: function pushDiffCommonLine(diff) {
      this.lines.push(diff);
    }
  }, {
    key: "pushDiffChangeLines",
    value: function pushDiffChangeLines(diff) {
      var isDiffEmpty = diff[1].length === 0;
      if (!isDiffEmpty || this.deleteBuffer.isLineEmpty()) {
        this.deleteBuffer.pushDiff(diff);
      }
      if (!isDiffEmpty || this.insertBuffer.isLineEmpty()) {
        this.insertBuffer.pushDiff(diff);
      }
    }
  }, {
    key: "flushChangeLines",
    value: function flushChangeLines() {
      this.deleteBuffer.moveLinesTo(this.lines);
      this.insertBuffer.moveLinesTo(this.lines);
    }
  }, {
    key: "align",
    value: function align(diff) {
      var _this2 = this;
      var op = diff[0];
      var string = diff[1];
      if (string.includes('\n')) {
        var substrings = string.split('\n');
        var iLast = substrings.length - 1;
        substrings.forEach(function (substring, i) {
          if (i === 0) {
            var subdiff = new _cleanupSemantic.Diff(op, substring);
            if (_this2.deleteBuffer.isLineEmpty() && _this2.insertBuffer.isLineEmpty()) {
              _this2.flushChangeLines();
              _this2.pushDiffCommonLine(subdiff);
            } else {
              _this2.pushDiffChangeLines(subdiff);
              _this2.flushChangeLines();
            }
          } else if (i < iLast) {
            _this2.pushDiffCommonLine(new _cleanupSemantic.Diff(op, substring));
          } else if (substring.length !== 0) {
            _this2.pushDiffChangeLines(new _cleanupSemantic.Diff(op, substring));
          }
        });
      } else {
        this.pushDiffChangeLines(diff);
      }
    }
  }, {
    key: "getLines",
    value: function getLines() {
      this.flushChangeLines();
      return this.lines;
    }
  }]);
}();
var getAlignedDiffs = function getAlignedDiffs(diffs, changeColor) {
  var deleteBuffer = new ChangeBuffer(_cleanupSemantic.DIFF_DELETE, changeColor);
  var insertBuffer = new ChangeBuffer(_cleanupSemantic.DIFF_INSERT, changeColor);
  var commonBuffer = new CommonBuffer(deleteBuffer, insertBuffer);
  diffs.forEach(function (diff) {
    switch (diff[0]) {
      case _cleanupSemantic.DIFF_DELETE:
        deleteBuffer.align(diff);
        break;
      case _cleanupSemantic.DIFF_INSERT:
        insertBuffer.align(diff);
        break;
      default:
        commonBuffer.align(diff);
    }
  });
  return commonBuffer.getLines();
};
var _default = getAlignedDiffs;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl90b0NvbnN1bWFibGVBcnJheTIiLCJfY2xhc3NDYWxsQ2hlY2syIiwiX2NyZWF0ZUNsYXNzMiIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsIl9jbGVhbnVwU2VtYW50aWMiLCJjb25jYXRlbmF0ZVJlbGV2YW50RGlmZnMiLCJvcCIsImRpZmZzIiwiY2hhbmdlQ29sb3IiLCJyZWR1Y2UiLCJyZWR1Y2VkIiwiZGlmZiIsIkRJRkZfRVFVQUwiLCJsZW5ndGgiLCJDaGFuZ2VCdWZmZXIiLCJsaW5lIiwibGluZXMiLCJrZXkiLCJwdXNoU3Vic3RyaW5nIiwic3Vic3RyaW5nIiwicHVzaERpZmYiLCJEaWZmIiwicHVzaExpbmUiLCJwdXNoIiwiaXNMaW5lRW1wdHkiLCJhbGlnbiIsIl90aGlzIiwic3RyaW5nIiwiaW5jbHVkZXMiLCJzdWJzdHJpbmdzIiwic3BsaXQiLCJpTGFzdCIsImZvckVhY2giLCJpIiwibW92ZUxpbmVzVG8iLCJhcHBseSIsIkNvbW1vbkJ1ZmZlciIsImRlbGV0ZUJ1ZmZlciIsImluc2VydEJ1ZmZlciIsInB1c2hEaWZmQ29tbW9uTGluZSIsInB1c2hEaWZmQ2hhbmdlTGluZXMiLCJpc0RpZmZFbXB0eSIsImZsdXNoQ2hhbmdlTGluZXMiLCJfdGhpczIiLCJzdWJkaWZmIiwiZ2V0TGluZXMiLCJnZXRBbGlnbmVkRGlmZnMiLCJESUZGX0RFTEVURSIsIkRJRkZfSU5TRVJUIiwiY29tbW9uQnVmZmVyIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyJnZXRBbGlnbmVkRGlmZnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcbnZhciBfY2xlYW51cFNlbWFudGljID0gcmVxdWlyZSgnLi9jbGVhbnVwU2VtYW50aWMnKTtcbi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG4vLyBHaXZlbiBjaGFuZ2Ugb3AgYW5kIGFycmF5IG9mIGRpZmZzLCByZXR1cm4gY29uY2F0ZW5hdGVkIHN0cmluZzpcbi8vICogaW5jbHVkZSBjb21tb24gc3RyaW5nc1xuLy8gKiBpbmNsdWRlIGNoYW5nZSBzdHJpbmdzIHdoaWNoIGhhdmUgYXJndW1lbnQgb3Agd2l0aCBjaGFuZ2VDb2xvclxuLy8gKiBleGNsdWRlIGNoYW5nZSBzdHJpbmdzIHdoaWNoIGhhdmUgb3Bwb3NpdGUgb3BcbmNvbnN0IGNvbmNhdGVuYXRlUmVsZXZhbnREaWZmcyA9IChvcCwgZGlmZnMsIGNoYW5nZUNvbG9yKSA9PlxuICBkaWZmcy5yZWR1Y2UoXG4gICAgKHJlZHVjZWQsIGRpZmYpID0+XG4gICAgICByZWR1Y2VkICtcbiAgICAgIChkaWZmWzBdID09PSBfY2xlYW51cFNlbWFudGljLkRJRkZfRVFVQUxcbiAgICAgICAgPyBkaWZmWzFdXG4gICAgICAgIDogZGlmZlswXSA9PT0gb3AgJiYgZGlmZlsxXS5sZW5ndGggIT09IDAgLy8gZW1wdHkgaWYgY2hhbmdlIGlzIG5ld2xpbmVcbiAgICAgICAgPyBjaGFuZ2VDb2xvcihkaWZmWzFdKVxuICAgICAgICA6ICcnKSxcbiAgICAnJ1xuICApO1xuXG4vLyBFbmNhcHN1bGF0ZSBjaGFuZ2UgbGluZXMgdW50aWwgZWl0aGVyIGEgY29tbW9uIG5ld2xpbmUgb3IgdGhlIGVuZC5cbmNsYXNzIENoYW5nZUJ1ZmZlciB7XG4gIG9wO1xuICBsaW5lOyAvLyBpbmNvbXBsZXRlIGxpbmVcbiAgbGluZXM7IC8vIGNvbXBsZXRlIGxpbmVzXG4gIGNoYW5nZUNvbG9yO1xuICBjb25zdHJ1Y3RvcihvcCwgY2hhbmdlQ29sb3IpIHtcbiAgICB0aGlzLm9wID0gb3A7XG4gICAgdGhpcy5saW5lID0gW107XG4gICAgdGhpcy5saW5lcyA9IFtdO1xuICAgIHRoaXMuY2hhbmdlQ29sb3IgPSBjaGFuZ2VDb2xvcjtcbiAgfVxuICBwdXNoU3Vic3RyaW5nKHN1YnN0cmluZykge1xuICAgIHRoaXMucHVzaERpZmYobmV3IF9jbGVhbnVwU2VtYW50aWMuRGlmZih0aGlzLm9wLCBzdWJzdHJpbmcpKTtcbiAgfVxuICBwdXNoTGluZSgpIHtcbiAgICAvLyBBc3N1bWUgY2FsbCBvbmx5IGlmIGxpbmUgaGFzIGF0IGxlYXN0IG9uZSBkaWZmLFxuICAgIC8vIHRoZXJlZm9yZSBhbiBlbXB0eSBsaW5lIG11c3QgaGF2ZSBhIGRpZmYgd2hpY2ggaGFzIGFuIGVtcHR5IHN0cmluZy5cblxuICAgIC8vIElmIGxpbmUgaGFzIG11bHRpcGxlIGRpZmZzLCB0aGVuIGFzc3VtZSBpdCBoYXMgYSBjb21tb24gZGlmZixcbiAgICAvLyB0aGVyZWZvcmUgY2hhbmdlIGRpZmZzIGhhdmUgY2hhbmdlIGNvbG9yO1xuICAgIC8vIG90aGVyd2lzZSB0aGVuIGl0IGhhcyBsaW5lIGNvbG9yIG9ubHkuXG4gICAgdGhpcy5saW5lcy5wdXNoKFxuICAgICAgdGhpcy5saW5lLmxlbmd0aCAhPT0gMVxuICAgICAgICA/IG5ldyBfY2xlYW51cFNlbWFudGljLkRpZmYoXG4gICAgICAgICAgICB0aGlzLm9wLFxuICAgICAgICAgICAgY29uY2F0ZW5hdGVSZWxldmFudERpZmZzKHRoaXMub3AsIHRoaXMubGluZSwgdGhpcy5jaGFuZ2VDb2xvcilcbiAgICAgICAgICApXG4gICAgICAgIDogdGhpcy5saW5lWzBdWzBdID09PSB0aGlzLm9wXG4gICAgICAgID8gdGhpcy5saW5lWzBdIC8vIGNhbiB1c2UgaW5zdGFuY2VcbiAgICAgICAgOiBuZXcgX2NsZWFudXBTZW1hbnRpYy5EaWZmKHRoaXMub3AsIHRoaXMubGluZVswXVsxXSkgLy8gd2FzIGNvbW1vbiBkaWZmXG4gICAgKTtcblxuICAgIHRoaXMubGluZS5sZW5ndGggPSAwO1xuICB9XG4gIGlzTGluZUVtcHR5KCkge1xuICAgIHJldHVybiB0aGlzLmxpbmUubGVuZ3RoID09PSAwO1xuICB9XG5cbiAgLy8gTWlub3IgaW5wdXQgdG8gYnVmZmVyLlxuICBwdXNoRGlmZihkaWZmKSB7XG4gICAgdGhpcy5saW5lLnB1c2goZGlmZik7XG4gIH1cblxuICAvLyBNYWluIGlucHV0IHRvIGJ1ZmZlci5cbiAgYWxpZ24oZGlmZikge1xuICAgIGNvbnN0IHN0cmluZyA9IGRpZmZbMV07XG4gICAgaWYgKHN0cmluZy5pbmNsdWRlcygnXFxuJykpIHtcbiAgICAgIGNvbnN0IHN1YnN0cmluZ3MgPSBzdHJpbmcuc3BsaXQoJ1xcbicpO1xuICAgICAgY29uc3QgaUxhc3QgPSBzdWJzdHJpbmdzLmxlbmd0aCAtIDE7XG4gICAgICBzdWJzdHJpbmdzLmZvckVhY2goKHN1YnN0cmluZywgaSkgPT4ge1xuICAgICAgICBpZiAoaSA8IGlMYXN0KSB7XG4gICAgICAgICAgLy8gVGhlIGZpcnN0IHN1YnN0cmluZyBjb21wbGV0ZXMgdGhlIGN1cnJlbnQgY2hhbmdlIGxpbmUuXG4gICAgICAgICAgLy8gQSBtaWRkbGUgc3Vic3RyaW5nIGlzIGEgY2hhbmdlIGxpbmUuXG4gICAgICAgICAgdGhpcy5wdXNoU3Vic3RyaW5nKHN1YnN0cmluZyk7XG4gICAgICAgICAgdGhpcy5wdXNoTGluZSgpO1xuICAgICAgICB9IGVsc2UgaWYgKHN1YnN0cmluZy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAvLyBUaGUgbGFzdCBzdWJzdHJpbmcgc3RhcnRzIGEgY2hhbmdlIGxpbmUsIGlmIGl0IGlzIG5vdCBlbXB0eS5cbiAgICAgICAgICAvLyBJbXBvcnRhbnQ6IFRoaXMgbm9uLWVtcHR5IGNvbmRpdGlvbiBhbHNvIGF1dG9tYXRpY2FsbHkgb21pdHNcbiAgICAgICAgICAvLyB0aGUgbmV3bGluZSBhcHBlbmRlZCB0byB0aGUgZW5kIG9mIGV4cGVjdGVkIGFuZCByZWNlaXZlZCBzdHJpbmdzLlxuICAgICAgICAgIHRoaXMucHVzaFN1YnN0cmluZyhzdWJzdHJpbmcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQXBwZW5kIG5vbi1tdWx0aWxpbmUgc3RyaW5nIHRvIGN1cnJlbnQgY2hhbmdlIGxpbmUuXG4gICAgICB0aGlzLnB1c2hEaWZmKGRpZmYpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE91dHB1dCBmcm9tIGJ1ZmZlci5cbiAgbW92ZUxpbmVzVG8obGluZXMpIHtcbiAgICBpZiAoIXRoaXMuaXNMaW5lRW1wdHkoKSkge1xuICAgICAgdGhpcy5wdXNoTGluZSgpO1xuICAgIH1cbiAgICBsaW5lcy5wdXNoKC4uLnRoaXMubGluZXMpO1xuICAgIHRoaXMubGluZXMubGVuZ3RoID0gMDtcbiAgfVxufVxuXG4vLyBFbmNhcHN1bGF0ZSBjb21tb24gYW5kIGNoYW5nZSBsaW5lcy5cbmNsYXNzIENvbW1vbkJ1ZmZlciB7XG4gIGRlbGV0ZUJ1ZmZlcjtcbiAgaW5zZXJ0QnVmZmVyO1xuICBsaW5lcztcbiAgY29uc3RydWN0b3IoZGVsZXRlQnVmZmVyLCBpbnNlcnRCdWZmZXIpIHtcbiAgICB0aGlzLmRlbGV0ZUJ1ZmZlciA9IGRlbGV0ZUJ1ZmZlcjtcbiAgICB0aGlzLmluc2VydEJ1ZmZlciA9IGluc2VydEJ1ZmZlcjtcbiAgICB0aGlzLmxpbmVzID0gW107XG4gIH1cbiAgcHVzaERpZmZDb21tb25MaW5lKGRpZmYpIHtcbiAgICB0aGlzLmxpbmVzLnB1c2goZGlmZik7XG4gIH1cbiAgcHVzaERpZmZDaGFuZ2VMaW5lcyhkaWZmKSB7XG4gICAgY29uc3QgaXNEaWZmRW1wdHkgPSBkaWZmWzFdLmxlbmd0aCA9PT0gMDtcblxuICAgIC8vIEFuIGVtcHR5IGRpZmYgc3RyaW5nIGlzIHJlZHVuZGFudCwgdW5sZXNzIGEgY2hhbmdlIGxpbmUgaXMgZW1wdHkuXG4gICAgaWYgKCFpc0RpZmZFbXB0eSB8fCB0aGlzLmRlbGV0ZUJ1ZmZlci5pc0xpbmVFbXB0eSgpKSB7XG4gICAgICB0aGlzLmRlbGV0ZUJ1ZmZlci5wdXNoRGlmZihkaWZmKTtcbiAgICB9XG4gICAgaWYgKCFpc0RpZmZFbXB0eSB8fCB0aGlzLmluc2VydEJ1ZmZlci5pc0xpbmVFbXB0eSgpKSB7XG4gICAgICB0aGlzLmluc2VydEJ1ZmZlci5wdXNoRGlmZihkaWZmKTtcbiAgICB9XG4gIH1cbiAgZmx1c2hDaGFuZ2VMaW5lcygpIHtcbiAgICB0aGlzLmRlbGV0ZUJ1ZmZlci5tb3ZlTGluZXNUbyh0aGlzLmxpbmVzKTtcbiAgICB0aGlzLmluc2VydEJ1ZmZlci5tb3ZlTGluZXNUbyh0aGlzLmxpbmVzKTtcbiAgfVxuXG4gIC8vIElucHV0IHRvIGJ1ZmZlci5cbiAgYWxpZ24oZGlmZikge1xuICAgIGNvbnN0IG9wID0gZGlmZlswXTtcbiAgICBjb25zdCBzdHJpbmcgPSBkaWZmWzFdO1xuICAgIGlmIChzdHJpbmcuaW5jbHVkZXMoJ1xcbicpKSB7XG4gICAgICBjb25zdCBzdWJzdHJpbmdzID0gc3RyaW5nLnNwbGl0KCdcXG4nKTtcbiAgICAgIGNvbnN0IGlMYXN0ID0gc3Vic3RyaW5ncy5sZW5ndGggLSAxO1xuICAgICAgc3Vic3RyaW5ncy5mb3JFYWNoKChzdWJzdHJpbmcsIGkpID0+IHtcbiAgICAgICAgaWYgKGkgPT09IDApIHtcbiAgICAgICAgICBjb25zdCBzdWJkaWZmID0gbmV3IF9jbGVhbnVwU2VtYW50aWMuRGlmZihvcCwgc3Vic3RyaW5nKTtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICB0aGlzLmRlbGV0ZUJ1ZmZlci5pc0xpbmVFbXB0eSgpICYmXG4gICAgICAgICAgICB0aGlzLmluc2VydEJ1ZmZlci5pc0xpbmVFbXB0eSgpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICAvLyBJZiBib3RoIGN1cnJlbnQgY2hhbmdlIGxpbmVzIGFyZSBlbXB0eSxcbiAgICAgICAgICAgIC8vIHRoZW4gdGhlIGZpcnN0IHN1YnN0cmluZyBpcyBhIGNvbW1vbiBsaW5lLlxuICAgICAgICAgICAgdGhpcy5mbHVzaENoYW5nZUxpbmVzKCk7XG4gICAgICAgICAgICB0aGlzLnB1c2hEaWZmQ29tbW9uTGluZShzdWJkaWZmKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgZWl0aGVyIGN1cnJlbnQgY2hhbmdlIGxpbmUgaXMgbm9uLWVtcHR5LFxuICAgICAgICAgICAgLy8gdGhlbiB0aGUgZmlyc3Qgc3Vic3RyaW5nIGNvbXBsZXRlcyB0aGUgY2hhbmdlIGxpbmVzLlxuICAgICAgICAgICAgdGhpcy5wdXNoRGlmZkNoYW5nZUxpbmVzKHN1YmRpZmYpO1xuICAgICAgICAgICAgdGhpcy5mbHVzaENoYW5nZUxpbmVzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGkgPCBpTGFzdCkge1xuICAgICAgICAgIC8vIEEgbWlkZGxlIHN1YnN0cmluZyBpcyBhIGNvbW1vbiBsaW5lLlxuICAgICAgICAgIHRoaXMucHVzaERpZmZDb21tb25MaW5lKG5ldyBfY2xlYW51cFNlbWFudGljLkRpZmYob3AsIHN1YnN0cmluZykpO1xuICAgICAgICB9IGVsc2UgaWYgKHN1YnN0cmluZy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAvLyBUaGUgbGFzdCBzdWJzdHJpbmcgc3RhcnRzIGEgY2hhbmdlIGxpbmUsIGlmIGl0IGlzIG5vdCBlbXB0eS5cbiAgICAgICAgICAvLyBJbXBvcnRhbnQ6IFRoaXMgbm9uLWVtcHR5IGNvbmRpdGlvbiBhbHNvIGF1dG9tYXRpY2FsbHkgb21pdHNcbiAgICAgICAgICAvLyB0aGUgbmV3bGluZSBhcHBlbmRlZCB0byB0aGUgZW5kIG9mIGV4cGVjdGVkIGFuZCByZWNlaXZlZCBzdHJpbmdzLlxuICAgICAgICAgIHRoaXMucHVzaERpZmZDaGFuZ2VMaW5lcyhuZXcgX2NsZWFudXBTZW1hbnRpYy5EaWZmKG9wLCBzdWJzdHJpbmcpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEFwcGVuZCBub24tbXVsdGlsaW5lIHN0cmluZyB0byBjdXJyZW50IGNoYW5nZSBsaW5lcy5cbiAgICAgIC8vIEltcG9ydGFudDogSXQgY2Fubm90IGJlIGF0IHRoZSBlbmQgZm9sbG93aW5nIGVtcHR5IGNoYW5nZSBsaW5lcyxcbiAgICAgIC8vIGJlY2F1c2UgbmV3bGluZSBhcHBlbmRlZCB0byB0aGUgZW5kIG9mIGV4cGVjdGVkIGFuZCByZWNlaXZlZCBzdHJpbmdzLlxuICAgICAgdGhpcy5wdXNoRGlmZkNoYW5nZUxpbmVzKGRpZmYpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE91dHB1dCBmcm9tIGJ1ZmZlci5cbiAgZ2V0TGluZXMoKSB7XG4gICAgdGhpcy5mbHVzaENoYW5nZUxpbmVzKCk7XG4gICAgcmV0dXJuIHRoaXMubGluZXM7XG4gIH1cbn1cblxuLy8gR2l2ZW4gZGlmZnMgZnJvbSBleHBlY3RlZCBhbmQgcmVjZWl2ZWQgc3RyaW5ncyxcbi8vIHJldHVybiBuZXcgYXJyYXkgb2YgZGlmZnMgc3BsaXQgb3Igam9pbmVkIGludG8gbGluZXMuXG4vL1xuLy8gVG8gY29ycmVjdGx5IGFsaWduIGEgY2hhbmdlIGxpbmUgYXQgdGhlIGVuZCwgdGhlIGFsZ29yaXRobTpcbi8vICogYXNzdW1lcyB0aGF0IGEgbmV3bGluZSB3YXMgYXBwZW5kZWQgdG8gdGhlIHN0cmluZ3Ncbi8vICogb21pdHMgdGhlIGxhc3QgbmV3bGluZSBmcm9tIHRoZSBvdXRwdXQgYXJyYXlcbi8vXG4vLyBBc3N1bWUgdGhlIGZ1bmN0aW9uIGlzIG5vdCBjYWxsZWQ6XG4vLyAqIGlmIGVpdGhlciBleHBlY3RlZCBvciByZWNlaXZlZCBpcyBlbXB0eSBzdHJpbmdcbi8vICogaWYgbmVpdGhlciBleHBlY3RlZCBub3IgcmVjZWl2ZWQgaXMgbXVsdGlsaW5lIHN0cmluZ1xuY29uc3QgZ2V0QWxpZ25lZERpZmZzID0gKGRpZmZzLCBjaGFuZ2VDb2xvcikgPT4ge1xuICBjb25zdCBkZWxldGVCdWZmZXIgPSBuZXcgQ2hhbmdlQnVmZmVyKFxuICAgIF9jbGVhbnVwU2VtYW50aWMuRElGRl9ERUxFVEUsXG4gICAgY2hhbmdlQ29sb3JcbiAgKTtcbiAgY29uc3QgaW5zZXJ0QnVmZmVyID0gbmV3IENoYW5nZUJ1ZmZlcihcbiAgICBfY2xlYW51cFNlbWFudGljLkRJRkZfSU5TRVJULFxuICAgIGNoYW5nZUNvbG9yXG4gICk7XG4gIGNvbnN0IGNvbW1vbkJ1ZmZlciA9IG5ldyBDb21tb25CdWZmZXIoZGVsZXRlQnVmZmVyLCBpbnNlcnRCdWZmZXIpO1xuICBkaWZmcy5mb3JFYWNoKGRpZmYgPT4ge1xuICAgIHN3aXRjaCAoZGlmZlswXSkge1xuICAgICAgY2FzZSBfY2xlYW51cFNlbWFudGljLkRJRkZfREVMRVRFOlxuICAgICAgICBkZWxldGVCdWZmZXIuYWxpZ24oZGlmZik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBfY2xlYW51cFNlbWFudGljLkRJRkZfSU5TRVJUOlxuICAgICAgICBpbnNlcnRCdWZmZXIuYWxpZ24oZGlmZik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29tbW9uQnVmZmVyLmFsaWduKGRpZmYpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBjb21tb25CdWZmZXIuZ2V0TGluZXMoKTtcbn07XG52YXIgX2RlZmF1bHQgPSBnZXRBbGlnbmVkRGlmZnM7XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUEsSUFBQUMsbUJBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFFLGdCQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUFBRyxhQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7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