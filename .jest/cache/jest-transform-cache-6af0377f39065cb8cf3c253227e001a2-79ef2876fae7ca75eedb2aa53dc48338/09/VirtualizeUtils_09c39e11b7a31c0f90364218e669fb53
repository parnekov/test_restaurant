32bd9740a607b89c17fbddd3b9edbcc7
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.computeWindowedRenderLimits = computeWindowedRenderLimits;
exports.elementsThatOverlapOffsets = elementsThatOverlapOffsets;
exports.keyExtractor = keyExtractor;
exports.newRangeCount = newRangeCount;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
function elementsThatOverlapOffsets(offsets, props, listMetrics) {
  var zoomScale = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
  var itemCount = props.getItemCount(props.data);
  var result = [];
  for (var offsetIndex = 0; offsetIndex < offsets.length; offsetIndex++) {
    var currentOffset = offsets[offsetIndex];
    var left = 0;
    var right = itemCount - 1;
    while (left <= right) {
      var mid = left + Math.floor((right - left) / 2);
      var frame = listMetrics.getCellMetricsApprox(mid, props);
      var scaledOffsetStart = frame.offset * zoomScale;
      var scaledOffsetEnd = (frame.offset + frame.length) * zoomScale;
      if (mid === 0 && currentOffset < scaledOffsetStart || mid !== 0 && currentOffset <= scaledOffsetStart) {
        right = mid - 1;
      } else if (currentOffset > scaledOffsetEnd) {
        left = mid + 1;
      } else {
        result[offsetIndex] = mid;
        break;
      }
    }
  }
  return result;
}
function newRangeCount(prev, next) {
  return next.last - next.first + 1 - Math.max(0, 1 + Math.min(next.last, prev.last) - Math.max(next.first, prev.first));
}
function computeWindowedRenderLimits(props, maxToRenderPerBatch, windowSize, prev, listMetrics, scrollMetrics) {
  var itemCount = props.getItemCount(props.data);
  if (itemCount === 0) {
    return {
      first: 0,
      last: -1
    };
  }
  var offset = scrollMetrics.offset,
    velocity = scrollMetrics.velocity,
    visibleLength = scrollMetrics.visibleLength,
    _scrollMetrics$zoomSc = scrollMetrics.zoomScale,
    zoomScale = _scrollMetrics$zoomSc === void 0 ? 1 : _scrollMetrics$zoomSc;
  var visibleBegin = Math.max(0, offset);
  var visibleEnd = visibleBegin + visibleLength;
  var overscanLength = (windowSize - 1) * visibleLength;
  var leadFactor = 0.5;
  var fillPreference = velocity > 1 ? 'after' : velocity < -1 ? 'before' : 'none';
  var overscanBegin = Math.max(0, visibleBegin - (1 - leadFactor) * overscanLength);
  var overscanEnd = Math.max(0, visibleEnd + leadFactor * overscanLength);
  var lastItemOffset = listMetrics.getCellMetricsApprox(itemCount - 1, props).offset * zoomScale;
  if (lastItemOffset < overscanBegin) {
    return {
      first: Math.max(0, itemCount - 1 - maxToRenderPerBatch),
      last: itemCount - 1
    };
  }
  var _elementsThatOverlapO = elementsThatOverlapOffsets([overscanBegin, visibleBegin, visibleEnd, overscanEnd], props, listMetrics, zoomScale),
    _elementsThatOverlapO2 = (0, _slicedToArray2.default)(_elementsThatOverlapO, 4),
    overscanFirst = _elementsThatOverlapO2[0],
    first = _elementsThatOverlapO2[1],
    last = _elementsThatOverlapO2[2],
    overscanLast = _elementsThatOverlapO2[3];
  overscanFirst = overscanFirst == null ? 0 : overscanFirst;
  first = first == null ? Math.max(0, overscanFirst) : first;
  overscanLast = overscanLast == null ? itemCount - 1 : overscanLast;
  last = last == null ? Math.min(overscanLast, first + maxToRenderPerBatch - 1) : last;
  var visible = {
    first: first,
    last: last
  };
  var newCellCount = newRangeCount(prev, visible);
  while (true) {
    if (first <= overscanFirst && last >= overscanLast) {
      break;
    }
    var maxNewCells = newCellCount >= maxToRenderPerBatch;
    var firstWillAddMore = first <= prev.first || first > prev.last;
    var firstShouldIncrement = first > overscanFirst && (!maxNewCells || !firstWillAddMore);
    var lastWillAddMore = last >= prev.last || last < prev.first;
    var lastShouldIncrement = last < overscanLast && (!maxNewCells || !lastWillAddMore);
    if (maxNewCells && !firstShouldIncrement && !lastShouldIncrement) {
      break;
    }
    if (firstShouldIncrement && !(fillPreference === 'after' && lastShouldIncrement && lastWillAddMore)) {
      if (firstWillAddMore) {
        newCellCount++;
      }
      first--;
    }
    if (lastShouldIncrement && !(fillPreference === 'before' && firstShouldIncrement && firstWillAddMore)) {
      if (lastWillAddMore) {
        newCellCount++;
      }
      last++;
    }
  }
  if (!(last >= first && first >= 0 && last < itemCount && first >= overscanFirst && last <= overscanLast && first <= visible.first && last >= visible.last)) {
    throw new Error('Bad window calculation ' + JSON.stringify({
      first: first,
      last: last,
      itemCount: itemCount,
      overscanFirst: overscanFirst,
      overscanLast: overscanLast,
      visible: visible
    }));
  }
  return {
    first: first,
    last: last
  };
}
function keyExtractor(item, index) {
  if (typeof item === 'object' && (item == null ? void 0 : item.key) != null) {
    return item.key;
  }
  if (typeof item === 'object' && (item == null ? void 0 : item.id) != null) {
    return item.id;
  }
  return String(index);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY29tcHV0ZVdpbmRvd2VkUmVuZGVyTGltaXRzIiwiZWxlbWVudHNUaGF0T3ZlcmxhcE9mZnNldHMiLCJrZXlFeHRyYWN0b3IiLCJuZXdSYW5nZUNvdW50IiwiX3NsaWNlZFRvQXJyYXkyIiwib2Zmc2V0cyIsInByb3BzIiwibGlzdE1ldHJpY3MiLCJ6b29tU2NhbGUiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJpdGVtQ291bnQiLCJnZXRJdGVtQ291bnQiLCJkYXRhIiwicmVzdWx0Iiwib2Zmc2V0SW5kZXgiLCJjdXJyZW50T2Zmc2V0IiwibGVmdCIsInJpZ2h0IiwibWlkIiwiTWF0aCIsImZsb29yIiwiZnJhbWUiLCJnZXRDZWxsTWV0cmljc0FwcHJveCIsInNjYWxlZE9mZnNldFN0YXJ0Iiwib2Zmc2V0Iiwic2NhbGVkT2Zmc2V0RW5kIiwicHJldiIsIm5leHQiLCJsYXN0IiwiZmlyc3QiLCJtYXgiLCJtaW4iLCJtYXhUb1JlbmRlclBlckJhdGNoIiwid2luZG93U2l6ZSIsInNjcm9sbE1ldHJpY3MiLCJ2ZWxvY2l0eSIsInZpc2libGVMZW5ndGgiLCJfc2Nyb2xsTWV0cmljcyR6b29tU2MiLCJ2aXNpYmxlQmVnaW4iLCJ2aXNpYmxlRW5kIiwib3ZlcnNjYW5MZW5ndGgiLCJsZWFkRmFjdG9yIiwiZmlsbFByZWZlcmVuY2UiLCJvdmVyc2NhbkJlZ2luIiwib3ZlcnNjYW5FbmQiLCJsYXN0SXRlbU9mZnNldCIsIl9lbGVtZW50c1RoYXRPdmVybGFwTyIsIl9lbGVtZW50c1RoYXRPdmVybGFwTzIiLCJkZWZhdWx0Iiwib3ZlcnNjYW5GaXJzdCIsIm92ZXJzY2FuTGFzdCIsInZpc2libGUiLCJuZXdDZWxsQ291bnQiLCJtYXhOZXdDZWxscyIsImZpcnN0V2lsbEFkZE1vcmUiLCJmaXJzdFNob3VsZEluY3JlbWVudCIsImxhc3RXaWxsQWRkTW9yZSIsImxhc3RTaG91bGRJbmNyZW1lbnQiLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJpdGVtIiwiaW5kZXgiLCJrZXkiLCJpZCIsIlN0cmluZyJdLCJzb3VyY2VzIjpbIlZpcnR1YWxpemVVdGlscy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgTWV0YSBQbGF0Zm9ybXMsIEluYy4gYW5kIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB0eXBlIExpc3RNZXRyaWNzQWdncmVnYXRvciwge1xuICBDZWxsTWV0cmljUHJvcHMsXG59IGZyb20gJy4vTGlzdE1ldHJpY3NBZ2dyZWdhdG9yJztcblxuLyoqXG4gKiBVc2VkIHRvIGZpbmQgdGhlIGluZGljZXMgb2YgdGhlIGZyYW1lcyB0aGF0IG92ZXJsYXAgdGhlIGdpdmVuIG9mZnNldHMuIFVzZWZ1bCBmb3IgZmluZGluZyB0aGVcbiAqIGl0ZW1zIHRoYXQgYm91bmQgZGlmZmVyZW50IHdpbmRvd3Mgb2YgY29udGVudCwgc3VjaCBhcyB0aGUgdmlzaWJsZSBhcmVhIG9yIHRoZSBidWZmZXJlZCBvdmVyc2NhblxuICogYXJlYS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVsZW1lbnRzVGhhdE92ZXJsYXBPZmZzZXRzKFxuICBvZmZzZXRzOiBBcnJheTxudW1iZXI+LFxuICBwcm9wczogQ2VsbE1ldHJpY1Byb3BzLFxuICBsaXN0TWV0cmljczogTGlzdE1ldHJpY3NBZ2dyZWdhdG9yLFxuICB6b29tU2NhbGU6IG51bWJlciA9IDEsXG4pOiBBcnJheTxudW1iZXI+IHtcbiAgY29uc3QgaXRlbUNvdW50ID0gcHJvcHMuZ2V0SXRlbUNvdW50KHByb3BzLmRhdGEpO1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChsZXQgb2Zmc2V0SW5kZXggPSAwOyBvZmZzZXRJbmRleCA8IG9mZnNldHMubGVuZ3RoOyBvZmZzZXRJbmRleCsrKSB7XG4gICAgY29uc3QgY3VycmVudE9mZnNldCA9IG9mZnNldHNbb2Zmc2V0SW5kZXhdO1xuICAgIGxldCBsZWZ0ID0gMDtcbiAgICBsZXQgcmlnaHQgPSBpdGVtQ291bnQgLSAxO1xuXG4gICAgd2hpbGUgKGxlZnQgPD0gcmlnaHQpIHtcbiAgICAgIGNvbnN0IG1pZCA9IGxlZnQgKyBNYXRoLmZsb29yKChyaWdodCAtIGxlZnQpIC8gMik7XG4gICAgICBjb25zdCBmcmFtZSA9IGxpc3RNZXRyaWNzLmdldENlbGxNZXRyaWNzQXBwcm94KG1pZCwgcHJvcHMpO1xuICAgICAgY29uc3Qgc2NhbGVkT2Zmc2V0U3RhcnQgPSBmcmFtZS5vZmZzZXQgKiB6b29tU2NhbGU7XG4gICAgICBjb25zdCBzY2FsZWRPZmZzZXRFbmQgPSAoZnJhbWUub2Zmc2V0ICsgZnJhbWUubGVuZ3RoKSAqIHpvb21TY2FsZTtcblxuICAgICAgLy8gV2Ugd2FudCB0aGUgZmlyc3QgZnJhbWUgdGhhdCBjb250YWlucyB0aGUgb2Zmc2V0LCB3aXRoIGluY2x1c2l2ZSBib3VuZHMuIFRodXMsIGZvciB0aGVcbiAgICAgIC8vIGZpcnN0IGZyYW1lIHRoZSBzY2FsZWRPZmZzZXRTdGFydCBpcyBpbmNsdXNpdmUsIHdoaWxlIGZvciBvdGhlciBmcmFtZXMgaXQgaXMgZXhjbHVzaXZlLlxuICAgICAgaWYgKFxuICAgICAgICAobWlkID09PSAwICYmIGN1cnJlbnRPZmZzZXQgPCBzY2FsZWRPZmZzZXRTdGFydCkgfHxcbiAgICAgICAgKG1pZCAhPT0gMCAmJiBjdXJyZW50T2Zmc2V0IDw9IHNjYWxlZE9mZnNldFN0YXJ0KVxuICAgICAgKSB7XG4gICAgICAgIHJpZ2h0ID0gbWlkIC0gMTtcbiAgICAgIH0gZWxzZSBpZiAoY3VycmVudE9mZnNldCA+IHNjYWxlZE9mZnNldEVuZCkge1xuICAgICAgICBsZWZ0ID0gbWlkICsgMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdFtvZmZzZXRJbmRleF0gPSBtaWQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogQ29tcHV0ZXMgdGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgYG5leHRgIHJhbmdlIHRoYXQgYXJlIG5ldyBjb21wYXJlZCB0byB0aGUgYHByZXZgIHJhbmdlLlxuICogSGFuZHkgZm9yIGNhbGN1bGF0aW5nIGhvdyBtYW55IG5ldyBpdGVtcyB3aWxsIGJlIHJlbmRlcmVkIHdoZW4gdGhlIHJlbmRlciB3aW5kb3cgY2hhbmdlcyBzbyB3ZVxuICogY2FuIHJlc3RyaWN0IHRoZSBudW1iZXIgb2YgbmV3IGl0ZW1zIHJlbmRlciBhdCBvbmNlIHNvIHRoYXQgY29udGVudCBjYW4gYXBwZWFyIG9uIHRoZSBzY3JlZW5cbiAqIGZhc3Rlci5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5ld1JhbmdlQ291bnQoXG4gIHByZXY6IHtcbiAgICBmaXJzdDogbnVtYmVyLFxuICAgIGxhc3Q6IG51bWJlcixcbiAgICAuLi5cbiAgfSxcbiAgbmV4dDoge1xuICAgIGZpcnN0OiBudW1iZXIsXG4gICAgbGFzdDogbnVtYmVyLFxuICAgIC4uLlxuICB9LFxuKTogbnVtYmVyIHtcbiAgcmV0dXJuIChcbiAgICBuZXh0Lmxhc3QgLVxuICAgIG5leHQuZmlyc3QgK1xuICAgIDEgLVxuICAgIE1hdGgubWF4KFxuICAgICAgMCxcbiAgICAgIDEgKyBNYXRoLm1pbihuZXh0Lmxhc3QsIHByZXYubGFzdCkgLSBNYXRoLm1heChuZXh0LmZpcnN0LCBwcmV2LmZpcnN0KSxcbiAgICApXG4gICk7XG59XG5cbi8qKlxuICogQ3VzdG9tIGxvZ2ljIGZvciBkZXRlcm1pbmluZyB3aGljaCBpdGVtcyBzaG91bGQgYmUgcmVuZGVyZWQgZ2l2ZW4gdGhlIGN1cnJlbnQgZnJhbWUgYW5kIHNjcm9sbFxuICogbWV0cmljcywgYXMgd2VsbCBhcyB0aGUgcHJldmlvdXMgcmVuZGVyIHN0YXRlLiBUaGUgYWxnb3JpdGhtIG1heSBldm9sdmUgb3ZlciB0aW1lLCBidXQgZ2VuZXJhbGx5XG4gKiBwcmlvcml0aXplcyB0aGUgdmlzaWJsZSBhcmVhIGZpcnN0LCB0aGVuIGV4cGFuZHMgdGhhdCB3aXRoIG92ZXJzY2FuIHJlZ2lvbnMgYWhlYWQgYW5kIGJlaGluZCxcbiAqIGJpYXNlZCBpbiB0aGUgZGlyZWN0aW9uIG9mIHNjcm9sbC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvbXB1dGVXaW5kb3dlZFJlbmRlckxpbWl0cyhcbiAgcHJvcHM6IENlbGxNZXRyaWNQcm9wcyxcbiAgbWF4VG9SZW5kZXJQZXJCYXRjaDogbnVtYmVyLFxuICB3aW5kb3dTaXplOiBudW1iZXIsXG4gIHByZXY6IHtcbiAgICBmaXJzdDogbnVtYmVyLFxuICAgIGxhc3Q6IG51bWJlcixcbiAgfSxcbiAgbGlzdE1ldHJpY3M6IExpc3RNZXRyaWNzQWdncmVnYXRvcixcbiAgc2Nyb2xsTWV0cmljczoge1xuICAgIGR0OiBudW1iZXIsXG4gICAgb2Zmc2V0OiBudW1iZXIsXG4gICAgdmVsb2NpdHk6IG51bWJlcixcbiAgICB2aXNpYmxlTGVuZ3RoOiBudW1iZXIsXG4gICAgem9vbVNjYWxlOiBudW1iZXIsXG4gICAgLi4uXG4gIH0sXG4pOiB7XG4gIGZpcnN0OiBudW1iZXIsXG4gIGxhc3Q6IG51bWJlcixcbn0ge1xuICBjb25zdCBpdGVtQ291bnQgPSBwcm9wcy5nZXRJdGVtQ291bnQocHJvcHMuZGF0YSk7XG4gIGlmIChpdGVtQ291bnQgPT09IDApIHtcbiAgICByZXR1cm4ge2ZpcnN0OiAwLCBsYXN0OiAtMX07XG4gIH1cbiAgY29uc3Qge29mZnNldCwgdmVsb2NpdHksIHZpc2libGVMZW5ndGgsIHpvb21TY2FsZSA9IDF9ID0gc2Nyb2xsTWV0cmljcztcblxuICAvLyBTdGFydCB3aXRoIHZpc2libGUgYXJlYSwgdGhlbiBjb21wdXRlIG1heGltdW0gb3ZlcnNjYW4gcmVnaW9uIGJ5IGV4cGFuZGluZyBmcm9tIHRoZXJlLCBiaWFzZWRcbiAgLy8gaW4gdGhlIGRpcmVjdGlvbiBvZiBzY3JvbGwuIFRvdGFsIG92ZXJzY2FuIGFyZWEgaXMgY2FwcGVkLCB3aGljaCBzaG91bGQgY2FwIG1lbW9yeSBjb25zdW1wdGlvblxuICAvLyB0b28uXG4gIGNvbnN0IHZpc2libGVCZWdpbiA9IE1hdGgubWF4KDAsIG9mZnNldCk7XG4gIGNvbnN0IHZpc2libGVFbmQgPSB2aXNpYmxlQmVnaW4gKyB2aXNpYmxlTGVuZ3RoO1xuICBjb25zdCBvdmVyc2Nhbkxlbmd0aCA9ICh3aW5kb3dTaXplIC0gMSkgKiB2aXNpYmxlTGVuZ3RoO1xuXG4gIC8vIENvbnNpZGVyaW5nIHZlbG9jaXR5IHNlZW1zIHRvIGludHJvZHVjZSBtb3JlIGNodXJuIHRoYW4gaXQncyB3b3J0aC5cbiAgY29uc3QgbGVhZEZhY3RvciA9IDAuNTsgLy8gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgdmVsb2NpdHkgLyAyNSArIDAuNSkpO1xuXG4gIGNvbnN0IGZpbGxQcmVmZXJlbmNlID1cbiAgICB2ZWxvY2l0eSA+IDEgPyAnYWZ0ZXInIDogdmVsb2NpdHkgPCAtMSA/ICdiZWZvcmUnIDogJ25vbmUnO1xuXG4gIGNvbnN0IG92ZXJzY2FuQmVnaW4gPSBNYXRoLm1heChcbiAgICAwLFxuICAgIHZpc2libGVCZWdpbiAtICgxIC0gbGVhZEZhY3RvcikgKiBvdmVyc2Nhbkxlbmd0aCxcbiAgKTtcbiAgY29uc3Qgb3ZlcnNjYW5FbmQgPSBNYXRoLm1heCgwLCB2aXNpYmxlRW5kICsgbGVhZEZhY3RvciAqIG92ZXJzY2FuTGVuZ3RoKTtcblxuICBjb25zdCBsYXN0SXRlbU9mZnNldCA9XG4gICAgbGlzdE1ldHJpY3MuZ2V0Q2VsbE1ldHJpY3NBcHByb3goaXRlbUNvdW50IC0gMSwgcHJvcHMpLm9mZnNldCAqIHpvb21TY2FsZTtcbiAgaWYgKGxhc3RJdGVtT2Zmc2V0IDwgb3ZlcnNjYW5CZWdpbikge1xuICAgIC8vIEVudGlyZSBsaXN0IGlzIGJlZm9yZSBvdXIgb3ZlcnNjYW4gd2luZG93XG4gICAgcmV0dXJuIHtcbiAgICAgIGZpcnN0OiBNYXRoLm1heCgwLCBpdGVtQ291bnQgLSAxIC0gbWF4VG9SZW5kZXJQZXJCYXRjaCksXG4gICAgICBsYXN0OiBpdGVtQ291bnQgLSAxLFxuICAgIH07XG4gIH1cblxuICAvLyBGaW5kIHRoZSBpbmRpY2VzIHRoYXQgY29ycmVzcG9uZCB0byB0aGUgaXRlbXMgYXQgdGhlIHJlbmRlciBib3VuZGFyaWVzIHdlJ3JlIHRhcmdldGluZy5cbiAgbGV0IFtvdmVyc2NhbkZpcnN0LCBmaXJzdCwgbGFzdCwgb3ZlcnNjYW5MYXN0XSA9IGVsZW1lbnRzVGhhdE92ZXJsYXBPZmZzZXRzKFxuICAgIFtvdmVyc2NhbkJlZ2luLCB2aXNpYmxlQmVnaW4sIHZpc2libGVFbmQsIG92ZXJzY2FuRW5kXSxcbiAgICBwcm9wcyxcbiAgICBsaXN0TWV0cmljcyxcbiAgICB6b29tU2NhbGUsXG4gICk7XG4gIG92ZXJzY2FuRmlyc3QgPSBvdmVyc2NhbkZpcnN0ID09IG51bGwgPyAwIDogb3ZlcnNjYW5GaXJzdDtcbiAgZmlyc3QgPSBmaXJzdCA9PSBudWxsID8gTWF0aC5tYXgoMCwgb3ZlcnNjYW5GaXJzdCkgOiBmaXJzdDtcbiAgb3ZlcnNjYW5MYXN0ID0gb3ZlcnNjYW5MYXN0ID09IG51bGwgPyBpdGVtQ291bnQgLSAxIDogb3ZlcnNjYW5MYXN0O1xuICBsYXN0ID1cbiAgICBsYXN0ID09IG51bGxcbiAgICAgID8gTWF0aC5taW4ob3ZlcnNjYW5MYXN0LCBmaXJzdCArIG1heFRvUmVuZGVyUGVyQmF0Y2ggLSAxKVxuICAgICAgOiBsYXN0O1xuICBjb25zdCB2aXNpYmxlID0ge2ZpcnN0LCBsYXN0fTtcblxuICAvLyBXZSB3YW50IHRvIGxpbWl0IHRoZSBudW1iZXIgb2YgbmV3IGNlbGxzIHdlJ3JlIHJlbmRlcmluZyBwZXIgYmF0Y2ggc28gdGhhdCB3ZSBjYW4gZmlsbCB0aGVcbiAgLy8gY29udGVudCBvbiB0aGUgc2NyZWVuIHF1aWNrbHkuIElmIHdlIHJlbmRlcmVkIHRoZSBlbnRpcmUgb3ZlcnNjYW4gd2luZG93IGF0IG9uY2UsIHRoZSB1c2VyXG4gIC8vIGNvdWxkIGJlIHN0YXJpbmcgYXQgd2hpdGUgc3BhY2UgZm9yIGEgbG9uZyB0aW1lIHdhaXRpbmcgZm9yIGEgYnVuY2ggb2Ygb2Zmc2NyZWVuIGNvbnRlbnQgdG9cbiAgLy8gcmVuZGVyLlxuICBsZXQgbmV3Q2VsbENvdW50ID0gbmV3UmFuZ2VDb3VudChwcmV2LCB2aXNpYmxlKTtcblxuICB3aGlsZSAodHJ1ZSkge1xuICAgIGlmIChmaXJzdCA8PSBvdmVyc2NhbkZpcnN0ICYmIGxhc3QgPj0gb3ZlcnNjYW5MYXN0KSB7XG4gICAgICAvLyBJZiB3ZSBmaWxsIHRoZSBlbnRpcmUgb3ZlcnNjYW4gcmFuZ2UsIHdlJ3JlIGRvbmUuXG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY29uc3QgbWF4TmV3Q2VsbHMgPSBuZXdDZWxsQ291bnQgPj0gbWF4VG9SZW5kZXJQZXJCYXRjaDtcbiAgICBjb25zdCBmaXJzdFdpbGxBZGRNb3JlID0gZmlyc3QgPD0gcHJldi5maXJzdCB8fCBmaXJzdCA+IHByZXYubGFzdDtcbiAgICBjb25zdCBmaXJzdFNob3VsZEluY3JlbWVudCA9XG4gICAgICBmaXJzdCA+IG92ZXJzY2FuRmlyc3QgJiYgKCFtYXhOZXdDZWxscyB8fCAhZmlyc3RXaWxsQWRkTW9yZSk7XG4gICAgY29uc3QgbGFzdFdpbGxBZGRNb3JlID0gbGFzdCA+PSBwcmV2Lmxhc3QgfHwgbGFzdCA8IHByZXYuZmlyc3Q7XG4gICAgY29uc3QgbGFzdFNob3VsZEluY3JlbWVudCA9XG4gICAgICBsYXN0IDwgb3ZlcnNjYW5MYXN0ICYmICghbWF4TmV3Q2VsbHMgfHwgIWxhc3RXaWxsQWRkTW9yZSk7XG4gICAgaWYgKG1heE5ld0NlbGxzICYmICFmaXJzdFNob3VsZEluY3JlbWVudCAmJiAhbGFzdFNob3VsZEluY3JlbWVudCkge1xuICAgICAgLy8gV2Ugb25seSB3YW50IHRvIHN0b3AgaWYgd2UndmUgaGl0IG1heE5ld0NlbGxzIEFORCB3ZSBjYW5ub3QgaW5jcmVtZW50IGZpcnN0IG9yIGxhc3RcbiAgICAgIC8vIHdpdGhvdXQgcmVuZGVyaW5nIG5ldyBpdGVtcy4gVGhpcyBsZXQncyB1cyBwcmVzZXJ2ZSBhcyBtYW55IGFscmVhZHkgcmVuZGVyZWQgaXRlbXMgYXNcbiAgICAgIC8vIHBvc3NpYmxlLCByZWR1Y2luZyByZW5kZXIgY2h1cm4gYW5kIGtlZXBpbmcgdGhlIHJlbmRlcmVkIG92ZXJzY2FuIHJhbmdlIGFzIGxhcmdlIGFzXG4gICAgICAvLyBwb3NzaWJsZS5cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICBmaXJzdFNob3VsZEluY3JlbWVudCAmJlxuICAgICAgIShmaWxsUHJlZmVyZW5jZSA9PT0gJ2FmdGVyJyAmJiBsYXN0U2hvdWxkSW5jcmVtZW50ICYmIGxhc3RXaWxsQWRkTW9yZSlcbiAgICApIHtcbiAgICAgIGlmIChmaXJzdFdpbGxBZGRNb3JlKSB7XG4gICAgICAgIG5ld0NlbGxDb3VudCsrO1xuICAgICAgfVxuICAgICAgZmlyc3QtLTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgbGFzdFNob3VsZEluY3JlbWVudCAmJlxuICAgICAgIShmaWxsUHJlZmVyZW5jZSA9PT0gJ2JlZm9yZScgJiYgZmlyc3RTaG91bGRJbmNyZW1lbnQgJiYgZmlyc3RXaWxsQWRkTW9yZSlcbiAgICApIHtcbiAgICAgIGlmIChsYXN0V2lsbEFkZE1vcmUpIHtcbiAgICAgICAgbmV3Q2VsbENvdW50Kys7XG4gICAgICB9XG4gICAgICBsYXN0Kys7XG4gICAgfVxuICB9XG4gIGlmIChcbiAgICAhKFxuICAgICAgbGFzdCA+PSBmaXJzdCAmJlxuICAgICAgZmlyc3QgPj0gMCAmJlxuICAgICAgbGFzdCA8IGl0ZW1Db3VudCAmJlxuICAgICAgZmlyc3QgPj0gb3ZlcnNjYW5GaXJzdCAmJlxuICAgICAgbGFzdCA8PSBvdmVyc2Nhbkxhc3QgJiZcbiAgICAgIGZpcnN0IDw9IHZpc2libGUuZmlyc3QgJiZcbiAgICAgIGxhc3QgPj0gdmlzaWJsZS5sYXN0XG4gICAgKVxuICApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnQmFkIHdpbmRvdyBjYWxjdWxhdGlvbiAnICtcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGZpcnN0LFxuICAgICAgICAgIGxhc3QsXG4gICAgICAgICAgaXRlbUNvdW50LFxuICAgICAgICAgIG92ZXJzY2FuRmlyc3QsXG4gICAgICAgICAgb3ZlcnNjYW5MYXN0LFxuICAgICAgICAgIHZpc2libGUsXG4gICAgICAgIH0pLFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHtmaXJzdCwgbGFzdH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBrZXlFeHRyYWN0b3IoaXRlbTogYW55LCBpbmRleDogbnVtYmVyKTogc3RyaW5nIHtcbiAgaWYgKHR5cGVvZiBpdGVtID09PSAnb2JqZWN0JyAmJiBpdGVtPy5rZXkgIT0gbnVsbCkge1xuICAgIHJldHVybiBpdGVtLmtleTtcbiAgfVxuICBpZiAodHlwZW9mIGl0ZW0gPT09ICdvYmplY3QnICYmIGl0ZW0/LmlkICE9IG51bGwpIHtcbiAgICByZXR1cm4gaXRlbS5pZDtcbiAgfVxuICByZXR1cm4gU3RyaW5nKGluZGV4KTtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBVUEsWUFBWTs7QUFBQyxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBQUFDLE1BQUEsQ0FBQUMsY0FBQSxDQUFBQyxPQUFBO0VBQUFDLEtBQUE7QUFBQTtBQUFBRCxPQUFBLENBQUFFLDJCQUFBLEdBQUFBLDJCQUFBO0FBQUFGLE9BQUEsQ0FBQUcsMEJBQUEsR0FBQUEsMEJBQUE7QUFBQUgsT0FBQSxDQUFBSSxZQUFBLEdBQUFBLFlBQUE7QUFBQUos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