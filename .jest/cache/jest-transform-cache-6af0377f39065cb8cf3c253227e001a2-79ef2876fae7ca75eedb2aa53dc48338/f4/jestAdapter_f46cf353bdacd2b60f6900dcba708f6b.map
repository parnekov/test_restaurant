{"version":3,"names":["_interopRequireDefault","require","_asyncToGenerator2","Object","defineProperty","exports","value","default","_jestUtil","FRAMEWORK_INITIALIZER","resolve","jestAdapter","_ref","globalConfig","config","environment","runtime","testPath","sendMessageToJest","_runtime$requireInter","requireInternalModule","initialize","runAndTransformResultsToJestFormat","_yield$initialize","localRequire","requireModule","bind","parentProcess","process","setGlobalsForRuntime","globals","snapshotState","fakeTimers","enableGlobally","legacyFakeTimers","useFakeTimers","fakeTimersModern","beforeEach","resetModules","clearMocks","clearAllMocks","resetMocks","resetAllMocks","restoreMocks","restoreAllMocks","path","setupFilesAfterEnv","esm","unstable_shouldLoadAsEsm","unstable_importModule","results","_addSnapshotData","deepCyclicCopy","keepPrototype","_x","_x2","_x3","_x4","_x5","_x6","apply","arguments","testResults","forEach","_ref2","fullName","status","markSnapshotsAsCheckedForTest","uncheckedCount","getUncheckedCount","uncheckedKeys","getUncheckedKeys","removeUncheckedKeys","save","snapshot","fileDeleted","deleted","added","matched","unmatched","updated","unchecked","Array","from","_default"],"sources":["jestAdapter.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\nvar _jestUtil = require('jest-util');\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nconst FRAMEWORK_INITIALIZER = require.resolve('./jestAdapterInit');\nconst jestAdapter = async (\n  globalConfig,\n  config,\n  environment,\n  runtime,\n  testPath,\n  sendMessageToJest\n) => {\n  const {initialize, runAndTransformResultsToJestFormat} =\n    runtime.requireInternalModule(FRAMEWORK_INITIALIZER);\n  const {globals, snapshotState} = await initialize({\n    config,\n    environment,\n    globalConfig,\n    localRequire: runtime.requireModule.bind(runtime),\n    parentProcess: process,\n    sendMessageToJest,\n    setGlobalsForRuntime: runtime.setGlobalsForRuntime.bind(runtime),\n    testPath\n  });\n  if (config.fakeTimers.enableGlobally) {\n    if (config.fakeTimers.legacyFakeTimers) {\n      // during setup, this cannot be null (and it's fine to explode if it is)\n      environment.fakeTimers.useFakeTimers();\n    } else {\n      environment.fakeTimersModern.useFakeTimers();\n    }\n  }\n  globals.beforeEach(() => {\n    if (config.resetModules) {\n      runtime.resetModules();\n    }\n    if (config.clearMocks) {\n      runtime.clearAllMocks();\n    }\n    if (config.resetMocks) {\n      runtime.resetAllMocks();\n      if (\n        config.fakeTimers.enableGlobally &&\n        config.fakeTimers.legacyFakeTimers\n      ) {\n        // during setup, this cannot be null (and it's fine to explode if it is)\n        environment.fakeTimers.useFakeTimers();\n      }\n    }\n    if (config.restoreMocks) {\n      runtime.restoreAllMocks();\n    }\n  });\n  for (const path of config.setupFilesAfterEnv) {\n    const esm = runtime.unstable_shouldLoadAsEsm(path);\n    if (esm) {\n      await runtime.unstable_importModule(path);\n    } else {\n      runtime.requireModule(path);\n    }\n  }\n  const esm = runtime.unstable_shouldLoadAsEsm(testPath);\n  if (esm) {\n    await runtime.unstable_importModule(testPath);\n  } else {\n    runtime.requireModule(testPath);\n  }\n  const results = await runAndTransformResultsToJestFormat({\n    config,\n    globalConfig,\n    testPath\n  });\n  _addSnapshotData(results, snapshotState);\n\n  // We need to copy the results object to ensure we don't leaks the prototypes\n  // from the VM. Jasmine creates the result objects in the parent process, we\n  // should consider doing that for circus as well.\n  return (0, _jestUtil.deepCyclicCopy)(results, {\n    keepPrototype: false\n  });\n};\nconst _addSnapshotData = (results, snapshotState) => {\n  results.testResults.forEach(({fullName, status}) => {\n    if (status === 'pending' || status === 'failed') {\n      // if test is skipped or failed, we don't want to mark\n      // its snapshots as obsolete.\n      snapshotState.markSnapshotsAsCheckedForTest(fullName);\n    }\n  });\n  const uncheckedCount = snapshotState.getUncheckedCount();\n  const uncheckedKeys = snapshotState.getUncheckedKeys();\n  if (uncheckedCount) {\n    snapshotState.removeUncheckedKeys();\n  }\n  const status = snapshotState.save();\n  results.snapshot.fileDeleted = status.deleted;\n  results.snapshot.added = snapshotState.added;\n  results.snapshot.matched = snapshotState.matched;\n  results.snapshot.unmatched = snapshotState.unmatched;\n  results.snapshot.updated = snapshotState.updated;\n  results.snapshot.unchecked = !status.deleted ? uncheckedCount : 0;\n  // Copy the array to prevent memory leaks\n  results.snapshot.uncheckedKeys = Array.from(uncheckedKeys);\n};\nvar _default = jestAdapter;\nexports.default = _default;\n"],"mappings":"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","ignoreList":[]}