fca546670c0302cf22f46f277fcf5901
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = exports.TestEnvironment = void 0;
function _vm() {
  var data = require('vm');
  _vm = function _vm() {
    return data;
  };
  return data;
}
function _fakeTimers() {
  var data = require('@jest/fake-timers');
  _fakeTimers = function _fakeTimers() {
    return data;
  };
  return data;
}
function _jestMock() {
  var data = require('jest-mock');
  _jestMock = function _jestMock() {
    return data;
  };
  return data;
}
function _jestUtil() {
  var data = require('jest-util');
  _jestUtil = function _jestUtil() {
    return data;
  };
  return data;
}
var denyList = new Set(['GLOBAL', 'root', 'global', 'globalThis', 'Buffer', 'ArrayBuffer', 'Uint8Array', 'jest-symbol-do-not-touch']);
var nodeGlobals = new Map(Object.getOwnPropertyNames(globalThis).filter(function (global) {
  return !denyList.has(global);
}).map(function (nodeGlobalsKey) {
  var descriptor = Object.getOwnPropertyDescriptor(globalThis, nodeGlobalsKey);
  if (!descriptor) {
    throw new Error(`No property descriptor for ${nodeGlobalsKey}, this is a bug in Jest.`);
  }
  return [nodeGlobalsKey, descriptor];
}));
function isString(value) {
  return typeof value === 'string';
}
var NodeEnvironment = function () {
  function NodeEnvironment(config, _context) {
    (0, _classCallCheck2.default)(this, NodeEnvironment);
    this.customExportConditions = ['node', 'node-addons'];
    var projectConfig = config.projectConfig;
    this.context = (0, _vm().createContext)();
    var global = (0, _vm().runInContext)('this', Object.assign(this.context, projectConfig.testEnvironmentOptions));
    this.global = global;
    var contextGlobals = new Set(Object.getOwnPropertyNames(global));
    var _loop = function _loop(nodeGlobalsKey, descriptor) {
      if (!contextGlobals.has(nodeGlobalsKey)) {
        if (descriptor.configurable) {
          Object.defineProperty(global, nodeGlobalsKey, {
            configurable: true,
            enumerable: descriptor.enumerable,
            get: function get() {
              var value = globalThis[nodeGlobalsKey];
              Object.defineProperty(global, nodeGlobalsKey, {
                configurable: true,
                enumerable: descriptor.enumerable,
                value: value,
                writable: true
              });
              return value;
            },
            set: function set(value) {
              Object.defineProperty(global, nodeGlobalsKey, {
                configurable: true,
                enumerable: descriptor.enumerable,
                value: value,
                writable: true
              });
            }
          });
        } else if ('value' in descriptor) {
          Object.defineProperty(global, nodeGlobalsKey, {
            configurable: false,
            enumerable: descriptor.enumerable,
            value: descriptor.value,
            writable: descriptor.writable
          });
        } else {
          Object.defineProperty(global, nodeGlobalsKey, {
            configurable: false,
            enumerable: descriptor.enumerable,
            get: descriptor.get,
            set: descriptor.set
          });
        }
      }
    };
    for (var _ref of nodeGlobals) {
      var _ref2 = (0, _slicedToArray2.default)(_ref, 2);
      var nodeGlobalsKey = _ref2[0];
      var descriptor = _ref2[1];
      _loop(nodeGlobalsKey, descriptor);
    }
    global.global = global;
    global.Buffer = Buffer;
    global.ArrayBuffer = ArrayBuffer;
    global.Uint8Array = Uint8Array;
    (0, _jestUtil().installCommonGlobals)(global, projectConfig.globals);
    global.Error.stackTraceLimit = 100;
    if ('customExportConditions' in projectConfig.testEnvironmentOptions) {
      var customExportConditions = projectConfig.testEnvironmentOptions.customExportConditions;
      if (Array.isArray(customExportConditions) && customExportConditions.every(isString)) {
        this._configuredExportConditions = customExportConditions;
      } else {
        throw new Error('Custom export conditions specified but they are not an array of strings');
      }
    }
    this.moduleMocker = new (_jestMock().ModuleMocker)(global);
    var timerIdToRef = function timerIdToRef(id) {
      return {
        id: id,
        ref: function ref() {
          return this;
        },
        unref: function unref() {
          return this;
        }
      };
    };
    var timerRefToId = function timerRefToId(timer) {
      return timer == null ? void 0 : timer.id;
    };
    this.fakeTimers = new (_fakeTimers().LegacyFakeTimers)({
      config: projectConfig,
      global: global,
      moduleMocker: this.moduleMocker,
      timerConfig: {
        idToRef: timerIdToRef,
        refToId: timerRefToId
      }
    });
    this.fakeTimersModern = new (_fakeTimers().ModernFakeTimers)({
      config: projectConfig,
      global: global
    });
  }
  return (0, _createClass2.default)(NodeEnvironment, [{
    key: "setup",
    value: function () {
      var _setup = (0, _asyncToGenerator2.default)(function* () {});
      function setup() {
        return _setup.apply(this, arguments);
      }
      return setup;
    }()
  }, {
    key: "teardown",
    value: function () {
      var _teardown = (0, _asyncToGenerator2.default)(function* () {
        if (this.fakeTimers) {
          this.fakeTimers.dispose();
        }
        if (this.fakeTimersModern) {
          this.fakeTimersModern.dispose();
        }
        this.context = null;
        this.fakeTimers = null;
        this.fakeTimersModern = null;
      });
      function teardown() {
        return _teardown.apply(this, arguments);
      }
      return teardown;
    }()
  }, {
    key: "exportConditions",
    value: function exportConditions() {
      var _this$_configuredExpo;
      return (_this$_configuredExpo = this._configuredExportConditions) != null ? _this$_configuredExpo : this.customExportConditions;
    }
  }, {
    key: "getVmContext",
    value: function getVmContext() {
      return this.context;
    }
  }]);
}();
exports.default = NodeEnvironment;
var TestEnvironment = NodeEnvironment;
exports.TestEnvironment = TestEnvironment;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9hc3luY1RvR2VuZXJhdG9yMiIsIl9zbGljZWRUb0FycmF5MiIsIl9jbGFzc0NhbGxDaGVjazIiLCJfY3JlYXRlQ2xhc3MyIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkZWZhdWx0IiwiVGVzdEVudmlyb25tZW50IiwiX3ZtIiwiZGF0YSIsIl9mYWtlVGltZXJzIiwiX2plc3RNb2NrIiwiX2plc3RVdGlsIiwiZGVueUxpc3QiLCJTZXQiLCJub2RlR2xvYmFscyIsIk1hcCIsImdldE93blByb3BlcnR5TmFtZXMiLCJnbG9iYWxUaGlzIiwiZmlsdGVyIiwiZ2xvYmFsIiwiaGFzIiwibWFwIiwibm9kZUdsb2JhbHNLZXkiLCJkZXNjcmlwdG9yIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiRXJyb3IiLCJpc1N0cmluZyIsIk5vZGVFbnZpcm9ubWVudCIsImNvbmZpZyIsIl9jb250ZXh0IiwiY3VzdG9tRXhwb3J0Q29uZGl0aW9ucyIsInByb2plY3RDb25maWciLCJjb250ZXh0IiwiY3JlYXRlQ29udGV4dCIsInJ1bkluQ29udGV4dCIsImFzc2lnbiIsInRlc3RFbnZpcm9ubWVudE9wdGlvbnMiLCJjb250ZXh0R2xvYmFscyIsIl9sb29wIiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsIndyaXRhYmxlIiwic2V0IiwiX3JlZiIsIl9yZWYyIiwiQnVmZmVyIiwiQXJyYXlCdWZmZXIiLCJVaW50OEFycmF5IiwiaW5zdGFsbENvbW1vbkdsb2JhbHMiLCJnbG9iYWxzIiwic3RhY2tUcmFjZUxpbWl0IiwiQXJyYXkiLCJpc0FycmF5IiwiZXZlcnkiLCJfY29uZmlndXJlZEV4cG9ydENvbmRpdGlvbnMiLCJtb2R1bGVNb2NrZXIiLCJNb2R1bGVNb2NrZXIiLCJ0aW1lcklkVG9SZWYiLCJpZCIsInJlZiIsInVucmVmIiwidGltZXJSZWZUb0lkIiwidGltZXIiLCJmYWtlVGltZXJzIiwiTGVnYWN5RmFrZVRpbWVycyIsInRpbWVyQ29uZmlnIiwiaWRUb1JlZiIsInJlZlRvSWQiLCJmYWtlVGltZXJzTW9kZXJuIiwiTW9kZXJuRmFrZVRpbWVycyIsImtleSIsIl9zZXR1cCIsInNldHVwIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfdGVhcmRvd24iLCJkaXNwb3NlIiwidGVhcmRvd24iLCJleHBvcnRDb25kaXRpb25zIiwiX3RoaXMkX2NvbmZpZ3VyZWRFeHBvIiwiZ2V0Vm1Db250ZXh0Il0sInNvdXJjZXMiOlsiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IGV4cG9ydHMuVGVzdEVudmlyb25tZW50ID0gdm9pZCAwO1xuZnVuY3Rpb24gX3ZtKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgndm0nKTtcbiAgX3ZtID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuICByZXR1cm4gZGF0YTtcbn1cbmZ1bmN0aW9uIF9mYWtlVGltZXJzKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnQGplc3QvZmFrZS10aW1lcnMnKTtcbiAgX2Zha2VUaW1lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG4gIHJldHVybiBkYXRhO1xufVxuZnVuY3Rpb24gX2plc3RNb2NrKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnamVzdC1tb2NrJyk7XG4gIF9qZXN0TW9jayA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcbiAgcmV0dXJuIGRhdGE7XG59XG5mdW5jdGlvbiBfamVzdFV0aWwoKSB7XG4gIGNvbnN0IGRhdGEgPSByZXF1aXJlKCdqZXN0LXV0aWwnKTtcbiAgX2plc3RVdGlsID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuICByZXR1cm4gZGF0YTtcbn1cbi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG4vLyBzb21lIGdsb2JhbHMgd2UgZG8gbm90IHdhbnQsIGVpdGhlciBiZWNhdXNlIGRlcHJlY2F0ZWQgb3Igd2Ugc2V0IGl0IG91cnNlbHZlc1xuY29uc3QgZGVueUxpc3QgPSBuZXcgU2V0KFtcbiAgJ0dMT0JBTCcsXG4gICdyb290JyxcbiAgJ2dsb2JhbCcsXG4gICdnbG9iYWxUaGlzJyxcbiAgJ0J1ZmZlcicsXG4gICdBcnJheUJ1ZmZlcicsXG4gICdVaW50OEFycmF5JyxcbiAgLy8gaWYgZW52IGlzIGxvYWRlZCB3aXRoaW4gYSBqZXN0IHRlc3RcbiAgJ2plc3Qtc3ltYm9sLWRvLW5vdC10b3VjaCdcbl0pO1xuY29uc3Qgbm9kZUdsb2JhbHMgPSBuZXcgTWFwKFxuICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhnbG9iYWxUaGlzKVxuICAgIC5maWx0ZXIoZ2xvYmFsID0+ICFkZW55TGlzdC5oYXMoZ2xvYmFsKSlcbiAgICAubWFwKG5vZGVHbG9iYWxzS2V5ID0+IHtcbiAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKFxuICAgICAgICBnbG9iYWxUaGlzLFxuICAgICAgICBub2RlR2xvYmFsc0tleVxuICAgICAgKTtcbiAgICAgIGlmICghZGVzY3JpcHRvcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYE5vIHByb3BlcnR5IGRlc2NyaXB0b3IgZm9yICR7bm9kZUdsb2JhbHNLZXl9LCB0aGlzIGlzIGEgYnVnIGluIEplc3QuYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFtub2RlR2xvYmFsc0tleSwgZGVzY3JpcHRvcl07XG4gICAgfSlcbik7XG5mdW5jdGlvbiBpc1N0cmluZyh2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcbn1cbmNsYXNzIE5vZGVFbnZpcm9ubWVudCB7XG4gIGNvbnRleHQ7XG4gIGZha2VUaW1lcnM7XG4gIGZha2VUaW1lcnNNb2Rlcm47XG4gIGdsb2JhbDtcbiAgbW9kdWxlTW9ja2VyO1xuICBjdXN0b21FeHBvcnRDb25kaXRpb25zID0gWydub2RlJywgJ25vZGUtYWRkb25zJ107XG4gIF9jb25maWd1cmVkRXhwb3J0Q29uZGl0aW9ucztcblxuICAvLyB3aGlsZSBgY29udGV4dGAgaXMgdW51c2VkLCBpdCBzaG91bGQgYWx3YXlzIGJlIHBhc3NlZFxuICBjb25zdHJ1Y3Rvcihjb25maWcsIF9jb250ZXh0KSB7XG4gICAgY29uc3Qge3Byb2plY3RDb25maWd9ID0gY29uZmlnO1xuICAgIHRoaXMuY29udGV4dCA9ICgwLCBfdm0oKS5jcmVhdGVDb250ZXh0KSgpO1xuICAgIGNvbnN0IGdsb2JhbCA9ICgwLCBfdm0oKS5ydW5JbkNvbnRleHQpKFxuICAgICAgJ3RoaXMnLFxuICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmNvbnRleHQsIHByb2plY3RDb25maWcudGVzdEVudmlyb25tZW50T3B0aW9ucylcbiAgICApO1xuICAgIHRoaXMuZ2xvYmFsID0gZ2xvYmFsO1xuICAgIGNvbnN0IGNvbnRleHRHbG9iYWxzID0gbmV3IFNldChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhnbG9iYWwpKTtcbiAgICBmb3IgKGNvbnN0IFtub2RlR2xvYmFsc0tleSwgZGVzY3JpcHRvcl0gb2Ygbm9kZUdsb2JhbHMpIHtcbiAgICAgIGlmICghY29udGV4dEdsb2JhbHMuaGFzKG5vZGVHbG9iYWxzS2V5KSkge1xuICAgICAgICBpZiAoZGVzY3JpcHRvci5jb25maWd1cmFibGUpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZ2xvYmFsLCBub2RlR2xvYmFsc0tleSwge1xuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgZW51bWVyYWJsZTogZGVzY3JpcHRvci5lbnVtZXJhYmxlLFxuICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGdsb2JhbFRoaXNbbm9kZUdsb2JhbHNLZXldO1xuXG4gICAgICAgICAgICAgIC8vIG92ZXJyaWRlIGxhenkgZ2V0dGVyXG4gICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShnbG9iYWwsIG5vZGVHbG9iYWxzS2V5LCB7XG4gICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IGRlc2NyaXB0b3IuZW51bWVyYWJsZSxcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldCh2YWx1ZSkge1xuICAgICAgICAgICAgICAvLyBvdmVycmlkZSBsYXp5IGdldHRlclxuICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZ2xvYmFsLCBub2RlR2xvYmFsc0tleSwge1xuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiBkZXNjcmlwdG9yLmVudW1lcmFibGUsXG4gICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGdsb2JhbCwgbm9kZUdsb2JhbHNLZXksIHtcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBkZXNjcmlwdG9yLmVudW1lcmFibGUsXG4gICAgICAgICAgICB2YWx1ZTogZGVzY3JpcHRvci52YWx1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiBkZXNjcmlwdG9yLndyaXRhYmxlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGdsb2JhbCwgbm9kZUdsb2JhbHNLZXksIHtcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiBkZXNjcmlwdG9yLmVudW1lcmFibGUsXG4gICAgICAgICAgICBnZXQ6IGRlc2NyaXB0b3IuZ2V0LFxuICAgICAgICAgICAgc2V0OiBkZXNjcmlwdG9yLnNldFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIEJ1ZmZlciBhbmQgZ2MgaXMgXCJtaXNzaW5nXCJcbiAgICBnbG9iYWwuZ2xvYmFsID0gZ2xvYmFsO1xuICAgIGdsb2JhbC5CdWZmZXIgPSBCdWZmZXI7XG4gICAgZ2xvYmFsLkFycmF5QnVmZmVyID0gQXJyYXlCdWZmZXI7XG4gICAgLy8gVGV4dEVuY29kZXIgKGdsb2JhbCBvciB2aWEgJ3V0aWwnKSByZWZlcmVuY2VzIGEgVWludDhBcnJheSBjb25zdHJ1Y3RvclxuICAgIC8vIGRpZmZlcmVudCB0aGFuIHRoZSBnbG9iYWwgb25lIHVzZWQgYnkgdXNlcnMgaW4gdGVzdHMuIFRoaXMgbWFrZXMgc3VyZSB0aGVcbiAgICAvLyBzYW1lIGNvbnN0cnVjdG9yIGlzIHJlZmVyZW5jZWQgYnkgYm90aC5cbiAgICBnbG9iYWwuVWludDhBcnJheSA9IFVpbnQ4QXJyYXk7XG4gICAgKDAsIF9qZXN0VXRpbCgpLmluc3RhbGxDb21tb25HbG9iYWxzKShnbG9iYWwsIHByb2plY3RDb25maWcuZ2xvYmFscyk7XG5cbiAgICAvLyBOb2RlJ3MgZXJyb3ItbWVzc2FnZSBzdGFjayBzaXplIGlzIGxpbWl0ZWQgYXQgMTAsIGJ1dCBpdCdzIHByZXR0eSB1c2VmdWxcbiAgICAvLyB0byBzZWUgbW9yZSB0aGFuIHRoYXQgd2hlbiBhIHRlc3QgZmFpbHMuXG4gICAgZ2xvYmFsLkVycm9yLnN0YWNrVHJhY2VMaW1pdCA9IDEwMDtcbiAgICBpZiAoJ2N1c3RvbUV4cG9ydENvbmRpdGlvbnMnIGluIHByb2plY3RDb25maWcudGVzdEVudmlyb25tZW50T3B0aW9ucykge1xuICAgICAgY29uc3Qge2N1c3RvbUV4cG9ydENvbmRpdGlvbnN9ID0gcHJvamVjdENvbmZpZy50ZXN0RW52aXJvbm1lbnRPcHRpb25zO1xuICAgICAgaWYgKFxuICAgICAgICBBcnJheS5pc0FycmF5KGN1c3RvbUV4cG9ydENvbmRpdGlvbnMpICYmXG4gICAgICAgIGN1c3RvbUV4cG9ydENvbmRpdGlvbnMuZXZlcnkoaXNTdHJpbmcpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5fY29uZmlndXJlZEV4cG9ydENvbmRpdGlvbnMgPSBjdXN0b21FeHBvcnRDb25kaXRpb25zO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDdXN0b20gZXhwb3J0IGNvbmRpdGlvbnMgc3BlY2lmaWVkIGJ1dCB0aGV5IGFyZSBub3QgYW4gYXJyYXkgb2Ygc3RyaW5ncydcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5tb2R1bGVNb2NrZXIgPSBuZXcgKF9qZXN0TW9jaygpLk1vZHVsZU1vY2tlcikoZ2xvYmFsKTtcbiAgICBjb25zdCB0aW1lcklkVG9SZWYgPSBpZCA9PiAoe1xuICAgICAgaWQsXG4gICAgICByZWYoKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcbiAgICAgIHVucmVmKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zdCB0aW1lclJlZlRvSWQgPSB0aW1lciA9PiB0aW1lcj8uaWQ7XG4gICAgdGhpcy5mYWtlVGltZXJzID0gbmV3IChfZmFrZVRpbWVycygpLkxlZ2FjeUZha2VUaW1lcnMpKHtcbiAgICAgIGNvbmZpZzogcHJvamVjdENvbmZpZyxcbiAgICAgIGdsb2JhbCxcbiAgICAgIG1vZHVsZU1vY2tlcjogdGhpcy5tb2R1bGVNb2NrZXIsXG4gICAgICB0aW1lckNvbmZpZzoge1xuICAgICAgICBpZFRvUmVmOiB0aW1lcklkVG9SZWYsXG4gICAgICAgIHJlZlRvSWQ6IHRpbWVyUmVmVG9JZFxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuZmFrZVRpbWVyc01vZGVybiA9IG5ldyAoX2Zha2VUaW1lcnMoKS5Nb2Rlcm5GYWtlVGltZXJzKSh7XG4gICAgICBjb25maWc6IHByb2plY3RDb25maWcsXG4gICAgICBnbG9iYWxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZW1wdHktZnVuY3Rpb25cbiAgYXN5bmMgc2V0dXAoKSB7fVxuICBhc3luYyB0ZWFyZG93bigpIHtcbiAgICBpZiAodGhpcy5mYWtlVGltZXJzKSB7XG4gICAgICB0aGlzLmZha2VUaW1lcnMuZGlzcG9zZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5mYWtlVGltZXJzTW9kZXJuKSB7XG4gICAgICB0aGlzLmZha2VUaW1lcnNNb2Rlcm4uZGlzcG9zZSgpO1xuICAgIH1cbiAgICB0aGlzLmNvbnRleHQgPSBudWxsO1xuICAgIHRoaXMuZmFrZVRpbWVycyA9IG51bGw7XG4gICAgdGhpcy5mYWtlVGltZXJzTW9kZXJuID0gbnVsbDtcbiAgfVxuICBleHBvcnRDb25kaXRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLl9jb25maWd1cmVkRXhwb3J0Q29uZGl0aW9ucyA/PyB0aGlzLmN1c3RvbUV4cG9ydENvbmRpdGlvbnM7XG4gIH1cbiAgZ2V0Vm1Db250ZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRleHQ7XG4gIH1cbn1cbmV4cG9ydHMuZGVmYXVsdCA9IE5vZGVFbnZpcm9ubWVudDtcbmNvbnN0IFRlc3RFbnZpcm9ubWVudCA9IE5vZGVFbnZpcm9ubWVudDtcbmV4cG9ydHMuVGVzdEVudmlyb25tZW50ID0gVGVzdEVudmlyb25tZW50O1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUFDLElBQUFBLHNCQUFBLEdBQUFDLE9BQUE7QUFBQSxJQUFBQyxrQkFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQUUsZUFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQUEsSUFBQUcsZ0JBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFJLGFBQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUViSyxNQUFNLENBQUNDLGNBQWMsQ0FBQ0MsT0FBTyxFQUFFLFlBQVksRUFBRTtFQUMzQ0MsS0FBSyxFQUFFO0FBQ1QsQ0FBQyxDQUFDO0FBQ0ZELE9BQU8sQ0FBQ0UsT0FBTyxHQUFHRixPQUFPLENBQUNHLGVBQWUsR0FBRyxLQUFLLENBQUM7QUFDbEQsU0FBU0MsR0FBR0EsQ0FBQSxFQUFHO0VBQ2IsSUFBTUMsSUFBSSxHQUFHWixPQUFPLENBQUMsSUFBSSxDQUFDO0VBQzFCVyxHQUFHLEdBQUcsU0FBQUEsSUFBQSxFQUFZO0lBQ2hCLE9BQU9DLElBQUk7RUFDYixDQUFDO0VBQ0QsT0FBT0EsSUFBSTtBQUNiO0FBQ0EsU0FBU0MsV0FBV0EsQ0FBQSxFQUFHO0VBQ3JCLElBQU1ELElBQUksR0FBR1osT0FBTyxDQUFDLG1CQUFtQixDQUFDO0VBQ3pDYSxXQUFXLEdBQUcsU0FBQUEsWUFBQSxFQUFZO0lBQ3hCLE9BQU9ELElBQUk7RUFD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