{"version":3,"names":["_jestMatcherUtils","require","_eventBuilder","_errors","_hostComponentNames","_object","_utils","_utils2","_state","scrollTo","_x","_x2","_scrollTo","apply","arguments","_asyncToGenerator2","default","element","options","_options$contentSize$","_options$contentSize","_options$contentSize$2","_options$contentSize2","_dragSteps$at","_ref","_momentumSteps$at","isHostScrollView","ErrorWithStack","type","ensureScrollViewDirection","dispatchEvent","contentSize","width","height","initialPosition","getElementScrollOffset","dragSteps","createScrollSteps","y","x","linearInterpolator","emitDragScrollEvents","config","momentumStart","at","momentumSteps","momentumY","momentumX","inertialInterpolator","emitMomentumScrollEvents","finalPosition","setElementScrollOffset","_x3","_x4","_x5","_x6","_emitDragScrollEvents","scrollSteps","scrollOptions","length","wait","EventBuilder","ScrollView","scroll","i","lastStep","_x7","_x8","_x9","_x10","_emitMomentumScrollEvents","isVerticalScrollView","props","horizontal","hasHorizontalScrollOptions","undefined","stringify","pick","hasVerticalScrollOptions"],"sources":["../../../src/user-event/scroll/scroll-to.ts"],"sourcesContent":["import { ReactTestInstance } from 'react-test-renderer';\nimport { stringify } from 'jest-matcher-utils';\nimport { UserEventConfig, UserEventInstance } from '../setup';\nimport { EventBuilder } from '../event-builder';\nimport { ErrorWithStack } from '../../helpers/errors';\nimport { isHostScrollView } from '../../helpers/host-component-names';\nimport { pick } from '../../helpers/object';\nimport { ContentOffset } from '../event-builder/scroll-view';\nimport { dispatchEvent, wait } from '../utils';\nimport { createScrollSteps, inertialInterpolator, linearInterpolator } from './utils';\nimport { getElementScrollOffset, setElementScrollOffset } from './state';\n\ninterface CommonScrollToOptions {\n  contentSize?: {\n    height: number;\n    width: number;\n  };\n  layoutMeasurement?: {\n    height: number;\n    width: number;\n  };\n}\n\nexport interface VerticalScrollToOptions extends CommonScrollToOptions {\n  y: number;\n  momentumY?: number;\n\n  // Vertical scroll should not contain horizontal scroll part.\n  x?: never;\n  momentumX?: never;\n}\n\nexport interface HorizontalScrollToOptions extends CommonScrollToOptions {\n  x: number;\n  momentumX?: number;\n\n  // Horizontal scroll should not contain vertical scroll part.\n  y?: never;\n  momentumY?: never;\n}\n\nexport type ScrollToOptions = VerticalScrollToOptions | HorizontalScrollToOptions;\n\nexport async function scrollTo(\n  this: UserEventInstance,\n  element: ReactTestInstance,\n  options: ScrollToOptions,\n): Promise<void> {\n  if (!isHostScrollView(element)) {\n    throw new ErrorWithStack(\n      `scrollTo() works only with host \"ScrollView\" elements. Passed element has type \"${element.type}\".`,\n      scrollTo,\n    );\n  }\n\n  ensureScrollViewDirection(element, options);\n\n  dispatchEvent(\n    element,\n    'contentSizeChange',\n    options.contentSize?.width ?? 0,\n    options.contentSize?.height ?? 0,\n  );\n\n  const initialPosition = getElementScrollOffset(element);\n  const dragSteps = createScrollSteps(\n    { y: options.y, x: options.x },\n    initialPosition,\n    linearInterpolator,\n  );\n  await emitDragScrollEvents(this.config, element, dragSteps, options);\n\n  const momentumStart = dragSteps.at(-1) ?? initialPosition;\n  const momentumSteps = createScrollSteps(\n    { y: options.momentumY, x: options.momentumX },\n    momentumStart,\n    inertialInterpolator,\n  );\n  await emitMomentumScrollEvents(this.config, element, momentumSteps, options);\n\n  const finalPosition = momentumSteps.at(-1) ?? dragSteps.at(-1) ?? initialPosition;\n  setElementScrollOffset(element, finalPosition);\n}\n\nasync function emitDragScrollEvents(\n  config: UserEventConfig,\n  element: ReactTestInstance,\n  scrollSteps: ContentOffset[],\n  scrollOptions: ScrollToOptions,\n) {\n  if (scrollSteps.length === 0) {\n    return;\n  }\n\n  await wait(config);\n  dispatchEvent(\n    element,\n    'scrollBeginDrag',\n    EventBuilder.ScrollView.scroll(scrollSteps[0], scrollOptions),\n  );\n\n  // Note: experimentally, in case of drag scroll the last scroll step\n  // will not trigger `scroll` event.\n  // See: https://github.com/callstack/react-native-testing-library/wiki/ScrollView-Events\n  for (let i = 1; i < scrollSteps.length - 1; i += 1) {\n    await wait(config);\n    dispatchEvent(element, 'scroll', EventBuilder.ScrollView.scroll(scrollSteps[i], scrollOptions));\n  }\n\n  await wait(config);\n  const lastStep = scrollSteps.at(-1);\n  dispatchEvent(element, 'scrollEndDrag', EventBuilder.ScrollView.scroll(lastStep, scrollOptions));\n}\n\nasync function emitMomentumScrollEvents(\n  config: UserEventConfig,\n  element: ReactTestInstance,\n  scrollSteps: ContentOffset[],\n  scrollOptions: ScrollToOptions,\n) {\n  if (scrollSteps.length === 0) {\n    return;\n  }\n\n  await wait(config);\n  dispatchEvent(\n    element,\n    'momentumScrollBegin',\n    EventBuilder.ScrollView.scroll(scrollSteps[0], scrollOptions),\n  );\n\n  // Note: experimentally, in case of momentum scroll the last scroll step\n  // will trigger `scroll` event.\n  // See: https://github.com/callstack/react-native-testing-library/wiki/ScrollView-Events\n  for (let i = 1; i < scrollSteps.length; i += 1) {\n    await wait(config);\n    dispatchEvent(element, 'scroll', EventBuilder.ScrollView.scroll(scrollSteps[i], scrollOptions));\n  }\n\n  await wait(config);\n  const lastStep = scrollSteps.at(-1);\n  dispatchEvent(\n    element,\n    'momentumScrollEnd',\n    EventBuilder.ScrollView.scroll(lastStep, scrollOptions),\n  );\n}\n\nfunction ensureScrollViewDirection(element: ReactTestInstance, options: ScrollToOptions) {\n  const isVerticalScrollView = element.props.horizontal !== true;\n\n  const hasHorizontalScrollOptions = options.x !== undefined || options.momentumX !== undefined;\n  if (isVerticalScrollView && hasHorizontalScrollOptions) {\n    throw new ErrorWithStack(\n      `scrollTo() expected only vertical scroll options: \"y\" and \"momentumY\" for vertical \"ScrollView\" element but received ${stringify(\n        pick(options, ['x', 'momentumX']),\n      )}`,\n      scrollTo,\n    );\n  }\n\n  const hasVerticalScrollOptions = options.y !== undefined || options.momentumY !== undefined;\n  if (!isVerticalScrollView && hasVerticalScrollOptions) {\n    throw new ErrorWithStack(\n      `scrollTo() expected only horizontal scroll options: \"x\" and \"momentumX\" for horizontal \"ScrollView\" element but received ${stringify(\n        pick(options, ['y', 'momentumY']),\n      )}`,\n      scrollTo,\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}