{"version":3,"names":["_errors","require","_waitFor","_interopRequireDefault","_format","_screen","_formatDefault","obj","__esModule","default","deprecatedKeys","extractDeprecatedWaitForOptions","options","undefined","waitForOptions","timeout","interval","stackTraceError","forEach","key","option","console","warn","toString","formatErrorMessage","message","printElementTree","screen","isDetached","json","toJSON","mapProps","defaultMapProps","appendElementTreeToError","error","_error$stack","oldMessage","stack","replace","makeQueries","queryAllByQuery","getMissingError","getMultipleError","getAllByQuery","instance","_ref","arguments","length","_ref$printElementTree","getAllFn","predicate","results","errorMessage","ErrorWithStack","queryByQuery","_ref2","_ref2$printElementTre","singleQueryFn","getByQuery","_ref3","_ref3$printElementTre","getFn","findAllByQuery","findAllFn","queryOptions","_ref4","_ref4$onTimeout","onTimeout","_objectWithoutProperties2","_excluded","deprecatedWaitForOptions","Object","assign","findByQuery","findFn","_ref5","_ref5$onTimeout","_excluded2","getBy","getAllBy","queryBy","queryAllBy","findBy","findAllBy"],"sources":["../../src/queries/make-queries.ts"],"sourcesContent":["import type { ReactTestInstance } from 'react-test-renderer';\nimport { ErrorWithStack } from '../helpers/errors';\nimport waitFor from '../wait-for';\nimport type { WaitForOptions } from '../wait-for';\nimport format from '../helpers/format';\nimport { screen } from '../screen';\nimport { defaultMapProps } from '../helpers/format-default';\n\nexport type GetByQuery<Predicate, Options = void> = (\n  predicate: Predicate,\n  options?: Options,\n) => ReactTestInstance;\n\nexport type GetAllByQuery<Predicate, Options = void> = (\n  predicate: Predicate,\n  options?: Options,\n) => ReactTestInstance[];\n\nexport type QueryByQuery<Predicate, Options = void> = (\n  predicate: Predicate,\n  options?: Options,\n) => ReactTestInstance | null;\n\nexport type QueryAllByQuery<Predicate, Options = void> = (\n  predicate: Predicate,\n  options?: Options,\n) => ReactTestInstance[];\n\nexport type FindByQuery<Predicate, Options = void> = (\n  predicate: Predicate,\n  // Remove `& WaitForOptions` when all queries have been migrated to support 2nd arg query options.\n  options?: Options & WaitForOptions,\n  waitForOptions?: WaitForOptions,\n) => Promise<ReactTestInstance>;\n\nexport type FindAllByQuery<Predicate, Options = void> = (\n  predicate: Predicate,\n  // Remove `& WaitForOptions` when all queries have been migrated to support 2nd arg query options.\n  options?: Options & WaitForOptions,\n  waitForOptions?: WaitForOptions,\n) => Promise<ReactTestInstance[]>;\n\ntype UnboundQuery<Query> = (instance: ReactTestInstance) => Query;\n\nexport type UnboundQueries<Predicate, Options> = {\n  getBy: UnboundQuery<GetByQuery<Predicate, Options>>;\n  getAllBy: UnboundQuery<GetAllByQuery<Predicate, Options>>;\n  queryBy: UnboundQuery<QueryByQuery<Predicate, Options>>;\n  queryAllBy: UnboundQuery<QueryAllByQuery<Predicate, Options>>;\n  findBy: UnboundQuery<FindByQuery<Predicate, Options>>;\n  findAllBy: UnboundQuery<FindAllByQuery<Predicate, Options>>;\n};\n\nconst deprecatedKeys: (keyof WaitForOptions)[] = ['timeout', 'interval', 'stackTraceError'];\n\n// The WaitForOptions has been moved to the second option param of findBy* methods with the adding of TextMatchOptions\n// To make the migration easier and avoid a breaking change, keep reading this options from the first param but warn\nfunction extractDeprecatedWaitForOptions(options?: WaitForOptions) {\n  if (!options) {\n    return undefined;\n  }\n\n  const waitForOptions: WaitForOptions = {\n    timeout: options.timeout,\n    interval: options.interval,\n    stackTraceError: options.stackTraceError,\n  };\n\n  deprecatedKeys.forEach((key) => {\n    const option = options[key];\n    if (option) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `Use of option \"${key}\" in a findBy* query options (2nd parameter) is deprecated. Please pass this option in the waitForOptions (3rd parameter).\nExample:\n\n  findByText(text, {}, { ${key}: ${option.toString()} })`,\n      );\n    }\n  });\n\n  return waitForOptions;\n}\n\nfunction formatErrorMessage(message: string, printElementTree: boolean) {\n  if (!printElementTree) {\n    return message;\n  }\n\n  if (screen.isDetached) {\n    return `${message}\\n\\nScreen is no longer attached. Check your test for \"findBy*\" or \"waitFor\" calls that have not been awaited.\\n\\nWe recommend enabling \"eslint-plugin-testing-library\" to catch these issues at build time:\\nhttps://callstack.github.io/react-native-testing-library/docs/getting-started#eslint-plugin`;\n  }\n\n  const json = screen.toJSON();\n  if (!json) {\n    return message;\n  }\n\n  return `${message}\\n\\n${format(json, {\n    mapProps: defaultMapProps,\n  })}`;\n}\n\nfunction appendElementTreeToError(error: Error) {\n  const oldMessage = error.message;\n  error.message = formatErrorMessage(oldMessage, true);\n\n  // Required to make Jest print the element tree on error\n  error.stack = error.stack?.replace(oldMessage, error.message);\n\n  return error;\n}\n\nexport function makeQueries<Predicate, Options>(\n  queryAllByQuery: UnboundQuery<QueryAllByQuery<Predicate, Options>>,\n  getMissingError: (predicate: Predicate, options?: Options) => string,\n  getMultipleError: (predicate: Predicate, options?: Options) => string,\n): UnboundQueries<Predicate, Options> {\n  function getAllByQuery(instance: ReactTestInstance, { printElementTree = true } = {}) {\n    return function getAllFn(predicate: Predicate, options?: Options) {\n      const results = queryAllByQuery(instance)(predicate, options);\n\n      if (results.length === 0) {\n        const errorMessage = formatErrorMessage(\n          getMissingError(predicate, options),\n          printElementTree,\n        );\n        throw new ErrorWithStack(errorMessage, getAllFn);\n      }\n\n      return results;\n    };\n  }\n\n  function queryByQuery(instance: ReactTestInstance, { printElementTree = true } = {}) {\n    return function singleQueryFn(predicate: Predicate, options?: Options) {\n      const results = queryAllByQuery(instance)(predicate, options);\n\n      if (results.length > 1) {\n        throw new ErrorWithStack(\n          formatErrorMessage(getMultipleError(predicate, options), printElementTree),\n          singleQueryFn,\n        );\n      }\n\n      if (results.length === 0) {\n        return null;\n      }\n\n      return results[0];\n    };\n  }\n\n  function getByQuery(instance: ReactTestInstance, { printElementTree = true } = {}) {\n    return function getFn(predicate: Predicate, options?: Options) {\n      const results = queryAllByQuery(instance)(predicate, options);\n\n      if (results.length > 1) {\n        throw new ErrorWithStack(getMultipleError(predicate, options), getFn);\n      }\n\n      if (results.length === 0) {\n        const errorMessage = formatErrorMessage(\n          getMissingError(predicate, options),\n          printElementTree,\n        );\n        throw new ErrorWithStack(errorMessage, getFn);\n      }\n\n      return results[0];\n    };\n  }\n\n  function findAllByQuery(instance: ReactTestInstance) {\n    return function findAllFn(\n      predicate: Predicate,\n      queryOptions?: Options & WaitForOptions,\n      {\n        onTimeout = (error) => appendElementTreeToError(error),\n        ...waitForOptions\n      }: WaitForOptions = {},\n    ) {\n      const stackTraceError = new ErrorWithStack('STACK_TRACE_ERROR', findAllFn);\n      const deprecatedWaitForOptions = extractDeprecatedWaitForOptions(queryOptions);\n\n      return waitFor(\n        () => getAllByQuery(instance, { printElementTree: false })(predicate, queryOptions),\n        {\n          ...deprecatedWaitForOptions,\n          ...waitForOptions,\n          stackTraceError,\n          onTimeout,\n        },\n      );\n    };\n  }\n\n  function findByQuery(instance: ReactTestInstance) {\n    return function findFn(\n      predicate: Predicate,\n      queryOptions?: Options & WaitForOptions,\n      {\n        onTimeout = (error) => appendElementTreeToError(error),\n        ...waitForOptions\n      }: WaitForOptions = {},\n    ) {\n      const stackTraceError = new ErrorWithStack('STACK_TRACE_ERROR', findFn);\n      const deprecatedWaitForOptions = extractDeprecatedWaitForOptions(queryOptions);\n\n      return waitFor(\n        () => getByQuery(instance, { printElementTree: false })(predicate, queryOptions),\n        {\n          ...deprecatedWaitForOptions,\n          ...waitForOptions,\n          stackTraceError,\n          onTimeout,\n        },\n      );\n    };\n  }\n\n  return {\n    getBy: getByQuery,\n    getAllBy: getAllByQuery,\n    queryBy: queryByQuery,\n    queryAllBy: queryAllByQuery,\n    findBy: findByQuery,\n    findAllBy: findAllByQuery,\n  };\n}\n"],"mappings":"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","ignoreList":[]}